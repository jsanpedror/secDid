/*!
 * Generated by ActivePresenter 6.1.6 HTML5 (2018.04.16)
 */
/*!
 * Atomi HTML5 Player
 * Author: Le Hong Dang <dangle@atomisystems.com>
 * Company: Atomi Systems, Inc.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2016/03/25
 */
var PrezStreams={NONE:0,MAIN:1,SECOND:2,ALL:3};var CtrlKind={NOTE:0,ACTION:1,IMAGE:2,AUDIO:3,VIDEO:4,ANSWER:5,TOGGLE:6,QUIZ:7,TEXTINPUT:8,COMBO:9,BUTTON:10,INPUT:11,FEEDBACK:12,GESTURE:13,DROP:14,YOUTUBE:15,WEBOBJECT:16,CURSOR:90,ZOOM:91};var CtrlFlags={LOOP:1<<29,NOT_WAIT:1<<28,FOCUSABLE:1<<22,DRAGGABLE:1<<20,DROPPABLE:1<<19};var CtrlShowState={SHOWING:1,SHOW:2,HIDING:3,HIDE:4};var NoteType={BALLOON:0,HINTBOX:1,CAPTION:2,HILIGHT:3,QUESTION:4,ANSWER:5};var AutoShapeType={RECTANGLE:0,ROUNDED_RECT:1,RECT_CALLOUT:2,ROUNDED_RECT_CALLOUT:3,RIGHT_ARROW:4,LEFT_ARROW:5,TOP_ARROW:6,BOTTOM_ARROW:7,OVAL_CALLOUT:8,CROSS:9,OVAL:10,DIAMOND:11,CLOUD_CALLOUT:12,LINE_CALLOUT_1:13,LEFT_RIGHT_ARROW:14,UP_DOWN_ARROW:15,RIGHT_ARROW_CALLOUT:16,DOWN_ARROW_CALLOUT:17,LEFT_ARROW_CALLOUT:18,UP_ARROW_CALLOUT:19,NOTCHED_RIGHT_ARROW:20,CHEVRON:21,ISOSCELES_TRIANGLE:22,RIGHT_TRIANGLE:23,DATA:24,REGULAR_PENTAGON:25,HEXAGON:26,OCTAGON:27,PLAQUE:28,CAN:29,FOLDER_CORNER:30,HEART:31,MOON:32,LEFT_BRACKET:33,RIGHT_BRACKET:34,PARALLELOGRAM:35,TRAPEZOID:36,FRAME:37,DOUBLE_BRACKET:38,DOUBLE_BRACE:39,SNIP_CORNER_RECT:40,ROUND_CORNER_RECT:41,LIGHT_BOLT:42,DONUT:43,OFFPAGE_CONNECTOR:44,ACCESS_DATA:45,DISPLAY:46,CARD:47,PENTAGON:48,STORED_DATA:49,WAVE:50,PUNCHED_TAPE:51,STAR_MIN:52,STAR_MAX:564,LINE:565,LINE_ARROW:566,LINE_DOUBLE_ARROW:567};var MarkerType={ARROW:1,OPEN:2,STEALTH:3,DIAMOND:4,OVAL:5};var MarkerSize={ARROW_SIZE_1:0,ARROW_SIZE_2:1,ARROW_SIZE_3:2,ARROW_SIZE_4:3,ARROW_SIZE_5:4,ARROW_SIZE_6:5,ARROW_SIZE_7:6,ARROW_SIZE_8:7,ARROW_SIZE_9:8};var LineType={NONE:0,SOLID:1};var LineStyle={STYLE_SOLID:1,STYLE_DOT:2,STYLE_DASH:4,STYLE_DOT_DASH:8,STYLE_CUSTOM:16,CAP_SQUARE:32,CAP_ROUND:64,CAP_FLAT:128,JOIN_ROUND:256,JOIN_BEVEL:512,JOIN_MITER:1024};var FillType={NONE:0,SOLID:1,GRADIENT:2,IMAGE:3,PATTERN:4};var ImageFillType={TILE:0,STRETCH:1,CENTER:2,FIT:2,FILL:4};var GradType={LINEAR:0,RADIAL:1};var GradShape={CIRCLE:0,ELLIPSE:1};var GradSize={CLOSE_SIDE:0,FAR_SIDE:1,CLOSE_CORNER:2,FAR_CORNER:3};var ShadowType={NONE:0,CUSTOM:1};var HiLightType={NONE:-1,CIRCLE:0,SQUARE:1};var PassCondition={PERCENT:0,POINTS:1,ANSWERS:2,SLIDESVIEWED:3};var ReportMethod={NONE:0,EMAIL:1,HTTP:2};var ReportFormat={PLAIN:0,CSV:1,XML:2,JSON:3,HTML:4,OBJECT:5};var ZIndexBase={SlideBgrOld:1,SlideCtrlsOld:2,SlideBgrNew:3,SlidePrjCtrls:4,SlideCtrlsNew:5,ClickEffects:6,ClosedCaption:7,CtrlDroppedBase:1000,CtrlDragging:2500,SlideList:3000,Overlay:3000,Dialog:4000,TopLevel:5000};var EvtType={CLICK:3,MOUSE_ENTER:6,MOUSE_LEAVE:7,KEY_DOWN:10,TEXT:12,CHECK:21,CORRECT:23,WRONG:24,COMPLETE:25,INCOMPLETE:26,TIMEOUT:27,ACCEPT:29,REJECT:30,ACCEPT_SPECIFIC:31};var ActType={WAIT:1,CONTINUE:2,END:3,SLIDE_ID:5,SLIDE_IDX:6,NEXT:7,PREV:8,EMAIL:12,WEB:13,SCRIPT:14,SHOW:15,HIDE:16,SUBMIT:19,CLEAR_INPUT:20,SKIP:21,PLAY_AUDIO:26,SHOW_NON_BLOCKING:27};var AtpType={LAST:-1,ALL:-2,ALL_BUT_LAST:-3,OTHERS:-4};var EvtMode={PARTIAL_SCORE:1,PARTIAL_ACTION:2,SURVEY:4,NO_REPORT:8,NO_ASSESSMENT:16,INDEPENDENT:32};var Judge={NEUTRAL:1,CORRECT:2,WRONG:3,PARTIAL_CORRECT:4,INCOMPLETE:5,UNEXPECTED:6};var RL_YT_State={NOT_LOADED:0,LOADED:1,TIMEOUT:2};$.extend($.fx.step,{rlCss:function(c){var b=c.end.css(c.pos);if(c.elem.style){for(var a in b){c.elem.style[a]=b[a]}}},rlTransformOrg:function(c){var d=c.end,b=d.sX+c.pos*(d.eX-d.sX),a=d.sY+c.pos*(d.eY-d.sY);$(c.elem).css("transformOrigin",b+"% "+a+"%")},rlRotate:function(a){var b=a.end.s+a.pos*(a.end.e-a.end.s);$(a.elem).css("transform",b?"rotate("+b+"deg)":"")},rlTransform:function(c){var b="";if(c.end.sr!==undefined&&c.end.er!==undefined){var e=c.end.sr+c.pos*(c.end.er-c.end.sr);if(b!==""){b+=" "}b+="rotate("+e+"deg)"}if(c.end.ss!==undefined&&c.end.es!==undefined){var d=c.end.ss+c.pos*(c.end.es-c.end.ss);if(b!==""){b+=" "}b+="scale("+d+", "+d+")"}if(c.end.stx!==undefined&&c.end.etx!==undefined&&c.end.sty!==undefined&&c.end.ety!==undefined){var a=c.end.stx+c.pos*(c.end.etx-c.end.stx);var f=c.end.sty+c.pos*(c.end.ety-c.end.sty);if(b!==""){b+=" "}b+="translate("+a+"px, "+f+"px)"}$(c.elem).css("transform",b)}});$.extend($.cssHooks,{rlTransformOrg:{set:function(a,b){$(a).css("transformOrigin",b.eX+"% "+b.eY+"%")}},rlRotate:{set:function(a,b){$(a).css("transform",b.e?"rotate("+b.e+"deg)":"")}},rlTransform:{set:function(b,c){var a="";if(c.er!==undefined){if(a!==""){a+=" "}a+="rotate("+c.er+"deg)"}if(c.es!==undefined){if(a!==""){a+=" "}a+="scale("+c.es+", "+c.es+")"}if(c.etx!==undefined&&c.ety!==undefined){if(a!==""){a+=" "}a="translate("+c.etx+"px, "+c.ety+"px)"}$(b).css("transform",a)}}});$.extend($.easing,{easeInOutQuad:function(e,f,a,h,g){if(e<0.5){return 2*h*e*e+a}return -h*(2*e*(e-2)+1)+a}});(function(b){var a=b.ui.intersect;b.ui.intersect=function(c,g,e){if(e!=="pointer"||!c.options.rlCtrlUI){return a(c,g,e)}var f=c.options.rlCtrlUI.mousePos,d=g.options.rlRect;f=convertPointFromPageToNode(g.widget().get(0),f.x,f.y);return(f.x>=0&&f.x<=d.w&&f.y>=0&&f.y<=d.h)}}($));(function(a){a.PreLoad=function(c){var d=new b();d.Init(c);return d};a.PreLoad.defaults={imgs:[],parallel:10,progress:null,complete:null};function b(){var l,h,c,f,g,e;this.Init=function(m){if(!m){return}g=a.extend({},a.PreLoad.defaults,m);l=g.imgs;if(!l.length){if(g.complete){g.complete()}return}e=false;c=h=0;f=new Array(g.parallel);for(var n=0;n<g.parallel;++n){k(n)}};this.Cancel=function(){e=true;for(var m=0;m<f.length;++m){if(f[m]){a(f[m]).unbind("load").unbind("error").attr("src","")}}g.progress=g.complete=null};function k(m){if(e){return}if(c>=l.length){return}f[m]=new Image();a(f[m]).load(function(){a(this).unbind("load").unbind("error");d(m)}).error(function(){a(this).unbind("load").unbind("error");d(m)}).attr("src",l[c++])}function d(m){++h;if(h>=l.length){if(g.complete){g.complete()}}else{if(g.progress){g.progress(h,l.length)}window.setTimeout(function(){k(m)},0)}}}})(jQuery);String.prototype.format=function(){var d=this;for(var b=0,a=arguments.length;b<a;++b){var c=new RegExp("\\{"+(b)+"\\}","gm");d=d.replace(c,arguments[b])}return d};String.prototype.quoteHTML=function(){var a=this;a=a.replace(/&/g,"&#38;").replace(/\s(?=\s)/g,"&#160;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\n/g,"<br />");return a};function ScaleFont(a,d){var c=$('<div><div style="'+a.css+'">'+a.html+"</div></div>");$("*",c).each(function(){if(this.style&&this.style.fontSize){var f=this.style.fontSize;var e=f.match(/\D+$/);e=e&&e[0];if(!e||e.search(/inherit|%|em/i)>-1){return}var h=parseFloat(f);if(!isNaN(h)){h*=d;this.style.fontSize=h+e}else{var g=$(this);g.css("font-size",parseFloat(g.css("font-size"))*d)}}});c=$(c.html());var b=c.attr("style");if(b){a.css=b.replace(/"/g,"&quot;")}else{a.css=""}a.html=c.html()}function IsInside(e,d,c,b,a,f){return((a>=e)&&(a<e+c)&&(f>=d)&&(f<d+b))}function RotatePoint(b,k,f,e,d){var a=f*Math.PI/180,h=Math.cos(a),g=Math.sin(a);b-=e;k-=d;return{x:h*b-g*k+e,y:g*b+h*k+d}}Log.NoLog=true;function Log(b,a){if(Log.NoLog){return}if(a===undefined){a=true}if(a&&window.status.length<200){window.status+=b}else{window.status=b}window.console&&window.console.log(b)}function RandomPermutation(e){var d=[];var c,a,b;for(c=0;c<e;++c){d[c]=c}for(c=e-1;c>0;--c){a=Math.round(c*Math.random());b=d[a];d[a]=d[c];d[c]=b}return d}function LimitValue(c,b,a){if(c<b){return b}else{if(c>a){return a}else{if(isNaN(c)){return b}}}return c}function ToLocalNumber(c,b){var a=""+c;if(b=="ar"||(b.length>2&&b.substr(0,2)=="ar")){a=a.replace(/0/g,"۰");a=a.replace(/1/g,"۱");a=a.replace(/2/g,"۲");a=a.replace(/3/g,"۳");a=a.replace(/4/g,"۴");a=a.replace(/5/g,"۵");a=a.replace(/6/g,"۶");a=a.replace(/7/g,"۷");a=a.replace(/8/g,"۸");a=a.replace(/9/g,"۹")}return a}function FormatMSString(c){var b,d,a;a=c-(c%1000);a/=1000;b=a%60;d=(a-b)/60;b=b>=10?""+b:"0"+b;d=d>=10?""+d:"0"+d;return d+":"+b
}(function(){function c(g,k,h){this.x=g;this.y=k;this.z=h}function a(g){this.data=g}a.fromString=function(g){var h=g.match(/matrix3?d?\(([^\)]+)\)/i)[1].split(",");if(h.length===6){h=[h[0],h[1],"0","0",h[2],h[3],"0","0","0","0","1","0",h[4],h[5],"0","1"]}return new a([parseFloat(h[0*4+0]),parseFloat(h[1*4+0]),parseFloat(h[2*4+0]),parseFloat(h[3*4+0]),parseFloat(h[0*4+1]),parseFloat(h[1*4+1]),parseFloat(h[2*4+1]),parseFloat(h[3*4+1]),parseFloat(h[0*4+2]),parseFloat(h[1*4+2]),parseFloat(h[2*4+2]),parseFloat(h[3*4+2]),parseFloat(h[0*4+3]),parseFloat(h[1*4+3]),parseFloat(h[2*4+3]),parseFloat(h[3*4+3]),])};a.prototype.multiply=function(h){var k=this.data;var g=h.data;return new a([k[0*4+0]*g[0*4+0]+k[0*4+1]*g[1*4+0]+k[0*4+2]*g[2*4+0]+k[0*4+3]*g[3*4+0],k[0*4+0]*g[0*4+1]+k[0*4+1]*g[1*4+1]+k[0*4+2]*g[2*4+1]+k[0*4+3]*g[3*4+1],k[0*4+0]*g[0*4+2]+k[0*4+1]*g[1*4+2]+k[0*4+2]*g[2*4+2]+k[0*4+3]*g[3*4+2],k[0*4+0]*g[0*4+3]+k[0*4+1]*g[1*4+3]+k[0*4+2]*g[2*4+3]+k[0*4+3]*g[3*4+3],k[1*4+0]*g[0*4+0]+k[1*4+1]*g[1*4+0]+k[1*4+2]*g[2*4+0]+k[1*4+3]*g[3*4+0],k[1*4+0]*g[0*4+1]+k[1*4+1]*g[1*4+1]+k[1*4+2]*g[2*4+1]+k[1*4+3]*g[3*4+1],k[1*4+0]*g[0*4+2]+k[1*4+1]*g[1*4+2]+k[1*4+2]*g[2*4+2]+k[1*4+3]*g[3*4+2],k[1*4+0]*g[0*4+3]+k[1*4+1]*g[1*4+3]+k[1*4+2]*g[2*4+3]+k[1*4+3]*g[3*4+3],k[2*4+0]*g[0*4+0]+k[2*4+1]*g[1*4+0]+k[2*4+2]*g[2*4+0]+k[2*4+3]*g[3*4+0],k[2*4+0]*g[0*4+1]+k[2*4+1]*g[1*4+1]+k[2*4+2]*g[2*4+1]+k[2*4+3]*g[3*4+1],k[2*4+0]*g[0*4+2]+k[2*4+1]*g[1*4+2]+k[2*4+2]*g[2*4+2]+k[2*4+3]*g[3*4+2],k[2*4+0]*g[0*4+3]+k[2*4+1]*g[1*4+3]+k[2*4+2]*g[2*4+3]+k[2*4+3]*g[3*4+3],k[3*4+0]*g[0*4+0]+k[3*4+1]*g[1*4+0]+k[3*4+2]*g[2*4+0]+k[3*4+3]*g[3*4+0],k[3*4+0]*g[0*4+1]+k[3*4+1]*g[1*4+1]+k[3*4+2]*g[2*4+1]+k[3*4+3]*g[3*4+1],k[3*4+0]*g[0*4+2]+k[3*4+1]*g[1*4+2]+k[3*4+2]*g[2*4+2]+k[3*4+3]*g[3*4+2],k[3*4+0]*g[0*4+3]+k[3*4+1]*g[1*4+3]+k[3*4+2]*g[2*4+3]+k[3*4+3]*g[3*4+3],])};a.prototype.translate=function(h,g,l){var k=new a([1,0,0,h,0,1,0,g,0,0,1,l,0,0,0,1]);return this.multiply(k)};a.prototype.inverse=function(){var y=this.data;var Q=y[0*4+0];var P=y[0*4+1];var O=y[0*4+2];var N=y[1*4+0];var M=y[1*4+1];var L=y[1*4+2];var J=y[2*4+0];var I=y[2*4+1];var z=y[2*4+2];var x=M*z-L*I;var w=L*J-N*z;var v=N*I-M*J;var u=O*I-P*z;var t=Q*z-O*J;var s=P*J-Q*I;var r=P*L-O*M;var q=O*N-Q*L;var p=Q*M-P*N;var o=Q*x+P*w+O*v;var n=new a([x/o,u/o,r/o,0,w/o,t/o,q/o,0,v/o,s/o,p/o,0,0,0,0,1]);var l=new a([1,0,0,-y[0*4+3],0,1,0,-y[1*4+3],0,0,1,-y[2*4+3],0,0,0,1]);return n.multiply(l)};a.prototype.transformPoint=function(h){var g=this.data;return new c(g[0*4+0]*h.x+g[0*4+1]*h.y+g[0*4+2]*h.z+g[0*4+3],g[1*4+0]*h.x+g[1*4+1]*h.y+g[1*4+2]*h.z+g[1*4+3],g[2*4+0]*h.x+g[2*4+1]*h.y+g[2*4+2]*h.z+g[2*4+3])};var f=false;var e=false;var d=function(h){if(e){return f}e=true;var k=h.createElement("div");k.style.cssText="width:200px;height:200px;position:fixed;-moz-transform:scale(2);";h.body.appendChild(k);var g=k.getBoundingClientRect();f=getComputedStyle(k,undefined).MozTransform!=undefined&&(g.bottom-g.top<300);k.parentNode.removeChild(k);return f};function b(k){var F=a.fromString("matrix(1,0,0,1,0,0)");var z=F;var n=k;var q=d(n.ownerDocument);while(n!=undefined&&n!==n.ownerDocument.documentElement){var m=window.getComputedStyle(n,undefined);var D=a.fromString((m.transform||m.OTransform||m.WebkitTransform||m.msTransform||m.MozTransform||"none").replace(/^none$/,"matrix(1,0,0,1,0,0)"));if(q){var v=n.getBoundingClientRect();var B=n.parentNode!=undefined&&n.parentNode.getBoundingClientRect!=undefined?n.parentNode.getBoundingClientRect():g;var s=F.translate(v.left-B.left,v.top-B.top,0);var E=m.MozTransformOrigin;E=E.indexOf("%")!==-1?"":E;E=a.fromString("matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,"+((E||"0 0")+" 0").split(" ").slice(0,3)+",1)");z=s.multiply(E).multiply(D).multiply(E.inverse()).multiply(z)}else{z=D.multiply(z)}n=n.parentNode}if(!q){var o=k.offsetWidth;var C=k.offsetHeight;var A=4;var l=+Infinity;var u=+Infinity;while(--A>=0){var y=z.transformPoint(new c(A===0||A===1?0:o,A===0||A===3?0:C,0));if(y.x<l){l=y.x}if(y.y<u){u=y.y}}var g=k.getBoundingClientRect();z=F.translate(window.pageXOffset+g.left-l,window.pageYOffset+g.top-u,0).multiply(z)}return z}window.convertPointFromPageToNode=function(h,k,g){return b(h).inverse().transformPoint(new c(k,g,0))};window.convertPointFromNodeToPage=function(h,g,k){return b(h).transformPoint(new c(g,k,0))}}());
/*!
* Copyright (c) 2011 Róbert Pataki
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
* 
* ----------------------------------------------------------------------------------------
* 
* Check out my GitHub:	http://github.com/heartcode/
* Send me an email:		heartcode@robertpataki.com
* Follow me on Twitter:	http://twitter.com/#iHeartcode
* Blog:					http://heartcode.robertpataki.com
*/
(function(o){var b=function(s,p){if(typeof(p)=="undefined"){p={}}this.init(s,p)},d=b.prototype,r,a=["canvas","vml"],e=["oval","spiral","square","rect","roundRect"],f=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=navigator.appVersion.indexOf("MSIE")!==-1&&parseFloat(navigator.appVersion.split("MSIE")[1])===8?true:false,q=!!document.createElement("canvas").getContext,g=40,m=true,n=function(p,u,s){var t=document.createElement(p),v;for(v in s){t[v]=s[v]}if(typeof(u)!=="undefined"){u.appendChild(t)}return t},k=function(s,p){for(var t in p){s.style[t]=p[t]}return s},c=function(s,p){for(var t in p){s.setAttribute(t,p[t])}return s},l=function(u,p,t,s){u.save();u.translate(p,t);u.rotate(s);u.translate(-p,-t);u.beginPath()};d.init=function(u,t){if(typeof(t.safeVML)==="boolean"){m=t.safeVML}try{if(document.getElementById(u)!==undefined){this.mum=document.getElementById(u)}else{this.mum=document.body}}catch(s){this.mum=document.body}t.id=typeof(t.id)!=="undefined"?t.id:"canvasLoader";this.cont=n("div",this.mum,{id:t.id});if(q){r=a[0];this.can=n("canvas",this.cont);this.con=this.can.getContext("2d");this.cCan=k(n("canvas",this.cont),{display:"none"});this.cCon=this.cCan.getContext("2d")}else{r=a[1];if(typeof(b.vmlSheet)==="undefined"){document.getElementsByTagName("head")[0].appendChild(n("style"));b.vmlSheet=document.styleSheets[document.styleSheets.length-1];var p=["group","oval","roundrect","fill"],v;for(var v=0;v<p.length;++v){b.vmlSheet.addRule(p[v],"behavior:url(#default#VML); position:absolute;")}}this.vml=n("group",this.cont)}this.setColor(this.color);this.draw();k(this.cont,{display:"none"})};d.cont={};d.can={};d.con={};d.cCan={};d.cCon={};d.timer={};d.activeId=0;d.diameter=40;d.setDiameter=function(p){this.diameter=Math.round(Math.abs(p));this.redraw()};d.getDiameter=function(){return this.diameter};d.cRGB={};d.color="#000000";d.setColor=function(p){this.color=f.test(p)?p:"#000000";this.cRGB=this.getRGB(this.color);this.redraw()};d.getColor=function(){return this.color};d.shape=e[0];d.setShape=function(p){var s;for(s in e){if(p===e[s]){this.shape=p;this.redraw();break}}};d.getShape=function(){return this.shape};d.density=40;d.setDensity=function(p){if(m&&r===a[1]){this.density=Math.round(Math.abs(p))<=g?Math.round(Math.abs(p)):g}else{this.density=Math.round(Math.abs(p))
}if(this.density>360){this.density=360}this.activeId=0;this.redraw()};d.getDensity=function(){return this.density};d.range=1.3;d.setRange=function(p){this.range=Math.abs(p);this.redraw()};d.getRange=function(){return this.range};d.speed=2;d.setSpeed=function(p){this.speed=Math.round(Math.abs(p))};d.getSpeed=function(){return this.speed};d.fps=24;d.setFPS=function(p){this.fps=Math.round(Math.abs(p));this.reset()};d.getFPS=function(){return this.fps};d.progressText="";d.setProgressText=function(p){this.progressText=p};d.getProgressText=function(){return this.progressText};d.getRGB=function(p){p=p.charAt(0)==="#"?p.substring(1,7):p;return{r:parseInt(p.substring(0,2),16),g:parseInt(p.substring(2,4),16),b:parseInt(p.substring(4,6),16)}};d.draw=function(){var D=0,C,A,E,z,v,M,p,P,L=this.density,N=Math.round(L*this.range),t,Q=0,B,G,O,H,J=1000,u=0,K=this.cCon,F=this.diameter,I=0.47;if(r===a[0]){K.clearRect(0,0,J,J);c(this.can,{width:F,height:F});c(this.cCan,{width:F,height:F});while(D<L){t=D<=N?1-((1-Q)/N*D):t=Q;M=270-360/L*D;p=M/180*Math.PI;K.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+t.toString()+")";switch(this.shape){case e[0]:case e[1]:C=F*0.07;z=F*I+Math.cos(p)*(F*I-C)-F*I;v=F*I+Math.sin(p)*(F*I-C)-F*I;K.beginPath();if(this.shape===e[1]){K.arc(F*0.5+z,F*0.5+v,C*t,0,Math.PI*2,false)}else{K.arc(F*0.5+z,F*0.5+v,C,0,Math.PI*2,false)}break;case e[2]:C=F*0.12;z=Math.cos(p)*(F*I-C)+F*0.5;v=Math.sin(p)*(F*I-C)+F*0.5;l(K,z,v,p);K.fillRect(z,v-C*0.5,C,C);break;case e[3]:case e[4]:A=F*0.3;E=A*0.27;z=Math.cos(p)*(E+(F-E)*0.13)+F*0.5;v=Math.sin(p)*(E+(F-E)*0.13)+F*0.5;l(K,z,v,p);if(this.shape===e[3]){K.fillRect(z,v-E*0.5,A,E)}else{P=E*0.55;K.moveTo(z+P,v-E*0.5);K.lineTo(z+A-P,v-E*0.5);K.quadraticCurveTo(z+A,v-E*0.5,z+A,v-E*0.5+P);K.lineTo(z+A,v-E*0.5+E-P);K.quadraticCurveTo(z+A,v-E*0.5+E,z+A-P,v-E*0.5+E);K.lineTo(z+P,v-E*0.5+E);K.quadraticCurveTo(z,v-E*0.5+E,z,v-E*0.5+E-P);K.lineTo(z,v-E*0.5+P);K.quadraticCurveTo(z,v-E*0.5,z+P,v-E*0.5)}break}K.closePath();K.fill();K.restore();++D}}else{k(this.cont,{width:F,height:F});k(this.vml,{width:F,height:F});switch(this.shape){case e[0]:case e[1]:O="oval";C=J*0.14;break;case e[2]:O="roundrect";C=J*0.12;break;case e[3]:case e[4]:O="roundrect";C=J*0.3;break}A=E=C;z=J*0.5-E;v=-E*0.5;while(D<L){t=D<=N?1-((1-Q)/N*D):t=Q;M=270-360/L*D;switch(this.shape){case e[1]:A=E=C*t;z=J*0.5-C*0.5-C*t*0.5;v=(C-C*t)*0.5;break;case e[0]:case e[2]:if(h){v=0;if(this.shape===e[2]){z=J*0.5-E*0.5}}break;case e[3]:case e[4]:A=C*0.95;E=A*0.28;if(h){z=0;v=J*0.5-E*0.5}else{z=J*0.5-A;v=-E*0.5}u=this.shape===e[4]?0.6:0;break}G=c(k(n("group",this.vml),{width:J,height:J,rotation:M}),{coordsize:J+","+J,coordorigin:-J*0.5+","+(-J*0.5)});B=k(n(O,G,{stroked:false,arcSize:u}),{width:A,height:E,top:v,left:z});H=n("fill",B,{color:this.color,opacity:t});++D}}this.tick(true)};d.clean=function(){if(r===a[0]){this.con.clearRect(0,0,1000,1000)}else{var p=this.vml;if(p.hasChildNodes()){while(p.childNodes.length>=1){p.removeChild(p.firstChild)}}}};d.redraw=function(){this.clean();this.draw()};d.reset=function(){if(typeof(this.timer)==="number"){this.hide();this.show()}};d.tick=function(s){var t=this.con,p=this.diameter;if(!s){this.activeId+=360/this.density*this.speed}if(r===a[0]){t.clearRect(0,0,p,p);l(t,p*0.5,p*0.5,this.activeId/180*Math.PI);t.drawImage(this.cCan,0,0,p,p);t.restore();if(this.progressText!=""){t.font="bold 12px Arial";t.fillStyle="rgb("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+")";t.textAlign="center";t.textBaseline="middle";t.fillText(this.progressText,p/2,p/2)}}else{if(this.activeId>=360){this.activeId-=360}k(this.vml,{rotation:this.activeId})}};d.show=function(){if(typeof(this.timer)!=="number"){var p=this;this.timer=self.setInterval(function(){p.tick()},Math.round(1000/this.fps));k(this.cont,{display:"block"})}};d.hide=function(){if(typeof(this.timer)==="number"){clearInterval(this.timer);delete this.timer;k(this.cont,{display:"none"})}};d.kill=function(){var s=this.cont;if(typeof(this.timer)==="number"){this.hide()}if(r===a[0]){s.removeChild(this.can);s.removeChild(this.cCan)}else{s.removeChild(this.vml)}var p;for(p in this){delete this[p]}};o.CanvasLoader=b}(window));
/*!
 * Atomi HTML5 Player - Player's Core Scripts
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2018/04/06
 *
 */
var mediaStats=g_arrSlides[g_arrSlides.length-2].media_stats;$(document).ready(function(){BrowserInfo.Init();if(BrowserInfo.ie&&BrowserInfo.GetIEVersion()<9){document.write(Lang.NeedUpdateBrowser);return}if(TemplateParams.ImagePath===undefined){TemplateParams.ImagePath="player/images/"}if(!BrowserInfo.canChangeVolume){TemplateParams.ShowVolumeBar=false;TemplateParams.ShowVolumeBtn=false}if(!BrowserInfo.canChangePlaybackRate){TemplateParams.ShowSpeedBtn=false}MediaManager.Init();if(!MediaManager.canPlayMedia&&!Options.GenPreview){document.write(Lang.NeedUpdateBrowser);return}$.facebox.settings.loadingImage=UI.PlayerImageUrl("blank.gif");$.facebox.settings.closeImage=UI.PlayerImageUrl("closelabel.gif");if(mediaStats.nb_youtube_video>0){if(BrowserInfo.ie||BrowserInfo.edge){if(window.location.protocol=="file:"){alert(Lang.YouTubeIEError)}}var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);$(document).oneTime(30*1000,"tm_RL_YT_API",function(){if(Prez.YTState==RL_YT_State.NOT_LOADED){Prez.YTState=RL_YT_State.TIMEOUT;alert(Lang.YouTubeError);OnLoad()}})}else{OnLoad()}});function onYouTubeIframeAPIReady(){$(document).stopTime("tm_RL_YT_API");if(Prez.YTState==RL_YT_State.NOT_LOADED){Prez.YTState=RL_YT_State.LOADED;OnLoad()}}function OnLoad(){$(window).bind((BrowserInfo.iDevice?"pagehide":"unload"),OnUnload);if(bSendToLMS){Prez.LMS.Initialize();Prez.LMS.LoadSuspendData()}Prez.Init()}function OnUnload(){$(window).unbind((BrowserInfo.iDevice?"pagehide":"unload"),OnUnload);Prez.Unload();if(bSendToLMS){Prez.LMS.Terminate()}}var Prez={INTERVAL:100,PreLoader:null,slideUI:null,prjSlideBot:null,prjSldBotUI:null,prjSlideTop:null,prjSldTopUI:null,Scale:1,playbackRate:1,muted:false,volume:80,started:false,complete:false,runningStreams:PrezStreams.ALL,shouldResumeStreams:PrezStreams.NONE,nBufferingCount:0,YTState:RL_YT_State.NOT_LOADED,slideDurationPercents:[],GetSlide:function(){return this.slideUI},GetObject:function(a){return(this.slideUI&&this.slideUI.GetObject(a))||(this.prjSldBotUI&&this.prjSldBotUI.GetObject(a))||(this.prjSldTopUI&&this.prjSldTopUI.GetObject(a))||null},Session:{PMode:PlayModes.TUT,User:"",Elapsed:0,savedTime:0,SlideIndex:0,RestoreData:{slides:[],index:0,ts:0,randomSlideMap:{},},Navigation:{slides:[],index:0,navigating:false,goBackward:function(){var a=this.slides[this.index-1];if(a){this.navigating=true;--this.index;Prez.ShowSlide(a);this.navigating=false}},goForward:function(){var a=this.slides[this.index+1];if(a){this.navigating=true;++this.index;Prez.ShowSlide(a);this.navigating=false}},addNew:function(a){if(!a||this.navigating||a==this.slides[this.index]){return}if(this.index>=0&&this.index<this.slides.length-1){this.slides.length=this.index+1}this.slides.push(a);this.index=this.slides.length-1},clear:function(){this.slides.length=0;this.index=0;this.navigating=false}}},Init:function(){if(TemplateParams.IniVolume!==undefined){this.volume=LimitValue(TemplateParams.IniVolume,0,100);if(this.volume==0){this.muted=true;this.volume=80}}var b={};for(var o in g_objPools){b[o]={};b[o]["slideIdxs"]=[];b[o]["currentIdx"]=0;b[o]["slideIdxs"]=RandomPermutation(g_objPools[o].length)}var p=0,e=[],h;for(var g=0;g<g_arrSlides.length-2;g++){var d=g_arrSlides[g].linkedPool;if(g_arrSlides[g].randomSlide&&d!=undefined&&g_objPools[d]!=undefined){var k=b[d];if(k.currentIdx>=k.slideIdxs.length){k.currentIdx=0}var m=k.slideIdxs[k.currentIdx];var l=g_objPools[d][m].id;if(this.Session.RestoreData.randomSlideMap!=undefined&&this.Session.RestoreData.randomSlideMap[g_arrSlides[g].id]!=undefined){l=this.Session.RestoreData.randomSlideMap[g_arrSlides[g].id]
}else{this.Session.RestoreData.randomSlideMap[g_arrSlides[g].id]=l}for(var o in g_objPools){for(var f=0;f<g_objPools[o].length;f++){if(g_objPools[o][f].id==l){g_arrSlides[g]=jQuery.extend(true,{},g_objPools[o][f])}}}k.currentIdx++}g_arrSlides[g]["startTime"]=p;h=g_arrSlides[g]["duration"];e.push(h);p+=h}this.slideDurationPercents=[];for(var g=0;g<e.length;++g){this.slideDurationPercents.push(e[g]/p)}this.EscapeHTMLEntities();if(!this.prjSlideBot&&!this.prjSlideTop){var a=this.GetExportedSlides();for(var g=0,c=a.length;g<c;++g){a[g].idx=g}this.prjSlideTop=a.pop();this.prjSlideTop.duration=p;this.prjSlideBot=a.pop();this.prjSlideBot.duration=p;if(Options.test_max_time){Options.test_max_time*=60000}}UI.Init();this.PreLoad()},Start:function(e,d,a){this.started=true;this.SessionStop();if(e==undefined){e=this.GetInitialPlayMode()}this.Session.PMode=e;if(this.prjSldBotUI){this.prjSldBotUI.CleanUp();this.prjSldBotUI=null}if(this.prjSldTopUI){this.prjSldTopUI.CleanUp();this.prjSldTopUI=null}if(this.slideUI){this.slideUI.CleanUp();this.slideUI=null}this.SessionStart();this.complete=false;if(bSendToLMS){Prez.LMS.StartLesson()}var c=this.Session.RestoreData;if(d!==undefined){c.index=d}if(a!==undefined){c.ts=a}c.index=c.index||0;c.ts=c.ts||0;var b=this.GetSlideCompletions();if(UI.SlideList){UI.SlideList.MarkComplete(b);UI.SlideList.MarkComplete(false,c.index)}this.prjSldBotUI=new SlideUI(this.prjSlideBot);if(this.GetSlideCount()<=0){UI.ShowMsg(Lang.NoSlide,true,true);return}MediaManager.InitPlayers(function(){this.ShowSlide(this.GetExportedSlideAt(c.index),c.ts)},this)},SessionStart:function(){UI.OnPrezStart();InitHandlers();this.InitBGTask();this.runningStreams=PrezStreams.ALL;this.shouldResumeStreams=PrezStreams.NONE;this.nBufferingCount=0;if(UI.Toolbar){UI.Toolbar.SetPause(false)}this.Session.Elapsed=0;this.Session.savedTime=(new Date).getTime();this.Session.SlideIndex=0;this.Session.Navigation.clear();if(this.prjSlideBot&&this.prjSlideBot.onload!==undefined){EvtMan.DoAction({type:ActType.SCRIPT,dat:this.prjSlideBot.onload})}if(BrowserInfo.mobile){this.savedRunningStreams=PrezStreams.NONE;$(document).on("hide.visibility",function(){this.savedRunningStreams=Prez.Pause(PrezStreams.ALL)});$(document).on("show.visibility",function(){Prez.Resume(this.savedRunningStreams);this.savedRunningStreams=PrezStreams.NONE})}},SessionStop:function(){if(BrowserInfo.mobile){$(document).off("show.visibility","**");$(document).off("hide.visibility","**")}RemoveHandlers();this.Session.User="";this.Session.Elapsed=0;this.Session.SlideIndex=0;this.StopBGTask();UI.CleanUp()},Restart:function(b,a){if(!b){b=0}this.ClearAllResults();this.Session.RestoreData.index=b;if(bSendToLMS){Prez.LMS.StoreSuspendData(Prez.Session.RestoreData,true)}this.Start(Prez.Session.PMode,b,a)},IsRunning:function(){return this.runningStreams==PrezStreams.ALL},Pause:function(a){a&=this.runningStreams;if(a==PrezStreams.NONE){return a}if(this.nBufferingCount>0&&!this._startBuffering){this.shouldResumeStreams&=~a;return a}this.runningStreams&=~a;EffectMan.UpdatePrezStateChanged();if(this.prjSldBotUI){this.prjSldBotUI.UpdatePrezStateChanged()}if(this.prjSldTopUI){this.prjSldTopUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(!this.IsRunning())}return a},Resume:function(a){a&=~this.runningStreams;if(a==PrezStreams.NONE){return a}if(this.nBufferingCount>0){this.shouldResumeStreams|=a;return a}this.runningStreams|=a;EffectMan.UpdatePrezStateChanged();if(this.prjSldBotUI){this.prjSldBotUI.UpdatePrezStateChanged()}if(this.prjSldTopUI){this.prjSldTopUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(!this.IsRunning())}return a},Unload:function(){if(!this.started||this.complete){return}if(bSendToLMS){Prez.LMS.StoreSuspendData(this.Session.RestoreData,true)}},UpdatePrezPropertyChanged:function(a,b){if(this.prjSldBotUI){this.prjSldBotUI.UpdatePrezPropertyChanged(a,b)}if(this.prjSldTopUI){this.prjSldTopUI.UpdatePrezPropertyChanged(a,b)}if(this.slideUI){this.slideUI.UpdatePrezPropertyChanged(a,b)}},SetPlaybackRate:function(a){this.playbackRate=a;EffectMan.UpdatePlaybackRateChanged();this.UpdatePrezPropertyChanged("PlaybackRate",a)},GetPlaybackRate:function(){return this.playbackRate},EscapeHTMLEntities:function(){var d=g_arrSlides.length;for(var c=0;c<d;c++){var a=g_arrSlides[c];a.name=jQuery("<div/>").html(a.name).html();a.description=jQuery("<div/>").html(a.description).html();if(a.hasOwnProperty("ctrls")){var b=a.ctrls.length;for(j=0;j<b;j++){var e=a.ctrls[j];if(e.hasOwnProperty("html")){e.html=jQuery("<div/>").html(e.html).html()}}}}},GiveAwayResumeToken:function(){if(this.prjSldBotUI&&this.prjSldBotUI.AcceptResumeToken()){return true}if(this.prjSldTopUI&&this.prjSldTopUI.AcceptResumeToken()){return true}if(this.slideUI&&this.slideUI.AcceptResumeToken()){return true}return false},StartBuffering:function(){if(this.nBufferingCount!=0){return}this.nBufferingCount=1;var a=this.runningStreams;this._startBuffering=true;this.Pause(this.runningStreams);this._startBuffering=false;this.shouldResumeStreams=a;this.UpdateBufferingUI()},BufferingEnded:function(){if(this.nBufferingCount!=0){return}this.UpdateBufferingUI();var a=true;if(BrowserInfo.fixDelayedPlaying){if(this.GiveAwayResumeToken()){a=false}}if(a){this.Resume(this.shouldResumeStreams);this.shouldResumeStreams=PrezStreams.NONE}},IsBuffering:function(){return this.nBufferingCount!=0},IncBufferingCount:function(){Log("Prez.IncBufferingCount: to "+(this.nBufferingCount+1));if(this.nBufferingCount==0){this.StartBuffering()}else{this.nBufferingCount++}},DecBufferingCount:function(){if(this.nBufferingCount==0){Log("Prez.DecBufferingCount: Invalid counter");return}Log("Prez.DecBufferingCount: to"+(this.nBufferingCount-1));this.nBufferingCount--;if(this.nBufferingCount==0){this.BufferingEnded()}},UpdateBufferingUI:function(){if(this.nBufferingCount==0){$(this).stopTime("tm_Buffering");UI.ShowLoading("StageDiv",false)}else{$(this).oneTime(500,"tm_Buffering",function(){UI.ShowLoading("StageDiv",true)})}},TogglePause:function(){if(this.complete||this.nBufferingCount>0){return}if(this.IsRunning()){this.Pause(PrezStreams.ALL);if(Prez.Session.PMode==PlayModes.DEMO){UI.ShowBigPlayButton("StageDiv",true)}}else{if(Prez.Session.PMode==PlayModes.DEMO){UI.ShowBigPlayButton("StageDiv",false)}this.Resume(PrezStreams.ALL)}},GetExportedSlides:function(){return g_arrSlides},GetSlideCount:function(){return this.GetExportedSlides().length},GetExportedSlideAt:function(a){return this.GetExportedSlides()[a]||null},GetExportedSlide:function(a){var c=this.Session.RestoreData.randomSlideMap[a];if(c!=undefined){a=c}var d=this.GetExportedSlides();for(var b=0;b<d.length;++b){if(d[b].id==a){return d[b]}}return null},ShowSlide:function(a,f){if(typeof a=="number"){a=this.GetExportedSlideAt(a-1)}if(this.complete){this.Restart(a?a.idx:0,a?f:0);return}if(this.slideUI&&this.slideUI.slide!=a&&((this.slideUI.IsEnd()&&this.IsRunning())||this.Session.RestoreData.slides[this.slideUI.slide.idx])){if(UI.SlideList){UI.SlideList.MarkComplete(true,this.slideUI.GetIndex())}this.slideUI.GetSubmitedDataObject()}if(!a){if(!this.slideUI||(this.slideUI.GetIndex()==this.GetSlideCount()-1)){if(this.prjSlideBot&&UI.Toolbar){this.prjSldBotUI.ts=this.prjSlideBot.duration;UI.Toolbar.SetProgress(this.slideUI.GetIndex(),this.prjSldBotUI.ts)}if(this.prjSlideTop){this.prjSlideTop.ts=this.prjSlideTop.duration}this.OnPrezEnd(false)}return}this.preSlideUI=null;if(this.slideUI&&this.slideUI.slide!==a){this.slideUI.CleanUp();this.preSlideUI=this.slideUI;this.slideUI=null;if(this.prjSldTopUI){this.prjSldTopUI.CleanUp();this.prjSldTopUI=null}}var c=PrezStreams.NONE;if(this.nBufferingCount>0||this.runningStreams!=PrezStreams.NONE){c=PrezStreams.ALL}this.nBufferingCount=0;this.shouldResumeStreams=PrezStreams.NONE;this.UpdateBufferingUI();var d=this.slideUI,b=this.prjSldTopUI;this.slideUI=null;this.prjSldTopUI=null;this.Resume(c);
if(!d){d=new SlideUI(a)}this.slideUI=d;if(!b){b=new SlideUI(this.prjSlideTop)}this.prjSldTopUI=b;f=f||0;this.slideUI.LoadSubmitedData();this.slideUI.Show(f,function(){Prez.preSlideUI=null});var e=a.startTime+f;if(UI.Toolbar){UI.Toolbar.SetProgress(a.idx,e)}if(UI.SlideList){UI.SlideList.SetCurrentSlide(a.idx)}if(this.prjSldBotUI){if(Prez.prjSldBotUI.ts<0||Math.abs(e-Prez.prjSldBotUI.ts)>Prez.INTERVAL*Prez.playbackRate){Prez.prjSldBotUI.Show(e)}}Prez.prjSldTopUI.Show(e);Prez.Session.RestoreData.index=this.Session.SlideIndex;Prez.Session.RestoreData.ts=f;if(bSendToLMS){Prez.LMS.SetBookmark(a,this.Session.SlideIndex);Prez.LMS.StoreSuspendData(Prez.Session.RestoreData,true)}this.Session.Navigation.addNew(a)},ShowNextSlide:function(){this.ShowSlide(this.GetExportedSlideAt(this.Session.SlideIndex+1),0)},ShowPreviousSlide:function(){this.ShowSlide(this.GetExportedSlideAt(this.Session.SlideIndex-1),0)},ShowPreviousVisitedSlide:function(){this.Session.Navigation.goBackward()},ShowNextVisitedSlide:function(){this.Session.Navigation.goForward()},ShowSlideByIndex:function(a){this.ShowSlide(this.GetExportedSlideAt(a),0)},ShowSlideByID:function(a){this.ShowSlide(this.GetExportedSlide(a),0)},HandleSlideLoadingError:function(a){a+="\n"+Lang.ConfirmNextSlide;if(confirm(a)){}},saved:{slide:null,slideTs:0},ShouldDoNextAction:function(){var a=true;if(!this.slideUI||(this.saved.slide!=this.slideUI.slide||this.saved.slideTs>this.slideUI.ts)){a=false;this.saved.slide=null;this.saved.slideTs=0}return a},GetSlideImgUrls:function(h,l,d,e){var c=h.ctrls,k=h.id;function g(p){if(p.slideContainerID!=undefined){k=p.slideContainerID}switch(p.kind){case CtrlKind.TOGGLE:case CtrlKind.COMBO:if(p.image&&$.inArray(p.image,d)<0){e.push("data/res_"+p.image+".png");d.push(p.image)}break;case CtrlKind.AUDIO:case CtrlKind.YOUTUBE:case CtrlKind.WEBOBJECT:break;case CtrlKind.VIDEO:if(p.video>0){e.push("data/vstart_img_"+k+"."+p.id+".jpg");e.push("data/vend_img_"+k+"."+p.id+".jpg")}break;case CtrlKind.ANSWER:case CtrlKind.QUIZ:var m=p.ctrls,o;for(var o=0,n=m.length;o<n;++o){g(m[o])}break;default:if(p.shape&&p.shape.fill&&p.shape.fill.img_id&&$.inArray(p.shape.fill.img_id,d)<0){e.push("data/res_"+p.shape.fill.img_id+".png");d.push(p.shape.fill.img_id)}if(!p.shape){e.push("data/img_"+k+"."+p.id+".png")}break}}if(l){e.push("data/slide_"+k+"."+Options.image_format)}for(var f=0,b=c.length;f<b;++f){g(c[f])}if(h.cursor){var a=h.cursor.cursors;for(var f=0,b=a.length;f<b;++f){if(a[f].img&&a[f].img.id){e.push("data/res_"+a[f].img.id+".png")}}}},PreLoad:function(){if(this.PreLoader){this.PreLoader.Cancel();this.PreLoader=null}var l=UI.ViewPort();var f=Math.min(l.width(),$(window).innerWidth());var p=Math.min(l.height(),$(window).innerHeight());var m=f-20,o=24,a,c;if(m>400){m=400}a=Math.floor((f-m)/2);c=Math.floor((p-o)/2);UI.ShowLoading("ViewPortDiv",true,ToLocalNumber(0,PrezInfo.Language)+"%");var h=[],g=[],b=this.GetExportedSlides();h=[UI.PlayerImageUrl("aplogo.png"),UI.PlayerImageUrl("blank.gif"),UI.PlayerImageUrl("b.png"),UI.PlayerImageUrl("bl.png"),UI.PlayerImageUrl("icons.png"),UI.PlayerImageUrl("br.png"),UI.PlayerImageUrl("tl.png"),UI.PlayerImageUrl("tr.png"),UI.PlayerImageUrl("closelabel.gif")];APTheme.GetImages(h);h.push("data/"+g_closedCaption.bgimg);this.GetSlideImgUrls(this.prjSlideBot,false,g,h);this.GetSlideImgUrls(this.prjSlideTop,false,g,h);for(var k=0,e=b.length;k<e;++k){this.GetSlideImgUrls(b[k],!b[k].bg,g,h)}var d=h.length;if(!d){this.Start();return}var q={imgs:h,progress:function(s,n){var r=Math.floor((100*s)/n);UI.ShowLoading("ViewPortDiv",true,ToLocalNumber(r,PrezInfo.Language)+"%")},complete:function(){$(Prez).stopTime("startprez");UI.ShowLoading("ViewPortDiv",true,ToLocalNumber(100,PrezInfo.Language)+"%");window.setTimeout(function(){UI.ShowLoading("ViewPortDiv",false);if(!Prez.started){Prez.Start()}},100)}};$(this).oneTime(2*60*1000,"startprez",function(){if(!Prez.started){UI.ShowLoading("ViewPortDiv",false);Prez.Start()}});this.PreLoader=$.PreLoad(q)},InitBGTask:function(){$(this).everyTime(this.INTERVAL,"BGTask",Prez.OnTimerTick)},StopBGTask:function(){$(this).stopTime("BGTask")},GetInitialPlayMode:function(){if(g_nInitialMode!=undefined){return g_nInitialMode}else{return PlayModes.TUT}},SwitchMode:function(a){if(a!=undefined){Prez.Session.PMode=a}UI.OnPrezStart(true);this.LoadSlideByIndex(Prez.Session.SlideIndex)},ToggleClosedCaption:function(){ClosedCaptionUI.ToggleShow()},Close:function(a){if((a)&&(confirm(Lang.ConfirmQuit)==false)){return}window.close()},GoFirst:function(){this.ShowSlideByIndex(0)},GoNext:function(){if(this.Session.SlideIndex<this.GetSlideCount()-1){this.ShowSlideByIndex(this.Session.SlideIndex+1)}},GoPrev:function(){if(this.Session.SlideIndex>=1){this.ShowSlideByIndex(this.Session.SlideIndex-1)}},GoLast:function(){if(this.Session.SlideIndex!=this.GetSlideCount()-1){this.ShowSlideByIndex(this.GetSlideCount()-1)}},IsMuted:function(){return this.muted},Mute:function(a){if(a===undefined){a=true}this.muted=a;if(this.slideUI){this.slideUI.Mute(a)}if(this.prjSldBotUI){this.prjSldBotUI.Mute(a)}if(this.prjSldTopUI){this.prjSldTopUI.Mute(a)}if(UI.Toolbar){UI.Toolbar.SetMute(a)}},SetVolume:function(a){a=LimitValue(a,0,100);this.volume=a;this.muted=false;if(this.slideUI){this.slideUI.SetVolume(a)}if(this.prjSldBotUI){this.prjSldBotUI.SetVolume(a)}if(this.prjSldTopUI){this.prjSldTopUI.SetVolume(a)}if(UI.Toolbar){UI.Toolbar.SetVolumeValue(a);UI.Toolbar.SetMute(false)}},GetVolume:function(a){if(a&&this.muted){return 0}return this.volume},GetSlideCompletions:function(){var a={};var c=this.Session.RestoreData.slides;if(c&&c.length){for(var b=0,d=c.length;b<d;++b){if(c[b]){a[b]=true}}}return a},GetResult:function(){var b=true;switch(Options.pass_condition){case PassCondition.PERCENT:case PassCondition.POINTS:var c=Prez.GetPoints();if(Options.pass_condition==PassCondition.POINTS){b=(c>=Options.pass_value)}else{var a=Prez.GetMaxPoints();if(a>0){b=(parseInt(c*100/a)>=Options.pass_value)}}break;case PassCondition.ANSWERS:b=(Prez.GetTakenInteractionCount(Judge.CORRECT)>=Options.pass_value);break;case PassCondition.SLIDESVIEWED:b=(Prez.GetTakenSlideCount()>=Options.pass_value);break}return b},GetPoints:function(){var e=0;var d=Prez.Session.RestoreData.slides;if(!d){return 0}var g=d.length;for(var c=0;c<g;++c){var f=d[c];if(!f){continue}for(var b in f){var a=f[b];if(!a||!a.p){continue}e+=a.p}}return e},GetMaxPoints:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetExportedSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];d+=Prez.GetCtrlMaxPoints(f,true)}}return d},GetCtrlMaxPoints:function(b,a){if(!b){return 0}if(a==true){if(b.evt&&(b.evt.mod&EvtMode.SURVEY)){return 0}}if(b.kind==CtrlKind.INPUT){if(b.type==InputUI.KEY){return Prez.GetEvtMaxPoints(b.evt,EvtType.KEY_DOWN)}else{if(b.type==InputUI.MOUSE){return Prez.GetEvtMaxPoints(b.evt,EvtType.CLICK)}else{return 0}}}else{if(b.kind==CtrlKind.TEXTINPUT){return Prez.GetEvtMaxPoints(b.evt,EvtType.TEXT)}else{if(b.kind==CtrlKind.DROP){return Prez.GetEvtMaxPoints(b.evt,EvtType.ACCEPT_SPECIFIC)}else{if(b.kind==CtrlKind.QUIZ){return Prez.GetQuizMaxPoint(b)}}}}return 0},GetQuizMaxPoint:function(c){var l=!(c.evt.mod&EvtMode.SURVEY);if(!l){return 0}var n=((c.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE);var p=0,h;var d=c.ctrls,a=d.length,g,o,k,q,e;switch(c.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:if(n){for(g=0;g<a;++g){o=d[g];if(!o||o.kind!=CtrlKind.ANSWER||!o.ctrls){continue}k=undefined;for(e=0;e<o.ctrls.length;++e){if(o.ctrls[e].kind==CtrlKind.TOGGLE){k=o.ctrls[e]}}if(!k||!k.evt){continue}q=k.evt[EvtType.CHECK];if(!q||!q.all){continue}h=q.all.pt||0;if(c.type==QuizUI.Type.MULTI_RESPONSE){if(k.checked){p=p+h}}else{if(h>p){p=h}}}}else{p=c.evt.pt}break;case QuizUI.Type.SEQUENCE_DRAGDROP:p=c.evt.pt;break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(g=0;g<a;++g){o=d[g];if(o&&o.kind==CtrlKind.TEXTINPUT){p=Prez.GetCtrlMaxPoints(o);
break}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:if(n){for(g=0;g<a;++g){o=d[g];if(!o||o.kind!=CtrlKind.ANSWER){continue}k=undefined;for(e=0;e<o.ctrls.length;++e){if(o.ctrls[e].kind==CtrlKind.TEXTINPUT){k=o.ctrls[e]}}if(!k){continue}p+=Prez.GetCtrlMaxPoints(k)}}else{p=c.evt.pt}break;case QuizUI.Type.MATCH_DRAGDROP:if(n){var b,f,m;for(var b in c.dragdrops){m=c.dragdrops[b];if(m){h=0;for(var f in m){if(!isNaN(m[f])&&m[f]>h){h=m[f]}}p+=h}}}else{p=c.evt.pt}break}return p},GetEvtMaxPoints:function(f,h,c){if(!f){return 0}if(c==true){if(f&&(f.mod&EvtMode.SURVEY)){return 0}}var e=0;if(f.mod&EvtMode.PARTIAL_SCORE){var g=f[h],k;if(g&&(typeof g==="object")){if($.isArray(g)){for(var d=0,b=g.length;d<b;++d){k=g[d].pt;if(k>e){e=k}}}else{for(var a in g){k=g[a].pt;if(k>e){e=k}}}}}else{e=f.pt||0}return e},GetRequirements:function(){switch(Options.pass_condition){case PassCondition.PERCENT:return Lang.RequirePercent.format(ToLocalNumber(Options.pass_value,PrezInfo.Language));case PassCondition.POINTS:return Lang.RequirePoints.format(ToLocalNumber(Options.pass_value,PrezInfo.Language));case PassCondition.ANSWERS:return Lang.RequireAnswers.format(ToLocalNumber(Options.pass_value,PrezInfo.Language));case PassCondition.SLIDESVIEWED:return Lang.RequireSlidesViewed.format(ToLocalNumber(Options.pass_value,PrezInfo.Language))}return Lang.RequireNone},ClearAllResults:function(){Prez.Session.RestoreData.slides=[];Prez.Session.RestoreData.index=0;Prez.Session.RestoreData.ts=0},GetInteractionCount:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetExportedSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];if(!f){continue}if(f.kind==CtrlKind.INPUT){if(f.type!=InputUI.MOUSE_HOVER&&!(f.evt.mod&EvtMode.NO_REPORT)){d++}}else{if(f.kind==CtrlKind.TEXTINPUT||f.kind==CtrlKind.QUIZ||f.kind==CtrlKind.DROP){if(!(f.evt.mod&EvtMode.NO_REPORT)){d++}}}}}return d},GetTakenInteractionCount:function(b){var d=0;var f=Prez.Session.RestoreData.slides;if(!f){return 0}var h=f.length;for(var e=0;e<h;++e){var g=f[e];if(!g){continue}for(var c in g){var a=g[c];if(!a||!a.j||!a.r){continue}if(b==undefined||a.j==b){d++}}}return d},GetTakenSlideCount:function(){var a=0;var c=Prez.Session.RestoreData.slides;if(!c){return 0}var e=c.length;for(var b=0;b<e;++b){var d=c[b];if(d){a++}}return a},_FindCtrlById:function(a,b){var d,f=a?a.length:0,c,e;for(d=0;d<f;++d){e=a[d];if(e.id==b){return e}if(e.ctrls){c=Prez._FindCtrlById(e.ctrls,b);if(c){return c}}}return null},GetCorrectResponse:function(a,l){var b,t,B,r,x;switch(l.kind){case CtrlKind.INPUT:x=l.evt[l.type==InputUI.MOUSE?EvtType.CLICK:EvtType.KEY_DOWN];b=[];if(x){for(B=0,r=x.length;B<r;++B){if(l.type==InputUI.MOUSE){b.push(Mouse.GetDisplayName(x[B].val))}else{b.push(Key.GetDisplayName(x[B].val))}}}break;case CtrlKind.TEXTINPUT:x=l.evt[EvtType.TEXT];b=[];if(x){for(B=0,r=x.length;B<r;++B){b.push(x[B].val)}}break;case CtrlKind.DROP:x=l.evt[EvtType.ACCEPT_SPECIFIC];b=[];if(x){var q,u,F;for(u in x){if(x.hasOwnProperty(u)){q=Prez._FindCtrlById(a.ctrls,u);if(q&&q.reportid){F=q.reportid}else{F=""+a.idx+"_"+u}b.push(F)}}}break;case CtrlKind.QUIZ:var c=l.ctrls,s,y;switch(l.type){case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.MULTI_RESPONSE:b=[];t=[];for(B=0,r=c.length;B<r;++B){if(c[B].kind!=CtrlKind.ANSWER){continue}var f=false,E;for(y=0,s=c[B].ctrls.length;y<s;++y){if(c[B].ctrls[y].kind==CtrlKind.TOGGLE){f=c[B].ctrls[y].checked;break}}if(f){E=c[B].reportid||(a.idx+"_"+c[B].id);t.push(E)}}b.push(t);break;case QuizUI.Type.SEQUENCE_DRAGDROP:b=[];t=[];for(y=0,s=l.ansPos.length;y<s;++y){var g=l.ansPos[y],E;for(B=0,r=c.length;B<r;++B){if(c[B].kind!=CtrlKind.NOTE||c[B].type!=NoteType.ANSWER){continue}var w=c[B].rect;if(g.top==w.t&&g.left==w.l){E=c[B].reportid||(a.idx+"_"+c[B].id);t.push(E);break}}}b.push(t);break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:b=[];for(B=0,r=c.length;B<r;++B){if(c[B].kind!=CtrlKind.TEXTINPUT){continue}if(c[B].evt){x=c[B].evt[EvtType.TEXT];if(x){for(y=0,s=x.length;y<s;++y){b.push(x[y].val)}}}break}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:b=[];for(B=0,r=c.length;B<r;++B){if(c[B].kind!=CtrlKind.ANSWER){continue}var E=c[B].reportid||(a.idx+"_"+c[B].id);for(y=0,s=c[B].ctrls.length;y<s;++y){if(c[B].ctrls[y].kind!=CtrlKind.TEXTINPUT){continue}if(c[B].ctrls[y].evt){x=c[B].ctrls[y].evt[EvtType.TEXT];if(x){var v,p=x.length,e,C,o;if(b.length>0){e=b;b=[];for(C=0;C<e.length;++C){for(v=0;v<p;++v){o=$.extend({},e[C]);o[E]=x[v].val;b.push(o)}}}else{for(v=0;v<p;++v){o={};o[E]=x[v].val;b.push(o)}}}}break}}break;case QuizUI.Type.MATCH_DRAGDROP:b=[];t={};var D=l.dragdrops,u,A,z,F,d,q,H,G;for(u in D){if(D.hasOwnProperty(u)){q=Prez._FindCtrlById(a.ctrls,u);if(q&&q.reportid){F=q.reportid}else{F=""+a.idx+"_"+u}z=D[u];G=b;b=[];for(A in z){if(z.hasOwnProperty(A)){H=Prez._FindCtrlById(a.ctrls,A);if(H&&H.reportid){d=H.reportid}else{d=""+a.idx+"_"+A}if(G.length==0){t={};t[F]=d;b.push(t)}else{for(B=0,r=G.length;B<r;++B){t=$.extend({},G[B]);t[F]=d;b.push(t)}}}}}}break;case QuizUI.Type.LIKERT:b=[];break;default:break}break;default:break}return b},GetLearnerResponse:function(a,l,k){var b,v,p,s;switch(l.kind){case CtrlKind.INPUT:if(l.type==InputUI.MOUSE){b=Mouse.GetDisplayName(k.v)}else{b=Key.GetDisplayName(k.v)}break;case CtrlKind.TEXTINPUT:b=k.v;break;case CtrlKind.DROP:b="";var o,v,d=k.rv?k.rv.length:0;for(v=0;v<d;++v){if(typeof k.rv[v]==="object"){o=Prez._FindCtrlById(a.ctrls,k.rv[v].id)}else{o=Prez._FindCtrlById(a.ctrls,k.rv[v])}if(o){b=(o.reportid||(a.idx+"_"+o.id));break}}break;case CtrlKind.QUIZ:var c=l.ctrls,f=k.v,q,t;switch(l.type){case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.MULTI_RESPONSE:b=[];for(v=0,p=c.length;v<p;++v){if(c[v].kind!=CtrlKind.ANSWER){continue}var h=false,w;for(t=0,q=c[v].ctrls.length;t<q;++t){if(c[v].ctrls[t].kind==CtrlKind.TOGGLE){if(f[c[v].ctrls[t].id]==true){h=true}break}}if(h){w=c[v].reportid||(a.idx+"_"+c[v].id);b.push(w)}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:b=[];for(v=0,p=c.length;v<p;++v){if(c[v].kind!=CtrlKind.NOTE||c[v].type!=NoteType.ANSWER){continue}var g=f[c[v].id],w;if(g!==undefined){w=c[v].reportid||(a.idx+"_"+c[v].id);b[g]=w}}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:b="";for(v=0,p=c.length;v<p;++v){if(c[v].kind!=CtrlKind.TEXTINPUT){continue}b=f[c[v].id];break}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:b={};for(v=0,p=c.length;v<p;++v){if(c[v].kind!=CtrlKind.ANSWER){continue}var w=c[v].reportid||(a.idx+"_"+c[v].id);for(t=0,q=c[v].ctrls.length;t<q;++t){if(c[v].ctrls[t].kind!=CtrlKind.TEXTINPUT){continue}b[w]=f[c[v].ctrls[t].id];break}}break;case QuizUI.Type.MATCH_DRAGDROP:b={};var r,u,x,e,o,y;for(u in f){if(f.hasOwnProperty(u)){y=Prez._FindCtrlById(a.ctrls,u);if(y&&y.reportid){e=y.reportid}else{e=""+a.idx+"_"+u}for(v=0,p=f[u].length;v<p;++v){if(typeof f[u][v]==="object"){r=f[u][v].id}else{r=f[u][v]}o=Prez._FindCtrlById(a.ctrls,r);if(o&&o.reportid){x=o.reportid}else{x=""+a.idx+"_"+r}if(!b[x]){b[x]=[]}b[x].push(e)}}}break;case QuizUI.Type.LIKERT:b={};for(v=0,p=c.length;v<p;++v){if(c[v].kind!=CtrlKind.ANSWER){continue}w=c[v].reportid||(a.idx+"_"+c[v].id);b[w]=f[c[v].id]}break;default:break}break;default:break}return b},GetSlideDuration:function(b){var a=Prez.GetExportedSlideAt(b);if(a){return a.duration?a.duration:-1}return -1},OnTimerTick:function(){var b=(new Date).getTime();var a=(b-Prez.Session.savedTime)*Prez.playbackRate;if(Prez.runningStreams!=PrezStreams.NONE){Prez.Session.Elapsed+=a;Prez.Session.savedTime=b;if(Prez.Session.Elapsed>=Options.test_max_time&&Options.test_max_time&&Prez.Session.PMode==PlayModes.TEST){Prez.StopBGTask();alert(Lang.MaxPrezTimeReached);Prez.OnPrezEnd(true);return}if((Prez.runningStreams&PrezStreams.MAIN)==PrezStreams.NONE){return}}else{Prez.Session.savedTime=b;return}if(Prez.slideUI){var c=Prez.slideUI.WaitIfNeed(Prez.slideUI.ts,Prez.slideUI.ts+a);if(!isNaN(c)){a=c-Prez.slideUI.ts}else{if(Prez.slideUI.ts+a>Prez.slideUI.GetDuration()){a=Prez.slideUI.GetDuration()-Prez.slideUI.ts
}}if(Prez.prjSldBotUI){Prez.prjSldBotUI.ts+=a;Prez.prjSldBotUI.Tick();if(UI.Toolbar){UI.Toolbar.SetProgress(Prez.slideUI.GetIndex(),Prez.prjSldBotUI.ts)}}if(Prez.prjSldTopUI){Prez.prjSldTopUI.ts+=a;Prez.prjSldTopUI.Tick()}Prez.slideUI.ts+=a;Prez.Session.RestoreData.ts=Prez.slideUI.ts;Prez.slideUI.Tick();if((Prez.runningStreams&PrezStreams.MAIN)&&Prez.slideUI.IsEnd()){Prez.ShowSlide(Prez.GetExportedSlideAt(Prez.slideUI.GetIndex()+1),0)}else{if(bSendToLMS){if(Prez.Session.RestoreData.ts-Prez.LMS.GetSuspendDataTS()>1*60*1000){Prez.LMS.StoreSuspendData(Prez.Session.RestoreData,true)}}}}},OnPrezEnd:function(a){Prez.complete=true;Prez.StopBGTask();this.shouldResumeStreams=PrezStreams.NONE;this.nBufferingCount=0;this.UpdateBufferingUI();Prez.Pause(PrezStreams.ALL);if(bSendToLMS){Prez.LMS.EndLesson(a)}switch(Prez.Session.PMode){case PlayModes.DEMO:break;case PlayModes.TUT:break;case PlayModes.PRAC:case PlayModes.TEST:if(Options.ShowReport){Prez.ShowReport()}else{if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){Prez.SendReport()}}break}},ShowReport:function(){ReportUI.Show()},SendReport:function(){var b=Prez.GetReportData(Options.report_format);if(b===null){return}switch(Options.report_method){case ReportMethod.EMAIL:if(!Options.report_value){Options.report_value=""}var d="mailto:"+encodeURIComponent(Options.report_value)+"?subject="+encodeURIComponent(Lang.Report)+"&body="+encodeURIComponent(b);try{var f=window.open(d,"_blank");if(f){setTimeout(function(){if(f){f.close()}},1000)}}catch(c){var a=Lang.CouldnotSendReport+Options.report_value;if(c instanceof Error){a+="<br />"+c.name+": "+c.message}else{if(c.toString){a+="<br />"+c.toString()}}a+=Lang.DisablePopupBlocker+"<b><a href='"+d+"' target='_blank'>"+Lang.SendReport+"</a></b>";UI.ShowMsg(a,true,false);return false}Prez.Close(false);break;case ReportMethod.HTTP:try{var e={type:"POST",url:Options.report_value,data:"report="+b,timeout:60000,success:function(){UI.ShowMsg(Lang.SuccessSendReport,true,true)},error:function(g,k,h){if(h){throw h}else{throw new Error(Lang.CouldnotSendReport+Options.report_value+(k?(": "+k):""))}}};UI.ShowMsg(Lang.SendingReport,false,false);$.ajax(e)}catch(c){var a;if(c instanceof Error){a=c.name+": "+c.message}else{if(c.toString){a=c.toString()}else{a=Lang.CouldnotSendReport+Options.report_value}}UI.ShowMsg(a,true,false);return false}break;default:Prez.Close(false);break}},GetJudgeString:function(a){if(!a){return"Unknown"}else{if(a==Judge.CORRECT){return Lang.Correct}else{if(a==Judge.WRONG){return Lang.Incorrect}else{if(a==Judge.PARTIAL_CORRECT){return Lang.PartialCorrect}else{if(a==Judge.INCOMPLETE){return Lang.Incomplete}else{if(a==Judge.NEUTRAL){return""}}}}}}return"Unknown"},GetInteractionTypeName:function(a){switch(a.kind){case CtrlKind.INPUT:if(a.type==InputUI.MOUSE){return Lang.MouseClick}else{if(a.type==InputUI.KEY){return Lang.KeyStroke}else{return"Unknown"}}case CtrlKind.TEXTINPUT:return Lang.TextBox;case CtrlKind.DROP:return Lang.DropCtrl;case CtrlKind.QUIZ:switch(a.type){case QuizUI.Type.MULTI_RESPONSE:return Lang.MultipleResponse;case QuizUI.Type.TRUE_FALSE:return Lang.TrueFalse;case QuizUI.Type.MULTI_CHOICE:return Lang.MultipleChoice;case QuizUI.Type.SEQUENCE_DRAGDROP:return Lang.Sequence;case QuizUI.Type.SINGLELINE_TEXT:return Lang.FillBlank;case QuizUI.Type.MULTILINE_TEXT:return Lang.Essay;case QuizUI.Type.MULTI_SINGLELINE_TEXT:return Lang.FillMultipleBlank;case QuizUI.Type.MATCH_DRAGDROP:return Lang.DragDrop;case QuizUI.Type.LIKERT:return Lang.Likert;default:break}break;default:break}return"Unknown"},FormatResponse:function(d,k,c,h,o){var g="",f,b;switch(c){case CtrlKind.INPUT:g=d;break;case CtrlKind.TEXTINPUT:g=d;break;case CtrlKind.DROP:g=o?(""+d):(d+"[.]"+k);break;case CtrlKind.QUIZ:switch(h){case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.SEQUENCE_DRAGDROP:g="";for(f=0,b=d.length||0;f<b;++f){if(g!=""){g+=(o?", ":"[,]")}g+=d[f]}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:g=d;break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:case QuizUI.Type.MATCH_DRAGDROP:case QuizUI.Type.LIKERT:var l,m=[],a={},e;g="";if(o&&h==QuizUI.Type.MATCH_DRAGDROP){for(l in d){if(d.hasOwnProperty(l)){e=d[l];if(!a[e]){a[e]=[]}a[e].push(l)}}for(e in a){if(a.hasOwnProperty(e)){if(g!=""){g+=" "}g+=(e+": ");for(f=0,b=a[e].length;f<b;++f){if(f!=0){g+=", "}g+=a[e][f]}g+=";"}}}else{for(l in d){if(d.hasOwnProperty(l)){m.push(l)}}m.sort();for(f=0,b=m.length;f<b;++f){if(g!=""){g+=(o?", ":"[,]")}g+=(m[f]+(o?".":"[.]")+d[m[f]])}}break;default:break}break;default:break}return g},GetReportData:function(p,c){var q=$.cookie("userid")||"";if(!c){while(q==""){q=prompt(Lang.EnterUserID,"")}if(q===null){return null}$.cookie("userid",q)}var d={};d.prezName=PrezInfo.Name;d.prezDesc=PrezInfo.Description;d.date=(new Date()).toUTCString();d.userId=q;d.elapsedTime=Math.ceil(Prez.Session.Elapsed/1000);d.totalSlides=Prez.GetSlideCount();d.takenSlides=0;d.totalInteractions=Prez.GetInteractionCount();d.takenInteractions=0;d.correctCount=0;d.points=Prez.GetPoints();d.maxPoints=Prez.GetMaxPoints();d.percentage=parseInt(d.points*100/d.maxPoints);d.passed=Prez.GetResult()?true:false;d.passCondition=Options.pass_condition;d.passValue=Options.pass_value;d.interactions=[];var l=Prez.Session.RestoreData.slides,o=l.length,g,b,n;for(n=0;n<o;++n){var s=l[n];if(!s){continue}d.takenSlides++;for(var k in s){var r=s[k];if(!r||!r.r){continue}var h=Prez.GetExportedSlideAt(n);var a=Prez._FindCtrlById(h.ctrls,k);if(!a){continue}d.takenInteractions++;var m={},f=Prez.GetLearnerResponse(h,a,r),e=Prez.GetCorrectResponse(h,a);m.type=this.GetInteractionTypeName(a);m.slide=n;m.reportid=a.reportid||(n+"_"+a.id);m.attempts=r.a||0;m.judge=r.j;m.points=r.p||0;m.maxPoints=Prez.GetCtrlMaxPoints(a);m.answerV5=this.FormatResponse(f,m.reportid,a.kind,a.type,true);m.learnerResponse=this.FormatResponse(f,m.reportid,a.kind,a.type,false);m.correctResponses=[];for(var g=0;g<e.length;++g){m.correctResponses.push(this.FormatResponse(e[g],m.reportid,a.kind,a.type,false))}d.interactions.push(m);if(m.judge==Judge.CORRECT){d.correctCount++}}}if(p!==undefined&&p!=ReportFormat.OBJECT){return this.FormatReportData(d,p)}else{return d}},FormatReportData:function(g,q){var a=g.interactions,c=a.length||0,h,r,f,e;var d="\n",p="\t",k=": ";switch(q){case ReportFormat.PLAIN:d="\n";k=": ";reportData=Lang.Presentation+k+g.prezName+d;reportData+=Lang.Description+k+g.prezDesc+d;reportData+=Lang.Date1+k+g.date+d;reportData+=Lang.UserID+k+g.userId+d;reportData+=Lang.TotalTime+k+Math.floor(g.elapsedTime/3600)+" h : "+Math.floor((g.elapsedTime%3600)/60)+" m : "+(g.elapsedTime%60)+" s"+d;reportData+=Lang.TotalSlides+k+g.totalSlides+d;reportData+=Lang.TakenSlides+k+g.takenSlides+d;reportData+=Lang.TotalInteractions+k+g.totalInteractions+d;reportData+=Lang.TakenInteractions+k+g.takenInteractions+d;reportData+=Lang.CorrectCount+k+g.correctCount+d;reportData+=Lang.Points+k+g.points+" / "+g.maxPoints+d;reportData+=Lang.PassCondition+k+g.passCondition+d;reportData+=Lang.PassValue+k+g.passValue+d;reportData+=Lang.Percentage+k+g.percentage+"%"+d;reportData+=Lang.Result+k+(g.passed?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+d;reportData+=d;for(h=0;h<c;++h){r=a[h];reportData+=(h+1)+". ";reportData+=Lang.Slide+k+(parseInt(r.slide)+1)+", ";reportData+=Lang.ID+k+r.reportid+", ";reportData+=Lang.Attempts+k+r.attempts+", ";reportData+=Lang.Points+k+r.points+", ";reportData+=Lang.MaxPoints+k+r.maxPoints+", ";reportData+=Lang.Result+k+this.GetJudgeString(r.judge)+", ";reportData+=Lang.InteractionType+k+r.type+", ";reportData+=Lang.Answer+k+r.answerV5+d}break;case ReportFormat.CSV:d="\n";k=",";reportData='"'+Lang.Presentation+'"'+k;reportData+='"'+Lang.Description+'"'+k;reportData+='"'+Lang.Date1+'"'+k;reportData+='"'+Lang.UserID+'"'+k;reportData+='"'+Lang.TotalTime+'"'+k;reportData+='"'+Lang.TotalSlides+'"'+k;reportData+='"'+Lang.TakenSlides+'"'+k;reportData+='"'+Lang.TotalInteractions+'"'+k;
reportData+='"'+Lang.TakenInteractions+'"'+k;reportData+='"'+Lang.CorrectCount+'"'+k;reportData+='"'+Lang.Points+'"'+k;reportData+='"'+Lang.MaxPoints+'"'+k;reportData+='"'+Lang.PassCondition+'"'+k;reportData+='"'+Lang.passValue+'"'+k;reportData+='"'+Lang.Percentage+'"'+k;reportData+='"'+Lang.Result+'"'+d;reportData+='"'+g.prezName+'"'+k;reportData+='"'+g.prezDesc+'"'+k;reportData+='"'+g.date+'"'+k;reportData+='"'+g.userId+'"'+k;reportData+='"'+g.elapsedTime+'"'+k;reportData+='"'+g.totalSlides+'"'+k;reportData+='"'+g.takenSlides+'"'+k;reportData+='"'+g.totalInteractions+'"'+k;reportData+='"'+g.takenInteractions+'"'+k;reportData+='"'+g.correctCount+'"'+k;reportData+='"'+g.points+'"'+k;reportData+='"'+g.maxPoints+'"'+k;reportData+='"'+g.passCondition+'"'+k;reportData+='"'+g.passValue+'"'+k;reportData+='"'+g.percentage+'"'+k;reportData+='"'+(g.passed?Lang.Passed:Lang.Failed)+'"'+d;reportData+=d;reportData+='"'+Lang.NoSign+'"'+k;reportData+='"'+Lang.Slide+'"'+k;reportData+='"'+Lang.ID+'"'+k;reportData+='"'+Lang.Attempts+'"'+k;reportData+='"'+Lang.Points+'"'+k;reportData+='"'+Lang.MaxPoints+'"'+k;reportData+='"'+Lang.Result+'"'+k;reportData+='"'+Lang.InteractionType+'"'+k;reportData+='"'+Lang.Answer+'"'+d;for(h=0;h<c;++h){r=a[h];reportData+='"'+(h+1)+'"'+k;reportData+='"'+(parseInt(r.slide)+1)+'"'+k;reportData+='"'+r.reportid+'"'+k;reportData+='"'+r.attempts+'"'+k;reportData+='"'+r.points+'"'+k;reportData+='"'+r.maxPoints+'"'+k;reportData+='"'+this.GetJudgeString(r.judge)+'"'+k;reportData+='"'+r.type+'"'+k;reportData+='"'+r.answerV5+'"'+d}break;case ReportFormat.XML:reportData='<?xml version="1.0" encoding="UTF-8"?>'+d;reportData+="<Content>"+d;reportData+=p+"<Report>"+d;reportData+=p+p+"<Name>"+g.prezName+"</Name>"+d;reportData+=p+p+"<Description>"+g.prezDesc+"</Description>"+d;reportData+=p+p+"<Date>"+g.date+"</Date>"+d;reportData+=p+p+"<UserID>"+g.userId+"</UserID>"+d;reportData+=p+p+"<TotalTime>"+g.elapsedTime+"</TotalTime>"+d;reportData+=p+p+"<SlideCount>"+g.totalSlides+"</SlideCount>"+d;reportData+=p+p+"<TakenSlide>"+g.takenSlides+"</TakenSlide>"+d;reportData+=p+p+"<TotalInteraction>"+g.totalInteractions+"</TotalInteraction>"+d;reportData+=p+p+"<TakenInteraction>"+g.takenInteractions+"</TakenInteraction>"+d;reportData+=p+p+"<Correct>"+g.correctCount+"</Correct>"+d;reportData+=p+p+"<Points>"+g.points+"</Points>"+d;reportData+=p+p+"<MaxPoints>"+g.maxPoints+"</MaxPoints>"+d;reportData+=p+p+"<PassCondition>"+g.passCondition+"</PassCondition>"+d;reportData+=p+p+"<PassValue>"+g.passValue+"</PassValue>"+d;reportData+=p+p+"<Percent>"+g.percentage+"</Percent>"+d;reportData+=p+p+"<Result>"+(g.passed?"true":"false")+"</Result>"+d;reportData+=p+p+"<Details>"+d;for(h=0;h<c;++h){r=a[h];reportData+=p+p+p+"<Interaction>"+d;reportData+=p+p+p+p+"<SlideIndex>"+(parseInt(r.slide)+1)+"</SlideIndex>"+d;reportData+=p+p+p+p+"<ReportID>"+r.reportid+"</ReportID>"+d;reportData+=p+p+p+p+"<Attempts>"+r.attempts+"</Attempts>"+d;reportData+=p+p+p+p+"<Points>"+r.points+"</Points>"+d;reportData+=p+p+p+p+"<MaxPoints>"+r.maxPoints+"</MaxPoints>"+d;reportData+=p+p+p+p+"<Result>"+this.GetJudgeString(r.judge)+"</Result>"+d;reportData+=p+p+p+p+"<Type>"+r.type+"</Type>"+d;reportData+=p+p+p+p+"<Answers>"+(""+r.answerV5).quoteHTML()+"</Answers>"+d;reportData+=p+p+p+p+"<LearnerResponse>"+(""+r.learnerResponse).quoteHTML()+"</LearnerResponse>"+d;reportData+=p+p+p+p+"<CorrectResponses>"+d;for(f=0,e=r.correctResponses.length;f<e;++f){reportData+=p+p+p+p+p+"<CorrectResponse>"+(""+r.correctResponses[f]).quoteHTML()+"</CorrectResponse>"+d}reportData+=p+p+p+p+"</CorrectResponses>"+d;reportData+=p+p+p+"</Interaction>"+d}reportData+=p+p+"</Details>"+d;reportData+=p+"</Report>"+d;reportData+="</Content>"+d;break;case ReportFormat.JSON:var o={},b;o.Name=g.prezName;o.Description=g.prezDesc;o.Date=g.date;o.UserID=g.userId;o.TotalTime=g.elapsedTime;o.SlideCount=g.totalSlides;o.TakenSlide=g.takenSlides;o.TotalInteraction=g.totalInteractions;o.TakenInteraction=g.takenInteractions;o.Correct=g.correctCount;o.Points=g.points;o.MaxPoints=g.maxPoints;o.PassCondition=g.passCondition;o.PassValue=g.passValue;o.Percent=g.percentage;o.Result=g.passed;o.Details=[];for(h=0;h<c;++h){r=a[h];b={};b.SlideIndex=(parseInt(r.slide)+1);b.ReportID=r.reportid;b.Attempts=r.attempts;b.Points=r.points;b.MaxPoints=r.maxPoints;b.Result=this.GetJudgeString(r.judge);b.Type=r.type;b.Answers=r.answerV5;b.LearnerResponse=r.learnerResponse;b.CorrectResponses=r.correctResponses;o.Details.push(b)}reportData=JSON.stringify(o,null,p);break;case ReportFormat.HTML:var l="<div class='reporthinfo'>";l+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'>";l+="<tbody>";l+="<tr><td width='30%'>"+Lang.Presentation+"</td><td>"+g.prezName.quoteHTML()+"</td></tr>";l+="<tr><td>"+Lang.Description+"</td><td>"+g.prezDesc.quoteHTML()+"</td></tr>";l+="<tr><td>"+Lang.Date1+"</td><td>"+g.date+"</td></tr>";l+="<tr><td>"+Lang.TotalTime+"</td><td>"+(Math.floor(g.elapsedTime/3600)+" h : "+Math.floor((g.elapsedTime%3600)/60)+" m : "+(g.elapsedTime%60)+" s")+"</td></tr>";l+="<tr><td>"+Lang.TakenSlides+"</td><td>"+ToLocalNumber(g.takenSlides+" / "+g.totalSlides,PrezInfo.Language)+"</td></tr>";l+="<tr><td>"+Lang.TakenInteractions+"</td><td>"+ToLocalNumber(g.takenInteractions+" / "+g.totalInteractions,PrezInfo.Language)+"</td></tr>";l+="<tr><td>"+Lang.CorrectCount+"</td><td>"+ToLocalNumber(g.correctCount,PrezInfo.Language)+"</td></tr>";l+="<tr><td>"+Lang.Points+"</td><td>"+ToLocalNumber(g.points+"/"+g.maxPoints,PrezInfo.Language)+"</td></tr>";l+="<tr><td>"+Lang.Percentage+"</td><td>"+ToLocalNumber(g.percentage,PrezInfo.Language)+" %</td></tr>";l+="<tr><td>"+Lang.Result+"</td><td>"+(g.passed?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+"</td></tr>";l+="</tbody></table>";l+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'><thead><tr>";l+="<th width='10%' align='center'>"+Lang.NoSign+"</th>";l+="<th width='10%' align='center'>"+Lang.SlideIndex+"</th>";l+="<th width='10%' align='center'>"+Lang.ID+"</th>";l+="<th width='10%' align='center'>"+Lang.Attempts+"</th>";l+="<th width='10%' align='center'>"+Lang.Points+"</th>";l+="<th width='10%' align='center'>"+Lang.MaxPoints+"</th>";l+="<th width='10%' align='center'>"+Lang.Result+"</th>";l+="<th width='30%' align='center'>"+Lang.LearnerResponse+"</th>";l+="</tr></thead><tbody>";for(h=0;h<c;++h){r=a[h];l+="<tr>";l+="<td align='center'>"+ToLocalNumber(h+1,PrezInfo.Language)+"</td>";l+="<td align='center'>"+ToLocalNumber(parseInt(r.slide)+1,PrezInfo.Language)+"</td>";l+="<td align='center'>"+r.reportid+"</td>";l+="<td align='center'>"+ToLocalNumber(r.attempts,PrezInfo.Language)+"</td>";l+="<td align='center'>"+ToLocalNumber(r.points,PrezInfo.Language)+"</td>";l+="<td align='center'>"+ToLocalNumber(r.maxPoints,PrezInfo.Language)+"</td>";l+="<td align='center'>"+this.GetJudgeString(r.judge)+"</td>";l+="<td align='center' class='report-response'>"+(""+r.learnerResponse).quoteHTML()+"</td>";l+="</tr>"}l+="</tbody></table>";l+="</div>";reportData=l;break}return reportData},GetImage:function(a){return"data/img_"+this.Session.SlideIndex+"."+a+".png"},GetSlideImage:function(a){return"data/slide_"+a+"."+Options.image_format},GetResource:function(b,a){return"data/res_"+b+"."+a},GetMediaUI:function(b){var a=this.slideUI?this.slideUI.GetMediaUI(b):null;if(!a&&this.prjSldBotUI){a=this.prjSldBotUI.GetMediaUI(b)}if(!a&&this.prjSldTopUI){a=this.prjSldTopUI.GetMediaUI(b)}return a}};EvtMan.StopEvent=function(b){b=$.event.fix(b||window.event||{});b.preventDefault();b.stopPropagation();try{if(b.originalEvent){b.originalEvent.keyCode=0}}catch(a){}return false};EvtMan.DoActions=function(d,c){var e=d.length;if(e>0){var a=-1;function b(){if(++a<e){var f=d[a];if(c&&(f.type==ActType.CONTINUE||d.type==ActType.SKIP)){c.SetWaited(true)
}EvtMan.DoAction(f,b)}}b()}};EvtMan.DoAction=function(b,f){var a;switch(b.type){case ActType.WAIT:Prez.Pause(PrezStreams.MAIN);break;case ActType.SKIP:case ActType.CONTINUE:Prez.Resume(PrezStreams.ALL);break;case ActType.END:Prez.OnPrezEnd(false);return;case ActType.SUBMIT:if(!b.dat||b.dat<=0){Prez.slideUI.Submit()}else{a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.Submit){a.Submit()}}break;case ActType.CLEAR_INPUT:if(!b.dat||b.dat<=0){Prez.slideUI.ClearUserInput(true)}else{a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ClearUserInput){a.ClearUserInput(true)}}break;case ActType.SHOW_NON_BLOCKING:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ctrl.duration!=0){a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}break;case ActType.SHOW:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ctrl.duration!=0){if(a.ctrl.duration<0){a.ctrl.duration=3000}if(a.ctrl.flags&CtrlFlags.LOOP){a.ctrl.flags&=~CtrlFlags.LOOP}if(f){a.SetOnHideCallback(f)}a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true);return}break;case ActType.PLAY_AUDIO:a=b.audioUI;if(a){a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}break;case ActType.HIDE:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a){a.SetHiddenByEvent(true);a.Hide(true)}break;case ActType.EMAIL:try{if(!b.dat.fullMail){if(!b.dat.to){b.dat.to=""}var m="mailto:"+encodeURIComponent(b.dat.to)+"?";if(b.dat.subject){m+="subject="+encodeURIComponent(b.dat.subject)+"&"}if(b.dat.cc){m+="cc="+encodeURIComponent(b.dat.cc)+"&"}if(b.dat.bcc){m+="bcc="+encodeURIComponent(b.dat.bcc)+"&"}if(b.dat.body){m+="body="+encodeURIComponent(b.dat.body)+"&"}b.dat.fullMail=m}var c=window.open(b.dat.fullMail,"_blank");if(c){setTimeout(function(){if(c){c.close()}},1000)}}catch(d){var g=Lang.CouldnotSendMail+b.dat.to;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.WEB:try{if(!b.dat.specs){b.dat.specs=""}var k=window.open(b.dat.url,encodeURIComponent(b.dat.name),b.dat.specs);if(!k){var e=Lang.CouldnotOpenWeb+b.dat.url+Lang.DisablePopupBlocker;e+='<b><a href="'+b.dat.url+'" target="'+b.dat.name+'">'+b.dat.url+"</a></b>";UI.ShowMsg(e)}else{k.focus()}}catch(d){var g=Lang.CouldnotOpenWeb+b.dat.url;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.SCRIPT:try{var l=g_userScripts[b.dat];if(l){l()}}catch(d){var g=Lang.CouldnotRunAction+b.dat;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.SLIDE_ID:Prez.ShowSlideByID(b.dat);return;case ActType.SLIDE_IDX:Prez.ShowSlideByIndex(b.dat);return;case ActType.NEXT:Prez.ShowSlideByIndex(Prez.Session.SlideIndex+parseInt(b.dat));return;case ActType.PREV:var h=Prez.Session.SlideIndex-parseInt(b.dat);if(h>=0){Prez.ShowSlideByIndex(h)}return}if(f){f()}};EvtMan.SubmitCode={AUTO:-1,MANUAL:-2};function EvtMan(a){this.evt=a;this.curAtp=0}EvtMan.prototype={constructor:EvtMan,IsEnabled:function(){return !this.timeout&&(this.evt.atp<0||this.evt.atp>this.curAtp||this.evt.atp===undefined)},IsLastAttempt:function(){return(this.evt.atp==this.curAtp)&&(this.curAtp>0)},SetTimeExpired:function(){this.timeout=true},Update:function(){this.timeout=false},GetResponse:function(r,a,k,b,g){var d={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(!b){b=this}if(g===undefined){g=true}var h=!(b.evt.mod&EvtMode.SURVEY);var m=this.evt[r];var q=r==EvtType.TEXT&&a=="";var f=false;switch(r){case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:if(h){if(!m||!m.length){if(r!=EvtType.TEXT||a==""){d.jud=Judge.CORRECT;d.pt=this.evt.pt;if(g){d.acts=b.GetActions(EvtType.CORRECT)}}else{d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}else{for(var e=0,c=m.length;e<c;++e){var l=InputUI.CheckEvtValue(r,a,m[e].val,k);if(l==Judge.PARTIAL_CORRECT&&r==EvtType.TEXT){if(this.evt.submit!=EvtMan.SubmitCode.AUTO){l=Judge.WRONG}}if(l!=Judge.WRONG){d.jud=l;if(l==Judge.CORRECT){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=m[e].pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=m[e].acts}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}break}}}if(d.jud==Judge.UNEXPECTED||(q&&d.jud==Judge.PARTIAL_CORRECT)){if(q){var p=b.GetActions(EvtType.INCOMPLETE);f=(p.length>0);if(g){d.acts=p}}if(f){d.jud=Judge.INCOMPLETE}else{if(d.jud==Judge.UNEXPECTED){d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}}}}else{if(q){var p=b.GetActions(EvtType.INCOMPLETE);f=(p.length>0);if(g){d.acts=p}}if(f){d.jud=Judge.INCOMPLETE}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}}break;case EvtType.REJECT:if(h){d.jud=Judge.WRONG;d.acts=this.GetActions(EvtType.REJECT);if(g){d.acts=d.acts.concat(b.GetActions(EvtType.WRONG))}}break;case EvtType.ACCEPT:if(h){d.jud=Judge.CORRECT;var o=null;if(a&&a.ctrl){o=this.GetEvent(EvtType.ACCEPT_SPECIFIC,a.ctrl.id)}if(o){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=o.pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=o.acts||[]}d.acts=d.acts.concat(this.GetActions(EvtType.ACCEPT))}else{d.pt=this.evt.pt}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}break}return d},GetFirstEventValue:function(b){var a=this.evt[b];if(a&&a.length){return a[0].val}if(b==EvtType.TEXT){return""}return 0},GetPoints:function(e,c){if(e===undefined){return this.evt.pt||0}var a=this.evt[e];if(!a){return 0}if(c===undefined){return(a.all&&a.all.pt)||0}switch(e){case EvtType.TEXT:case EvtType.CLICK:case EvtType.KEY_DOWN:for(var b=0,d=a.length;b<d;++b){if(a[b].val==c){return a[b].pt||0}}return 0;default:return(a[c]&&a[c].pt)||0}},GetMaxPoints:function(g){if(this.evt.ptMax!==undefined){return this.evt.ptMax}var b=0;if(this.evt.mod&EvtMode.PARTIAL_SCORE){var a=this.evt[g],d;if(a&&(typeof a==="object")){if($.isArray(a)){for(var c=0,f=a.length;c<f;++c){d=a[c].pt;if(d>b){b=d}}}else{for(var e in a){d=a[e].pt;if(d>b){b=d}}}}}else{b=this.evt.pt||0}return(this.evt.ptMax=b)},GetActions:function(g,d){var b=this.evt[g];if(!b){return[]}if(d===undefined&&g!=EvtType.WRONG){return(b.all&&b.all.acts)||[]}switch(g){case EvtType.WRONG:var e=[];if(d===undefined){d=this.curAtp+1}var c=d==this.evt.atp;if(b[d]){e=b[d].acts}if(d>0){if(b[AtpType.ALL]){e=e.concat(b[AtpType.ALL].acts)}if(!c&&b[AtpType.ALL_BUT_LAST]){e=e.concat(b[AtpType.ALL_BUT_LAST].acts)}if(c&&b[AtpType.LAST]){e=e.concat(b[AtpType.LAST].acts)}if(e.length==0&&b[AtpType.OTHERS]){e=b[AtpType.OTHERS].acts}}return e||[];case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,f=b.length;a<f;++a){if(b[a].val===d){return b[a].acts||[]}}return[];default:return(b[d]&&b[d].acts)||[]}},HasEvent:function(b,a){return !!this.GetEvent(b,a)},GetEvent:function(e,c){var b=this.evt[e];if(!b){return null}switch(e){case EvtType.WRONG:if(c===undefined){c=this.curAtp+1}return b[c]||null;break;case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,d=b.length;a<d;++a){if(b[a].val===c){return b[a]}}break;default:if(c===undefined){c="all"}return b[c]||null;break}return null},CreatePlayedAudioUIs:function(f){if(!EvtMan._ctrlAudio){EvtMan._ctrlAudio={kind:CtrlKind.AUDIO,startTime:-1,duration:-1,showMode:PlayModes.DEMO|PlayModes.TUT|PlayModes.PRAC|PlayModes.TEST,flags:CtrlFlags.NOT_WAIT,rect:{t:0,l:0,w:2,h:2}}}var l,h,k,e,d,a,c,b,g;for(l in this.evt){h=this.evt[l];if(!h||(typeof h!=="object")){continue}if($.isArray(h)){for(e=0,a=h.length;e<a;++e){k=h[e].acts;if(k){for(d=0,c=k.length;d<c;++d){if(k[d].type==ActType.PLAY_AUDIO){b=$.extend({},EvtMan._ctrlAudio);b.audio=k[d].dat;if(!f._evtAudioId){f._evtAudioId=1}b.id="evt_audio_"+f._evtAudioId;++f._evtAudioId;g=f.CreateControl(b);k[d].audioUI=g;if(g){g.Attach(f);if(!g.IsTriggeredByEvent()){f.ctrlUIs.push(g)}}}}}}}else{for(e in h){if(h[e]&&h[e].acts){k=h[e].acts;for(d=0,c=k.length;d<c;++d){if(k[d].type==ActType.PLAY_AUDIO){b=$.extend({},EvtMan._ctrlAudio);
b.audio=k[d].dat;if(!f._evtAudioId){f._evtAudioId=1}b.id="evt_audio_"+f._evtAudioId;++f._evtAudioId;g=f.CreateControl(b);k[d].audioUI=g;if(g){g.Attach(f);if(!g.IsTriggeredByEvent()){f.ctrlUIs.push(g)}}}}}}}}},CleanUp:function(){}};SlideUI.currentLayerIdx=1;SlideUI.currentTopLayerIdx=4;SlideUI.ClearLayer=function(c,b){var a=UI.GetSlideLayerID(c);$("#"+a+" > :not(.ap-ctrl-media,.ap-wmk)").remove();$("#"+a+" > .ap-ctrl-media").hide();if(b){$("#"+a+"_bg").remove()}};SlideUI.GetOtherLayerIndex=function(a){if(a===1||a===2){return 3-a}return 9-a};SlideUI.projSldID="sld_prj";SlideUI.projSldTopID="sld_prj_top";function SlideUI(g){this.slide=g;this.isPrjSldBot=g==Prez.prjSlideBot;this.isPrjSldTop=g==Prez.prjSlideTop;if(this.isPrjSldBot){this.layerIdx=3;this.id=SlideUI.projSldID;if(BrowserInfo.canPlayMultiSounds&&g.clkSounds&&g.clkSounds.length){this.clkSoundId=this.GetDOMCtrlID("clkSound");this.clkSounds=g.clkSounds;this.clkSoundPlayer=null;this.clkSoundPaused=false;this.bIncBuffCount=false;this.lastDOMId=this.clkSoundId}this.pointerEffectId="fg_pointerEffect";this.pointerEffectCurRect={x:0,y:0,w:1,h:1};this.pointerEffectRenderer=new PointerEffect();var n=mediaStats.nb_bot_project_audio+mediaStats.max_nb_slide_audio+mediaStats.nb_top_project_audio;if(n>0){this.lastDOMId=MediaManager.GetPlayerContainerId(n-1,this.id,true)}$("#"+this.pointerEffectId).remove();var h='<div id="'+this.pointerEffectId+'" style="position:absolute;left:0px;top:0px;width:1px;height:1px;display:none;overflow:hidden;z-index:'+ZIndexBase.ClickEffects+';"><canvas id="'+this.pointerEffectId+'_canvas" width="100%" height="100%" style="position:absolute;top:0px;left:0px;width:100%;height:100%;"></canvas></div>';UI.$Slides.append(h);$("#"+this.id).remove();var k="";k+='<div class="slide" id="'+this.id+'" style="z-index:'+ZIndexBase.SlidePrjCtrls+';">';if(this.clkSoundId){k+=MediaManager.CreatePlayerElements2(this.clkSoundId,true)}for(f=0;f<n;++f){k+=MediaManager.CreatePlayerElements(f,this.id,true)}for(f=0;f<mediaStats.nb_bot_project_video;++f){k+=MediaManager.CreatePlayerElements(f,this.id,false)}k+="</div>";UI.$Slides.append(k)}if(this.isPrjSldTop){this.layerIdx=SlideUI.GetOtherLayerIndex(SlideUI.currentTopLayerIdx);SlideUI.currentTopLayerIdx=this.layerIdx;this.id=SlideUI.projSldTopID}if(!this.isPrjSldBot&&!this.isPrjSldTop){this.layerIdx=SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx);SlideUI.currentLayerIdx=this.layerIdx;this.id=UI.GetSlideLayerID(this.layerIdx);SlideUI.ClearLayer(this.layerIdx);this.wmkid="appwmk"+this.layerIdx;this.bgId=this.id+"_bg";$("#"+this.bgId).remove();var m="";if(g.bg){var d=CSSColor((g.bg.color>>16)&255,(g.bg.color>>8)&255,g.bg.color&255);m='<div id="'+this.bgId+'" style="display:none;background-color:'+d+';" class="bgimg" alt="'+(this.slide.acctext||"")+'"></div>'}else{m='<img id="'+this.bgId+'" style="display:none;" class="bgimg" src="'+Prez.GetSlideImage(this.slide.id)+'" alt="'+(this.slide.acctext||"")+'" width="100%" height="100%" />'}UI.$Slides.append(m)}this.ts=-1;this.ctrlUIs=[];this.allCtrlUIs={};this.mapNameCtrlUIs={};this.inputUIs=[];this.triggeredUIs=[];this.zoomUI=null;this.CCaption=null;this.nVideoPlayerIndex=0;this.nSoundPlayerIndex=0;if(this.isPrjSldBot){this.nSoundPlayerIndex=0;this.nVideoPlayerIndex=0}else{if(this.isPrjSldTop){this.nSoundPlayerIndex=mediaStats.nb_bot_project_audio+mediaStats.max_nb_slide_audio;this.nVideoPlayerIndex=mediaStats.max_nb_slide_video}else{this.nSoundPlayerIndex=mediaStats.nb_bot_project_audio;this.nVideoPlayerIndex=0}}var o=g.ineff;if(o&&!o.inited){EffectMan.InitEffect(o,{t:0,l:0,w:UI.slideW,h:UI.slideH});o.inited=true}var e=g.ctrls;var f,a=e.length;for(f=0;f<a;++f){var c=this.CreateControl(e[f]);if(c){c.Attach(this);if(!c.IsTriggeredByEvent()){this.ctrlUIs.push(c)}}}if(g.cursor){g.cursor.kind=CtrlKind.CURSOR;var l=this.CreateControl(g.cursor);if(l){l.Attach(this);this.ctrlUIs.push(l)}}if(g.ccaption&&(g_closedCaption.modes&Prez.Session.PMode)){this.CCaption=new SlideCCaptionUI(g.ccaption,this)}if(g.zoomAreas){this.zoomUI=new ZoomUI(g.zoomAreas,this)}for(var b in this.allCtrlUIs){this.allCtrlUIs[b].OnAttached()}}SlideUI.prototype={constructor:SlideUI,GetDOM:function(){if(this.isPrjSldTop){alert("Invalid call");return}return $("#"+this.id)},GetIndex:function(){return this.slide.idx},GetDuration:function(){return this.slide.duration},GetAudioPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nSoundPlayerIndex,SlideUI.projSldID,true);this.nSoundPlayerIndex++;return a},GetVideoPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nVideoPlayerIndex,this.id,false);this.nVideoPlayerIndex++;return a},CreateControl:function(b,a){if(!b){return null}var d=true;if(!a||b.startTime<0){d=(b.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(!d&&b.kind!=CtrlKind.BUTTON&&b.kind!=CtrlKind.INPUT&&b.kind!=CtrlKind.DROP){return null}var c=null;switch(b.kind){case CtrlKind.TEXTINPUT:c=new TxtInputUI(b,this,a);break;case CtrlKind.TOGGLE:c=new ToggleUI(b,this,a);break;case CtrlKind.BUTTON:b.type=InputUI.MOUSE;b.flags=CtrlFlags.FOCUSABLE;case CtrlKind.INPUT:c=new InputUI(b,this,a);break;case CtrlKind.DROP:c=new DropAreaUI(b,this,a);break;case CtrlKind.GESTURE:c=new GestureUI(b,this,a);break;case CtrlKind.ANSWER:c=new AnswerUI(b,this,a);break;case CtrlKind.QUIZ:c=new QuizUI(b,this,a);break;case CtrlKind.AUDIO:case CtrlKind.VIDEO:c=new MediaUI(b,this,a);break;case CtrlKind.YOUTUBE:c=new YouTubeUI(b,this,a);break;case CtrlKind.WEBOBJECT:c=new WebObjectUI(b,this,a);break;case CtrlKind.CURSOR:c=new CursorUI(b,this,a);break;case CtrlKind.FEEDBACK:c=new FeedbackUI(b,this,a);break;default:c=new CtrlUI(b,this,a);break}if(c){this.allCtrlUIs[c.ctrlKey]=c;if(this.mapNameCtrlUIs[c.ctrl.name]){window.console&&console.log("Object name isn't unique: "+c.ctrl.name)}else{this.mapNameCtrlUIs[c.ctrl.name]=c}}return c},GetDOMCtrlID:function(a){return"ctrl_"+this.layerIdx+"_"+a},GetCtrlUI:function(a,b){if(b){a=this.GetDOMCtrlID(a)}return this.allCtrlUIs[a]},GetObject:function(a){return this.mapNameCtrlUIs[a]},GetMediaUI:function(a){if(a==this.clkSoundId){return this}return this.allCtrlUIs[a]},_IncBufCount:function(){if(this.cleaned){return}if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.cleaned){return}if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},CreateClickSoundPlayer:function(){if(!this.clkSoundId){return}var b="";for(i=0,nCount=this.clkSounds.length-1;i<nCount;++i){b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt+","}b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt;var a={context:this,ready:function(){this._OnPlayerReady()},end:function(){},statechanged:function(){this._OnPlayerStateChanged()}};$("#"+this.clkSoundId).show();this.clkSoundPlayer=MediaManager.CreatePlayer({files:b,mode:"audio"},this.clkSoundId,a);if(this.clkSoundPlayer.SetPlaybackRate){this.clkSoundPlayer.SetPlaybackRate(Prez.playbackRate)}},PlayClickSound:function(a){if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){this.CreateClickSoundPlayer()}if(this.clkSoundPlayer){$(this).stopTime("playclicksound");$(this).oneTime(1,"playclicksound",function(){this.needPlayClickSound=true;var b=$.inArray(a,this.clkSounds);if(b>=0){this.clkSoundPlayer.LoadItem(b);var c=this.clkSoundPlayer.GetState();Log("PlayClickSound Player State: "+c);if(c==MediaStates.NOT_READY||c==MediaStates.OPENING||c==MediaStates.BUFFERING||c==MediaStates.CLOSED){}else{if(c!=MediaStates.ERROR){if(Prez.runningStreams!=PrezStreams.NONE){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}}}})}},_OnPlayerReady:function(){return;if(this.clkSoundPlayer&&BrowserInfo.canPlayMultiSounds){$("#"+this.clkSoundPlayer.GetId()).attr("tabindex","-1");this.clkSoundPlayer.SetVolume(Prez.GetVolume(true));var a=this.clkSoundPlayer.GetState();Log("Mouse Click Sound _OnPlayerReady | State: "+a);if(a==MediaStates.NOT_READY||a==MediaStates.OPENING||a==MediaStates.BUFFERING||a==MediaStates.CLOSED){this._IncBufCount()
}else{this._DecBufCount()}}},_OnPlayerStateChanged:function(){if(!this.needPlayClickSound){return}if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){return}var a=this.clkSoundPlayer.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){if(Prez.runningStreams!=PrezStreams.NONE){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}},PlayPointerEffect:function(n,p,a,o,h,d,g,m,f,q){var c="rgba("+((g>>16)&255)+", "+((g>>8)&255)+", "+(g&255)+", "+(((g>>24)&255)/255).toFixed(6)+")";if(f<0){return}$(this).stopTime("pointer_effect");var k=$("#"+this.pointerEffectId);var b=$("#"+this.pointerEffectId+"_canvas");a-=h/2;o-=d/2;this.pointerEffectCurRect={x:a,y:o,w:h,h:d};k.hide();k.css({left:a+"px",top:o+"px",width:h+"px",height:d+"px"});var r=document.getElementById(this.pointerEffectId+"_canvas");var l=(r&&r.getContext&&typeof(r.getContext)==="function")?r.getContext("2d"):null;if(l){b.show();b.attr("width",h).attr("height",d);var e=this.pointerEffectRenderer;$(this).everyTime(f,"pointer_effect",function(s){if(s==1){k.show()}if(s>=q){k.hide()}if(n){e.RenderMouseEffect(l,p,h/2,d/2,s/q,c,m)}else{e.RenderTouchEffect(l,p,h/2,d/2,s/q,c)}},q)}},Mute:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].Mute(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a?0:Prez.GetVolume())}},SetVolume:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].SetVolume(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a)}},Raise:function(){if(!this.isPrjSldBot&&!this.isPrjSldTop){var a=UI.GetSlideLayerID(SlideUI.GetOtherLayerIndex(this.layerIdx));$("#"+a+"_bg").css("z-index",ZIndexBase.SlideBgrOld);$("#"+a).css("z-index",ZIndexBase.SlideCtrlsOld);$("#"+this.bgId).css("z-index",ZIndexBase.SlideBgrNew);$("#"+this.id).css("z-index",ZIndexBase.SlideCtrlsNew)}},Show:function(d,g){var c=!this.isPrjSldBot&&!this.isPrjSldTop;if(c){Prez.Session.SlideIndex=this.slide.idx}this.inputUIs.length=0;this.triggeredUIs.length=0;this.ts=d||0;var e=$("#"+this.id),b=$("#"+this.bgId),f=this;if(this.slide.ineff&&this.ts<this.slide.ineff.duration){if(!c){EffectMan.Stop(e[0],false)}else{EffectMan.Stop(b[0],false);EffectMan.Stop(e[0],false);this.Raise()}this._Update();b.show();e.show();var a={exitEffect:false,secondStream:false,startTime:this.ts};if(c){EffectMan.Start(b[0],this.slide.ineff,a)}a.callback=function(){f._OnShow();if(g){g.call(this)}};EffectMan.Start(e[0],this.slide.ineff,a)}else{if(c){EffectMan.Stop(b[0],true,false);this.Raise();b.show()}EffectMan.Stop(e[0],true,false);e.show();this._Update();this._OnShow();if(g&&e[0]){g.call(e[0])}}},_Update:function(){var c=!this.isPrjSldBot&&!this.isPrjSldTop,a=this.ctrlUIs.length,b;if(c){for(b=0;b<a;++b){this.ctrlUIs[b].SetWaited(false)}this.WaitIfNeed(this.ts-1,this.ts)}if(this.zoomUI){this.zoomUI.Update()}else{if(c){ZoomUI.Reset()}}for(b=0;b<a;++b){this.ctrlUIs[b].Update()}if(this.CCaption){this.CCaption.Update()}else{if(c){ClosedCaptionUI.ClearCaption()}}if(!this.isPrjSldBot){if(this.slide.onload!==undefined){EvtMan.DoAction({type:ActType.SCRIPT,dat:this.slide.onload})}}},_OnShow:function(){if(!this.isPrjSldBot&&!this.isPrjSldTop){$(this).oneTime(500,"removeprev",function(){SlideUI.ClearLayer(SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx),true)});if(this.slide.wm){$("#"+this.wmkid).show()}else{$("#"+this.wmkid).hide()}CanvasNav.Focus(false)}},UpdatePrezStateChanged:function(){if(this.cleaned){return}var b,a,c;c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}if(this.CCaption){this.CCaption.UpdatePrezStateChanged()}},UpdatePrezPropertyChanged:function(e,d){if(this.cleaned){return}var b,a,c;c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezPropertyChanged(e,d)}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezPropertyChanged(e,d)}},WaitIfNeed:function(d,f){var c,b=this.ctrlUIs.length,e,a,g;for(c=0;c<b;++c){e=this.ctrlUIs[c];a=e.GetWaitingTS();if(!isNaN(a)&&d<a&&a<=f){e.SetWaited(true);if(isNaN(g)){g=a}else{if(a>g){g=a}}}}if(!isNaN(g)){Prez.Pause(PrezStreams.MAIN)}return g},Tick:function(){if(this.zoomUI){this.zoomUI.Tick()}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].Tick()}if(this.CCaption){this.CCaption.Tick()}},IsEnd:function(){return this.slide.duration<=this.ts},CleanUp:function(){$(this).stopTime();if(!this.isPrjSldBot&&!this.isPrjSldTop){EffectMan.Stop($("#"+this.bgId)[0],true,false)}else{if(this.isPrjSldBot){$(this).stopTime("pointer_effect");$("#"+this.pointerEffectId).remove();this.pointerEffect=null}}EffectMan.Stop($("#"+this.id)[0],true,false);if(this.zoomUI){this.zoomUI.CleanUp()}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].CleanUp()}if(this.CCaption){this.CCaption.CleanUp()}if(this.clkSoundPlayer){this.clkSoundPlayer.CleanUp();this.clkSoundPlayer=null;this.clkSounds=null;$("#"+this.clkSoundId).hide()}this.ctrlUIs.length=0;this.inputUIs.length=0;this.triggeredUIs.length=0;this.CCaption=null;this.zoomUI=null;this.cleaned=true},Submit:function(){var c,b,a=this.ctrlUIs.length;for(b=0;b<a;++b){c=this.ctrlUIs[b];if(c.showState!=CtrlShowState.HIDE&&c.Submit&&c.evtMan&&c.ctrl.evt.submit!=EvtMan.SubmitCode.AUTO){c.Submit()}}},ClearUserInput:function(a){var d,c,b=this.ctrlUIs.length;for(c=0;c<b;++c){d=this.ctrlUIs[c];if(d.showState!=CtrlShowState.HIDE&&d.ClearUserInput){d.ClearUserInput(a)}}},AddInputUI:function(a){if($.inArray(a,this.inputUIs)==-1){this.inputUIs.push(a)}},RemoveInputUI:function(b){var a=$.inArray(b,this.inputUIs);if(a>-1){this.inputUIs.splice(a,1)}},AddTriggeredUI:function(a){if($.inArray(a,this.triggeredUIs)==-1){this.triggeredUIs.push(a)}},RemoveTriggeredUI:function(b){var a=$.inArray(b,this.triggeredUIs);if(a>-1){this.triggeredUIs.splice(a,1)}},LoadSubmitedData:function(){var c=Prez.Session.RestoreData.slides;if(!c){return}var d=c[this.slide.idx];if(!d){return}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].LoadSubmitedData(d)}},GetSubmitedDataObject:function(){var a=Prez.Session.RestoreData.slides;if(!a){a=[];Prez.Session.RestoreData.slides=a}var b=a[this.slide.idx];if(!b){b={};a[this.slide.idx]=b}return b},AcceptResumeToken:function(){for(var b in this.allCtrlUIs){var a=this.allCtrlUIs[b];if(a.AcceptResumeToken&&a.AcceptResumeToken()){return true}}return false}};CtrlUI.GenCSSRect=function(a,b){return"top:"+(b*a.t)+"px;left:"+(b*a.l)+"px;width:"+(b*a.w)+"px;height:"+(b*a.h)+"px;"};function CtrlUI(d,a,c){this.ctrl=d;this.parentUI=c;this.slideUI=a;this.ctrlKey=a.GetDOMCtrlID(d.id);this.id=this.ctrlKey;this.inputId=this.id;if(this.ctrl.flags&CtrlFlags.DRAGGABLE){this.inputId=this.id+"_inp"}this.waited=false;this.showState=CtrlShowState.HIDE;if(d.evt){this.evtMan=new EvtMan(d.evt);this.evtMan.CreatePlayedAudioUIs(a)}this.InitEffects(true);this.role="alert";this.bIncBuffCount=false;if(!this.parentUI&&this.ctrl.startTime>=0){if(this.ctrl.duration<0||((this.ctrl.flags&CtrlFlags.LOOP)&&this.ctrl.duration>0)){if(this.startOut!==undefined){this.endTime=this.slideUI.slide.duration}else{this.endTime=-1}}else{this.endTime=this.ctrl.startTime+this.ctrl.duration;if(this.endTime>=this.slideUI.slide.duration-100&&this.startOut===undefined){this.endTime=-1}}}if(d.audio&&d.kind!=CtrlKind.AUDIO){var b=(d.kind==CtrlKind.BUTTON||(d.kind==CtrlKind.INPUT&&d.type==InputUI.MOUSE));if(!b){this.playerId=a.GetAudioPlayerId()}}if((d.flags&(CtrlFlags.DROPPABLE|CtrlFlags.DRAGGABLE))==CtrlFlags.DROPPABLE){this.dropHelper=new DropHelper(this)}}$.extend(CtrlUI.prototype,{constructor:CtrlUI,GetParent:function(){return this.parentUI},SetParent:function(a){this.parentUI=a},GetTopLevel:function(){var b=this,a=this.parentUI;while(a){b=a;a=a.parentUI}return b},IsTopLevel:function(){return !this.parentUI},IsEnabled:function(a){if(this.cleaned){return false}if(!a&&Prez.runningStreams==PrezStreams.NONE){return false}if(Prez.Session.PMode&PlayModes.DEMO){return false}if(this.evtMan&&(this.evtMan.evt.mod&EvtMode.INDEPENDENT)){return this.evtMan.IsEnabled()
}var b=this.GetTopLevel();if(b.evtMan){return b.evtMan.IsEnabled()}if(this.ctrl.flags&(CtrlFlags.DROPPABLE|CtrlFlags.DRAGGABLE)){return true}return false},IsShown:function(){return(this.showState!=CtrlShowState.HIDE)&&(!this.parentUI||this.parentUI.IsShown())},IsTriggeredByEvent:function(){return this.ctrl.startTime<0},GetSlide:function(){return this.slideUI},GetEventMan:function(){return this.evtMan},GetDOM:function(){return $("#"+this.id)},SetText:function(c){this.ctrl.html=c;var a=$("#"+this.id+"_lb"),b=this.GetLabelHTML();if(a.length){a.replaceWith(b)}else{this.GetDOM().append(b)}},GetText:function(a){return a?$("#"+this.id+"_lb").text():$("#"+this.id+"_lb").html()},GetLabelHTML:function(){if(!this.ctrl.html){return""}var h=this.ctrl.shape,d;d=CtrlUI.GenCSSRect(this.ctrl.tr,1)+this.ctrl.css;if(h){var n=h.shadow;if((!h.fill||h.fill.type==FillType.NONE)&&(n&&n.type==ShadowType.CUSTOM)){var p=n.distance*Math.cos(n.angle/180*Math.PI),o=n.distance*Math.sin(n.angle/180*Math.PI),e=(n.argb>>16)&255,f=(n.argb>>8)&255,l=(n.argb)&255,m=((n.argb>>24)&255)/255,k="rgba("+e+", "+f+", "+l+", "+m+")";d+=("text-shadow:"+p+"px "+o+"px "+n.radius+"px "+k+";")}}return'<div id="'+this.id+'_lb" class="label" style="'+d+'">'+this.ctrl.html+"</div>"},GetHTML:function(){var e=this.ctrl.rect;if(!this.ctrl.shape){var g,c="";if(this.ctrl.acctext){c=this.ctrl.acctext}g='<img id="'+this.id+'_bg" class="bgimg" src="'+this.GetImg()+'" alt="'+c+'" role="presentation" width="100%" height="100%" />';var d="";if(this.id==this.inputId){d=this.GetARIAAttrs()}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(e,1)+'" aria-hidden="true" '+d+">"+g+this.GetLabelHTML()+this.GetInputHTML()+"</div>"}else{var b,d="",a=this.ctrl.shape,f={l:a.l-a.cbx,t:a.t-a.cby,w:a.w,h:a.h};b='<div id="'+this.id+'_bg" class="bgshape" style="'+CtrlUI.GenCSSRect(f,1)+'" role="presentation"></div>';if(this.id==this.inputId){d=this.GetARIAAttrs()}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(e,1)+'" aria-hidden="true" '+d+">"+b+this.GetLabelHTML()+this.GetInputHTML()+"</div>"}},GetInputHTML:function(){if(this.inputId!=this.id){return'<div id="'+this.inputId+'" class="evtreceiver" '+this.GetARIAAttrs()+"></div>"}else{return""}},GetARIAAttrs:function(){var a="";if(this.role){a+=' role="'+this.role+'"'}if(this.ctrl.acctext){a+=' aria-label="'+this.ctrl.acctext+'"'}return a},Zoom:function(c,l,h){var g=this.GetDOM(),b=this.ctrl.tf;if(c!=1){if(l!==undefined&&h!==undefined){var k=this.ctrl.rect;if(b){var a=l-k.w*b.oX/100,f=h-k.h*b.oY/100,n=RotatePoint(a,f,b.r,0,0),m=RotatePoint(a*c,f*c,b.r,0,0),e,d;e=-(m.x-n.x);d=-(m.y-n.y);g.css({transformOrigin:b.oX+"% "+b.oY+"%",transform:"translate("+e+"px,"+d+"px) scale("+c+","+c+") rotate("+b.r+"deg)"})}else{g.css({transformOrigin:l/k.w*100+"% "+h/k.h*100+"%",transform:"scale("+c+","+c+")"})}}else{if(b){g.css({transformOrigin:b.oX+"% "+b.oY+"%",transform:"rotate("+b.r+"deg) scale("+c+","+c+")"})}else{g.css({transformOrigin:"50% 50%",transform:"scale("+c+","+c+")"})}}}else{if(b){g.css({transformOrigin:b.oX+"% "+b.oY+"%",transform:"rotate("+b.r+"deg)"})}else{g.css({transformOrigin:"",transform:""})}}},FixSize:function(){if(this.ctrlUIs){var f,b=this.ctrlUIs.length;for(f=0;f<b;++f){this.ctrlUIs[f].FixSize()}}if(!this.ctrl.html){return}if(!this.ctrl.af){return}var k=$("#"+this.id),g=$("#"+this.id+"_lb"),e,h,f=0,d=5,c,a;e=g.height();h=g.width();g.css("height","auto");while(f<=20){a=g.height();if(e+d>a){break}f++;g.width(h+5*f)}if(h+5*f+d>k.width()){k.width(h+5*f+d)}g.height(e)},GetIniProps:function(){return{opacity:this.opacity!==undefined?this.opacity:1,left:this.pos?this.pos.l:this.ctrl.rect.l,top:this.pos?this.pos.t:this.ctrl.rect.t}},GetPosition:function(){return{x:this.pos?this.pos.l:this.ctrl.rect.l,y:this.pos?this.pos.t:this.ctrl.rect.t}},SetPosition:function(a,b){this.ctrl.rect.l=a;this.ctrl.rect.t=b;delete this.pos;this.InitEffects(false);this.GetDOM().css({left:a,top:b})},InitEffects:function(e){var b=this.ctrl;var a,c={},d;if(this.opacity!==undefined){c.opacity=this.opacity}d=this.pos||b.rect;if(d){c.t=d.t;c.l=d.l}if(b.rect){c.w=b.rect.w;c.h=b.rect.h}d=this.transform||b.tf;if(d&&d.r){c.transform={r:d.r,oX:d.oX,oY:d.oY}}a=b.ineff;if(a){EffectMan.InitEffect(a,c);if(e){this.endIn=a.duration;if(b.startTime>0){this.endIn+=b.startTime}}}a=b.outeff;if(a){EffectMan.InitEffect(a,c);if(e){if(b.duration<0||((b.flags&CtrlFlags.LOOP)&&b.duration>0)){this.startOut=this.slideUI.slide.duration-a.duration}else{this.startOut=b.duration-a.duration;if(b.startTime>0){this.startOut+=b.startTime}}}}},Attach:function(a){if(a.isPrjSldTop){a=Prez.slideUI}if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id},PopulateStyle:function(){if(this.stylePopulated){return}this.stylePopulated=true;var a=this.ctrl.shape;if(!a){return}if((!a.fill||a.fill.type==FillType.NONE)&&(!a.line||a.line.type==LineType.NONE)){return}var b=new AutoShape($("#"+this.id+"_bg").get(0),a);b.Realize()},InitAudioPlayer:function(){if(this.ctrl.audio&&this.ctrl.kind!=CtrlKind.AUDIO&&this.ctrl.kind!=CtrlKind.BUTTON&&(this.ctrl.kind!=CtrlKind.INPUT||this.ctrl.type!=InputUI.MOUSE)){var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()}};var a={file:"data/res_"+this.ctrl.audio+"."+MediaManager.strAudioExt,mode:"audio"};$("#"+this.playerId).show();this.sound=MediaManager.CreatePlayer(a,this.playerId,b);if(this.sound.SetPlaybackRate){this.sound.SetPlaybackRate(Prez.playbackRate)}}},OnAttached:function(){var h=this,a=this.GetDOM(),d=!(this.ctrl.flags&(CtrlFlags.DRAGGABLE|CtrlFlags.DROPPABLE))&&this.ctrl.kind==CtrlKind.NOTE&&this.ctrl.type!=NoteType.ANSWER;if(this.ctrl.flags&CtrlFlags.DRAGGABLE){var k={rlCtrlUI:h,start:function(m,n){if(!Prez.slideUI||!h.IsEnabled()){return false}var l=h.GetDropCtrlUI(),q,p,o=convertPointFromPageToNode(n.helper.get(0),m.pageX,m.pageY);if(l&&l.dropHelper){l.dropHelper.StartDragOut(h)}h.ClearDropCtrlUI();DropHelper.DragEffect(h,true,o.x,o.y);q=parseFloat(a.css("left"))||0;p=parseFloat(a.css("top"))||0;h.dragOffsetX=(q-n.position.left);h.dragOffsetY=(p-n.position.top);h.mousePos={x:m.pageX,y:m.pageY}},drag:function(p,q){var r,o,n,m,l;l=q.helper.get(0).parentNode;r=convertPointFromPageToNode(l,q.originalPosition.left,q.originalPosition.top),o=convertPointFromPageToNode(l,q.position.left,q.position.top);n=o.x-r.x;m=o.y-r.y;q.position.left=q.originalPosition.left+n;q.position.top=q.originalPosition.top+m;if(h.dragOffsetX){q.position.left+=h.dragOffsetX}if(h.dragOffsetY){q.position.top+=h.dragOffsetY}h.mousePos={x:p.pageX,y:p.pageY}},stop:function(o,p){DropHelper.DragEffect(h,false);delete h.dragOffsetX;delete h.dragOffsetY;delete h.mousePos;if(!Prez.slideUI){return}var l=h.GetDropCtrlUI();if(l&&l.dropHelper){var t={left:parseFloat(a.css("left"))||0,top:parseFloat(a.css("top"))||0};if(!l.dropHelper.Drop(h,t)){h.ClearDropCtrlUI()}}else{if(h.ctrl.dragOpt.revert){a.animate({top:h.ctrl.rect.t,left:h.ctrl.rect.l},DropHelper.RevertTime)}if(!h.parentUI){var r=Prez.slideUI.inputUIs,q;for(var m=0,s=r.length;m<s;++m){q=r[m];if(q.ctrl.kind==CtrlKind.DROP&&q.slideUI==Prez.slideUI){q.Submit(EvtType.REJECT,h)}}}}}};a.bind("mousedown",function(l){l.stopPropagation()}).draggable(k)}else{if(this.ctrl.flags&CtrlFlags.DROPPABLE){var c={rlRect:this.ctrl.rect,tolerance:"pointer",activate:function(l,m){},deactivate:function(l,m){DropHelper.DropHoverEffect(h,false)},drop:function(m,n){if(!n.draggable.length||!Prez.slideUI||!h.IsEnabled()){return}var l=h.slideUI.GetCtrlUI(n.draggable[0].id,false);if(l&&l.parentUI==h.parentUI){l.SetDropCtrlUI(h)}},over:function(m,n){if(!n.draggable.length||!Prez.slideUI||!h.IsEnabled()){return}var l=h.slideUI.GetCtrlUI(n.draggable[0].id,false);if(l&&l.parentUI==h.parentUI){DropHelper.DropHoverEffect(h,true);h.MouseEnter()}},out:function(m,n){DropHelper.DropHoverEffect(h,false);if(!n.draggable.length||!Prez.slideUI||!h.IsEnabled()){return
}var l=h.slideUI.GetCtrlUI(n.draggable[0].id,false);if(l&&l.parentUI==h.parentUI){h.MouseLeave()}}};a.droppable(c)}}if(Options.allow_select_text&&d){a.css("pointer-events","auto");a.bind("mousedown.allow_select_text",function(l){l.stopPropagation()});a.bind("mouseup.allow_select_text",function(l){l.stopPropagation()});a.bind("contextmenu.allow_select_text",function(l){l.stopPropagation()})}var b=this.ctrl.tf;if(b){a.css({transformOrigin:b.oX+"% "+b.oY+"%",transform:"rotate("+b.r+"deg)"})}if(this.evtMan&&!BrowserInfo.iDevice&&!BrowserInfo.android){var e=$("#"+this.inputId);var f=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(f.length){e.mouseenter(function(){h.MouseEnter()})}var g=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(g.length){e.mouseleave(function(){h.MouseLeave()})}}},GetShowState:function(a,b){var c=this.ctrl.startTime;b.ctrlTs=a-c;if(this.hiddenByEvent){b.value=CtrlShowState.HIDE;return}if(a<c){b.value=CtrlShowState.HIDE}else{if(this.endIn&&a<this.endIn){b.value=CtrlShowState.SHOWING;b.ts=b.ctrlTs}else{if(this.startOut!==undefined){if(a<=this.startOut){b.value=CtrlShowState.SHOW}else{if(a<this.endTime){b.value=CtrlShowState.HIDING;b.ts=a-this.startOut}else{b.value=CtrlShowState.HIDE}}}else{if(this.endTime<0||a<=this.endTime){b.value=CtrlShowState.SHOW}else{b.value=CtrlShowState.HIDE}}}}},Show:function(a,e){if(!a||a.value===undefined){if(a||arguments.length==0){this.Update(true);this.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}else{this.SetHiddenByEvent(true);this.Hide(true)}return}var b=false;if((this.showState==CtrlShowState.HIDE||e)&&a.value!=CtrlShowState.HIDE){if(this.ctrl.startTime<0){this.slideUI.AddTriggeredUI(this)}$(this).stopTime("hide");if(e&&(this.ctrl.duration==0||(this.ctrl.duration>0&&!(this.ctrl.flags&CtrlFlags.LOOP)))&&(this.ctrl.outeff||(this.ctrl.kind!=CtrlKind.AUDIO&&this.ctrl.kind!=CtrlKind.VIDEO))){this.hideDelayDuration=this.ctrl.duration;if(this.ctrl.outeff){this.hideDelayDuration-=this.ctrl.outeff.duration}this.hideDelayTS=0;this.hideDelayPrevTime=(new Date).getTime();this.hidePlaybackRate=Prez.playbackRate;var f=this.hideDelayDuration/this.hidePlaybackRate;$(this).oneTime(f,"hide",function(){this.Hide(true)})}$(this).stopTime("timelimit");if(this.evtMan&&!this.parentUI&&this.IsEnabled(true)){var h=this.ctrl.evt.timeLimit;if(h!==undefined&&h>=0){$(this).oneTime(h,"timelimit",function(){this._Timeout()})}}b=true}this.showState=a.value;var k=this,c=$("#"+this.id);var d=c[0];var g={secondStream:this.ctrl.startTime<0||this.hiddenByEvent,startTime:a.ts};switch(a.value){case CtrlShowState.SHOWING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");g.exitEffect=false;g.callback=function(){k.showState=CtrlShowState.SHOW};EffectMan.Start(d,this.ctrl.ineff,g);break;case CtrlShowState.HIDING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");g.exitEffect=true;g.callback=function(){k._OnHideComplete()};EffectMan.Start(d,this.ctrl.outeff,g);break;case CtrlShowState.HIDE:EffectMan.Stop(d,false);this._OnHideComplete();break;default:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");break}if(b){this.FixSize();this.PopulateStyle();this._OnShowStart(a.ctrlTs)}},_IncBufCount:function(){if(this.cleaned){return}if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.cleaned){return}if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},_OnShowStart:function(c){$("#"+this.id).attr("aria-hidden","false");if(!this.sound){this.InitAudioPlayer()}if(this.sound){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}if(a>this.ctrl.meddur/1000){return}var b=this.sound.GetState();Log(this.id+": _OnShowStart Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){this.sound.Play(false,a)}b=this.sound.GetState();Log(this.id+": _OnShowStart Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this.soundPaused=true;this._IncBufCount()}else{if(b!=MediaStates.ERROR){if(Prez.runningStreams==PrezStreams.NONE){this.sound.Play(false);this.soundPaused=true}else{this.sound.Play(true);this.soundPaused=false}}}}},Hide:function(a){if(arguments.length==0){a=true}$(this).stopTime("hide");this.hideDelayTS=undefined;if(a&&this.ctrl.outeff&&this.showState!=CtrlShowState.HIDE){if(this.showState==CtrlShowState.HIDING){EffectMan.Resume($("#"+this.id)[0])}else{this.Show({value:CtrlShowState.HIDING,ts:0,ctrlTs:this.startOut},false)}}else{this.Show({value:CtrlShowState.HIDE},false)}},_OnHideComplete:function(){$("#"+this.id).hide().attr("aria-hidden","true");this.showState=CtrlShowState.HIDE;if(this.sound&&this.ctrl.meddur>this.ctrl.duration){var a=this.sound.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.sound.Play(false)}}$(this).stopTime("showstart").stopTime("hide").stopTime("timelimit");if(this.ctrl.startTime<0){this.slideUI.RemoveTriggeredUI(this)}var b=this;if(this.onHide){window.setTimeout(function(){if(b.onHide){b.onHideTmp=b.onHide;delete b.onHide;b.onHideTmp();delete b.onHideTmp}},1)}},SetOnHideCallback:function(b){if(!b){return}var a=this.onHide;this.onHide=function(){if(a){a.call(this)}b.call(this)}},UpdatePrezStateChanged:function(){if(Prez.runningStreams==PrezStreams.NONE){$(this).pauseTime("timelimit");if(this.hideDelayTS){$(this).stopTime("hide");this.hideDelayTS+=((new Date).getTime()-this.hideDelayPrevTime)*this.hidePlaybackRate}if(!Prez.IsBuffering()){if(this.sound&&this.showState!=CtrlShowState.HIDE){var c=this.sound.GetState();if(c==MediaStates.PAUSED||c==MediaStates.PLAYING||c==MediaStates.BUFFERING){this.sound.Play(false)}else{Log(this.id+": Pause a non ready player, state: "+c)}}this.soundPaused=true}}if(Prez.runningStreams&PrezStreams.SECOND){$(this).resumeTime("timelimit");if(this.hideDelayTS){$(this).stopTime("hide");var a=(this.hideDelayDuration-this.hideDelayTS)/this.hidePlaybackRate;if(a<1){a=1}this.hideDelayPrevTime=(new Date).getTime();$(this).oneTime(a,"hide",function(){this.Hide(true)})}if(this.soundPaused&&this.sound&&this.showState!=CtrlShowState.HIDE){var b=this._GetTimeStamp();if(b<this.ctrl.meddur){var c=this.sound.GetState();if(c==MediaStates.PAUSED||c==MediaStates.PLAYING||c==MediaStates.STOPPED){this.sound.Play(true)}else{Log(this.id+": Resume a non ready player, state: "+c)}}}this.soundPaused=false}},UpdatePrezPropertyChanged:function(a,b){if(a=="PlaybackRate"){this.UpdatePlaybackRateChanged()}},UpdatePlaybackRateChanged:function(){if(this.sound&&this.sound.SetPlaybackRate){this.sound.SetPlaybackRate(Prez.playbackRate)}if(this.hideDelayTS){$(this).stopTime("hide");var a=(new Date).getTime();this.hideDelayTS+=(a-this.hideDelayPrevTime)*this.hidePlaybackRate;this.hidePlaybackRate=Prez.playbackRate;var b=(this.hideDelayDuration-this.hideDelayTS)/this.hidePlaybackRate;if(b<1){b=1}this.hideDelayPrevTime=a;$(this).oneTime(b,"hide",function(){this.Hide(true)})}},_Timeout:function(){$(this).stopTime("timelimit");if(this.showState!=CtrlShowState.HIDE&&this.IsEnabled()&&this.evtMan){this.evtMan.SetTimeExpired();EvtMan.DoActions(this.evtMan.GetActions(EvtType.TIMEOUT))}},Update:function(c){if(this.evtMan){this.evtMan.Update()}delete this.doingLastAttempt;this.soundPaused=false;if(c){this._DecBufCount()}else{this.bIncBuffCount=false}if(this.sound){this.sound.Play(false)}this.hiddenByEvent=false;if(!c){if(this.onHide){delete this.onHide}var d={},b=this.slideUI.ts;if(this.ctrl.startTime<0){d.value=CtrlShowState.HIDE}else{if(this.parentUI){d.value=CtrlShowState.SHOW;d.ctrlTs=b-this.ctrl.startTime}else{this.GetShowState(b,d)}}this.showState=CtrlShowState.HIDE;this.Show(d)}if(this.ctrlUIs){var a,e=this.ctrlUIs.length;for(a=0;a<e;++a){this.ctrlUIs[a].Update(c)}}},Tick:function(){if(this.ctrl.startTime<0){return
}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:case CtrlShowState.HIDE:this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}break}},SetWaited:function(a){this.waited=a},GetWaitingTS:function(){if(this.evtMan&&!this.waited&&!this.parentUI&&(this.IsEnabled()||this.doingLastAttempt)&&(this.ctrl.startTime>=0)){var a=this.ctrl.evt.startWait;if(!isNaN(a)&&a>=0){a+=this.ctrl.startTime;return a}}},CleanUp:function(){$(this).stopTime();$("#"+this.id).stop(true);EffectMan.Stop($("#"+this.id)[0],true,false);if(this.onHide){delete this.onHide}if(this.sound){this.sound.CleanUp();this.sound=null;$("#"+this.playerId).hide()}$("#"+this.inputId).unbind();if(this.evtMan){this.evtMan.CleanUp()}this.cleaned=true},Submit:function(){},LoadSubmitedData:function(){},GetSubmitedDataObject:function(){var b=this.slideUI.GetSubmitedDataObject();var a=b[this.ctrl.id];if(!a){a={};b[this.ctrl.id]=a}return a},GetImg:function(){return"data/img_"+this.slideUI.slide.id+"."+this.ctrl.id+".png"},_OnPlayerReady:function(){if(this.sound){this.sound.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}var b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=undefined}this.sound.Play(false,a)}b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.sound){return}var a=this.sound.GetState();if(!this.bIncBuffCount){if(a==MediaStates.OPENING||a==MediaStates.BUFFERING){this._IncBufCount()}}else{if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.ERROR||a==MediaStates.STOPPED){this._DecBufCount()}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime;if(a<0){a=0}}return a},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.sound){this.sound.SetVolume(a)}},IsFocusable:function(){return false},Focus:function(){return false},MouseEnter:function(){if(!this.evtMan){return}var a=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(a.length&&this.IsEnabled()){EvtMan.DoActions(a)}},MouseLeave:function(){if(!this.evtMan){return}var a=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(a.length&&this.IsEnabled()){EvtMan.DoActions(a)}},GetDropCtrlUI:function(){return this.dropUI},SetDropCtrlUI:function(a){this.dropUI=a},ClearDropCtrlUI:function(){delete this.dropUI},SetHiddenByEvent:function(a){this.hiddenByEvent=a}});InputUI.MOUSE=1;InputUI.KEY=2;InputUI.MOUSE_HOVER=3;InputUI.GetCombinedCode=function(c,d,a,e){switch(c){case Key.CTRL:d=true;c=0;break;case Key.SHIFT:a=true;c=0;break;case Key.ALT:e=true;c=0;break}var b=0;if(d){b|=Key.MOD_CTRL}if(a){b|=Key.MOD_SHIFT}if(e){b|=Key.MOD_ALT}return((b<<24)|c)};InputUI.GetEvtValue=function(a){return InputUI.GetCombinedCode(a.apWhich,a.ctrlKey,a.shiftKey,a.altKey)};InputUI.CheckEvtValue=function(h,b,g,a){if(h==EvtType.TEXT&&!a){b=b.toLowerCase();g=g.toLowerCase()}if(b==g){return Judge.CORRECT}if(h==EvtType.TEXT){if(g.substr(0,b.length)==b&&b.length<g.length){return Judge.PARTIAL_CORRECT}}else{var c=b&16777215,e=g&16777215,d=b>>24,f=g>>24;if(h==EvtType.KEY_DOWN){if((c==0||c==e)&&(d&f)==d){return Judge.PARTIAL_CORRECT}}else{if(c==0&&(d&f)==d){return Judge.PARTIAL_CORRECT}}}return Judge.WRONG};function InputUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(this.ctrl.flags&CtrlFlags.FOCUSABLE){this.role="button"}}$.extend(InputUI.prototype,CtrlUI.prototype,{constructor:InputUI,GetInputHTML:function(){var a='<div id="'+this.inputId+'" class="evtreceiver" onclick="void(0)" '+this.GetARIAAttrs();if(this.ctrl.flags&CtrlFlags.FOCUSABLE){a+=' tabindex="-1"></div>'}else{a+="></div>"}return a},OnAttached:function(){var b=$("#"+this.inputId);if(this.showShape){b.css("cursor","pointer")}else{$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}var a=this;if(this.ctrl.flags&CtrlFlags.FOCUSABLE){if(this.ctrl.type==InputUI.MOUSE){b.bind("keydown",function(c){if(!a.IsEnabled()){return}if(c.apWhich===undefined){c.apWhich=Key.ToMozKey(c.which)}if(c.apWhich==Key.SPACE||c.apWhich==Key.ENTER){$(document).trigger("feedback",[c]);a.Submit(EvtType.CLICK,a.evtMan.GetFirstEventValue(EvtType.CLICK));return EvtMan.StopEvent(c)}})}b.bind("mousedown.focus",function(){if(a.IsFocusable()){a.Focus()}});b.focus(function(){if(Options.HilightFocus){$("#"+a.id).addClass("focused")}CanvasNav.OnCtrlFocused(a)}).blur(function(){if(Options.HilightFocus){$("#"+a.id).removeClass("focused")}})}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Options.FlashABSpeed>0&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){this._Flashing()})}if(this.IsEnabled(true)){if(this.ctrl.type!=InputUI.MOUSE_HOVER){this.slideUI.AddInputUI(this)}}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}else{CanvasNav.Focus(false)}},_OnHideComplete:function(){$(this).stopTime("flashing");this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},UpdatePrezStateChanged:function(){if(Prez.runningStreams==PrezStreams.NONE){$(this).stopTime("flashing");if(this.showShape){$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}}if(Prez.runningStreams&PrezStreams.SECOND){if(this.showState!=CtrlShowState.HIDE&&Options.FlashABSpeed&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){var a=this;$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){a._Flashing()})}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},_Flashing:function(){if(!this.showShape){return}var a=$("#"+this.bgId);if(a.css("visibility")=="hidden"){a.css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}else{a.css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}},Submit:function(h,a,b){if(!b){b=this.GetResponse(h,a)}if(b.jud!=Judge.UNEXPECTED&&b.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(this.ctrl.kind==CtrlKind.INPUT&&this.ctrl.type!=InputUI.MOUSE_HOVER){var f=this.GetSubmitedDataObject();var k=!(this.ctrl.evt.mod&EvtMode.NO_REPORT);f.v=a;f.a=this.evtMan.curAtp;f.p=b.pt;f.j=b.jud;f.r=k;if(bSendToLMS&&k){var c=this.slideUI.slide,d=Prez.GetLearnerResponse(c,this.ctrl,f),e=Prez.GetCorrectResponse(c,this.ctrl);Prez.LMS.StoreInteractionData(this.ctrl,this.slideUI.slide,b.jud,b.pt,d,e)}}var g=EvtMan.DoActions(b.acts,this);if(b.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return g}},GetResponse:function(d,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)||this.ctrl.type==InputUI.MOUSE_HOVER){return a}if(d==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}var c=this.ctrl.type==InputUI.KEY?EvtType.KEY_DOWN:EvtType.CLICK;if(d==EvtType.CLICK&&Mouse.fromTouchEvent){d=c;b=this.evtMan.GetFirstEventValue(d)}if(d==c){a=this.evtMan.GetResponse(d,b)}else{if(d==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){if(b&16777215){a.jud=Judge.WRONG;
a.acts=this.evtMan.GetActions(EvtType.WRONG)}else{a=this.evtMan.GetResponse(EvtType.CLICK,b)}}}}return a},IsFocusable:function(){return(this.ctrl.flags&CtrlFlags.FOCUSABLE)&&(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.inputId).focus();this.slideUI.GetDOM().scrollLeft(0).scrollTop(0);return true},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}$("#"+this.inputId).css("cursor","pointer")},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a},CleanUp:function(){$(this).stopTime("flashing");if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},PlayClickSound:function(){if(this.ctrl.type==InputUI.MOUSE&&this.ctrl.audio&&this.IsEnabled(true)&&this.showState!=CtrlShowState.HIDE&&Prez.prjSldBotUI){Prez.prjSldBotUI.PlayClickSound(this.ctrl.audio)}}});function GestureUI(c,a,b){CtrlUI.call(this,c,a,b)}$.extend(GestureUI.prototype,CtrlUI.prototype,{constructor:GestureUI,_OnShowStart:function(g){CtrlUI.prototype._OnShowStart.call(this,g);$(this).stopTime("gesture_eff");var a=this.ctrl.eff_touchscr;if(a&&(a.showModes&Prez.Session.PMode)==Prez.Session.PMode){if(this.ctrl.startTime>=0){var b=this.ctrl.startTime;var k=(this.ctrl.duration>=0?this.ctrl.duration+b:Prez.slideUI.slide.duration);if(this.ctrl.ineff){b+=this.ctrl.ineff.duration}if(this.ctrl.outeff){k-=this.ctrl.outeff.duration}if(b<g+this.ctrl.startTime){b=g+this.ctrl.startTime}var c=k-b;if(c>2000){c=2000}var e=k-c;var h=e-(this.ctrl.startTime+g);if(h<1){h=1}var d=c/a.fr_count;if(d>=1){var f=this.ctrl.rect;$(this).oneTime(h,"gesture_eff",function(){Prez.prjSldBotUI.PlayPointerEffect(false,a.type,f.l+f.w/2,f.t+f.h/2,a.w,a.h,a.color,null,d,a.fr_count)})}}}},UpdatePrezStateChanged:function(){if(Prez.runningStreams&PrezStreams.MAIN){$(this).resumeTime("gesture_eff")}else{$(this).pauseTime("gesture_eff")}CtrlUI.prototype.UpdatePrezStateChanged.call(this)}});TxtInputUI.PASSWORD=1;TxtInputUI.MULTILINE=2;TxtInputUI.RETAIN=4;TxtInputUI.CASESENS=8;TxtInputUI.LASTCHARTIME=500;function TxtInputUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.textboxId=this.id+"_txtbox";this.labelId=this.id+"_lb";this.inputRc={t:c.tr.t+c.rect.t,l:c.tr.l+c.rect.l,w:c.tr.w,h:c.tr.h};this.inputFontSize=parseFloat($('<div style="'+c.css+'"></div>').css("font-size"));if(isNaN(this.inputFontSize)){this.inputFontSize=12}this.typingText="";this.prevSubmitedText=undefined;this.prevCorrectText="";this.role=""}$.extend(TxtInputUI.prototype,CtrlUI.prototype,{constructor:TxtInputUI,GetInputHTML:function(){var b="",a=CtrlUI.GenCSSRect(this.ctrl.tr,1);a+=this.ctrl.css;if(this.ctrl.flags&TxtInputUI.MULTILINE){b='<textarea id="'+this.textboxId+'" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1"></textarea>'}else{if(this.ctrl.flags&TxtInputUI.PASSWORD){b='<input id="'+this.textboxId+'" type="password" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}else{b='<input id="'+this.textboxId+'" type="text" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}}return'<div id="'+this.inputId+'" class="evtreceiver">'+b+"</div>"},OnAttached:function(){if(Prez.Session.PMode==PlayModes.DEMO&&this.IsTopLevel()){this.typingText=this.evtMan.GetFirstEventValue(EvtType.TEXT);if(!this.typingText){this.typingText=""}}if(this.typingText.length){var b=this.ctrl.duration;if(b<0){b=this.slideUI.slide.duration-this.ctrl.startTime}b-=TxtInputUI.LASTCHARTIME;this.typingDelay=0;if(this.ctrl.ineff){this.typingDelay=this.ctrl.ineff.duration;b-=this.typingDelay}if(this.ctrl.outeff){b-=this.ctrl.outeff.duration}this.typingInterval=Math.floor(b/this.typingText.length);this.typingTs=0}var e=$("#"+this.inputId),d=$("#"+this.textboxId),c=this;d.focus(function(){$("#"+c.labelId).hide();if(Options.HilightFocus){$("#"+c.id).addClass("focused")}CanvasNav.OnCtrlFocused(c)}).blur(function(){if(!this.value){$("#"+c.labelId).show()}if(Options.HilightFocus){$("#"+c.id).removeClass("focused")}});e.bind("click",function(f){if(c.IsFocusable()){c.Focus()}}).bind("mousedown mouseup",function(f){if(f.type=="mousedown"){Mouse.Norm(f,false);$(document).trigger("feedback",[f])}f.stopPropagation()});var a=this.ctrl.evt.submit;if(a==EvtMan.SubmitCode.AUTO){d.bind("keyup",function(){if(!c.IsEnabled()){return}c.Submit()})}else{if(a>0){d.bind("keydown keyup",function(f){if(!c.IsEnabled()){return}if(f.apWhich===undefined){f.apWhich=Key.ToMozKey(f.which)}if(Key.ShouldHandleKeyUp(f.apWhich)){if(f.type!="keyup"){return EvtMan.StopEvent(f)}}else{if(f.type!="keydown"){return EvtMan.StopEvent(f)}}if(a==InputUI.GetEvtValue(f)){$(document).trigger("feedback",[f]);c.Submit();return EvtMan.StopEvent(f)}})}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this)}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}if(this.typingText!=""){var b=0;if(this.typingTs>=this.typingDelay){if(this.typingInterval>0){b=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval)}else{b=this.typingText.length}}this.SetValue(this.typingText.substr(0,b));if(b<this.typingText.length){$(this).stopTime("typing").everyTime(this.typingInterval,"typing",function(){this._SimulateTyping()})}var a=this.GetValue().length;this.SetSelection(a,a)}},_OnHideComplete:function(){if(this.typingText!=""){$(this).stopTime("typing")}this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Update:function(a){if(this.typingText!=""){this.typingTs=this.slideUI.ts-this.ctrl.startTime;if(this.typingTs<0){this.typingTs=0}}this.prevSubmitedText=undefined;this.prevCorrectText="";CtrlUI.prototype.Update.call(this,a)},UpdatePrezStateChanged:function(){if(this.typingText!=""){if(Prez.runningStreams&PrezStreams.MAIN){$(this).resumeTime("typing")}else{$(this).pauseTime("typing")}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},Submit:function(h,g,d){if(h===undefined){h=EvtType.TEXT}if(g===undefined){g=this.GetValue()}if(h==EvtType.TEXT&&g===this.prevSubmitedText&&(g!==""||this.ctrl.evt.submit==EvtMan.SubmitCode.AUTO)){return}if(!d){d=this.GetResponse(h,g)}if(d.jud!=Judge.UNEXPECTED&&d.jud!=Judge.PARTIAL_CORRECT){if(d.jud!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(!this.parentUI){var b=this.GetSubmitedDataObject();var e=!(this.ctrl.evt.mod&EvtMode.NO_REPORT);b.a=this.evtMan.curAtp;b.v=this.GetValue();b.p=d.pt;b.j=d.jud;b.r=e;if(bSendToLMS&&e){var a=this.slideUI.slide,f=Prez.GetLearnerResponse(a,this.ctrl,b),c=Prez.GetCorrectResponse(a,this.ctrl);Prez.LMS.StoreInteractionData(this.ctrl,this.slideUI.slide,d.jud,d.pt,f,c)}}}if(d.jud==Judge.WRONG&&h==EvtType.TEXT){this.SetSelection(this.prevCorrectText.length,g.length)}EvtMan.DoActions(d.acts,this);CtrlUI.prototype.Submit.call(this)}if(d.jud!=Judge.UNEXPECTED&&h==EvtType.TEXT){this.prevSubmitedText=g;if(d.jud!=Judge.WRONG){this.prevCorrectText=g}}},SetSelection:function(e,c){var a=$("#"+this.textboxId)[0];if(!a){return}if(this.IsFocusable()){this.Focus()}try{if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveStart("character",e);b.moveEnd("character",c-e);b.select()}else{if(a.setSelectionRange){a.setSelectionRange(e,c)}else{if(a.selectionStart){a.selectionStart=e;a.selectionEnd=c}}}}catch(d){}},GetResponse:function(c,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return a}if(c===undefined){c=EvtType.TEXT}if(b===undefined){b=this.GetValue()}if(c==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}if(c==EvtType.TEXT){a=this.evtMan.GetResponse(c,b,this.ctrl.flags&TxtInputUI.CASESENS)}else{if(c==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;
a.acts=this.evtMan.GetActions(EvtType.WRONG)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}this.SetValue("")},IsFocusable:function(){return(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.textboxId).focus();if(BrowserInfo.ie){var a=this;window.setTimeout(function(){a.slideUI.GetDOM().scrollLeft(0).scrollTop(0)},0)}else{this.slideUI.GetDOM().scrollLeft(0).scrollTop(0)}return true},GetValue:function(){return $("#"+this.textboxId).val()},SetValue:function(a){$("#"+this.textboxId).val(a)},SetText:function(a){this.SetValue(a)},GetText:function(){return this.GetValue()},IsCaseSensitive:function(){return this.ctrl.flags&TxtInputUI.CASESENS},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.SetValue(a.v);this.evtMan.curAtp=a.a},CleanUp:function(){if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},_SimulateTyping:function(){this.typingTs+=this.typingInterval;if(this.typingTs<this.typingDelay){return}var a;if(this.typingInterval<=0){a=this.typingText.length}else{a=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval);if(a>this.typingText.length){a=this.typingText.length}}if(this.GetValue().length!=a){this.SetValue(this.typingText.substr(0,a));this.SetSelection(a,a)}if(a>=this.typingText.length){$(this).stopTime("typing")}}});function DropAreaUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}}$.extend(DropAreaUI.prototype,CtrlUI.prototype,{constructor:DropAreaUI,GetInputHTML:function(){return'<div id="'+this.inputId+'" class="evtreceiver" '+this.GetARIAAttrs()+"></div>"},OnAttached:function(){if(!this.showShape){$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this)}},_OnHideComplete:function(){this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Submit:function(h,a,b){if(!b){b=this.GetResponse(h,a)}if(b.jud!=Judge.UNEXPECTED&&b.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}var f=this.GetSubmitedDataObject();var k=!(this.ctrl.evt.mod&EvtMode.NO_REPORT);f.v=b.v;f.rv=b.rv;f.a=this.evtMan.curAtp;f.p=b.pt;f.j=b.jud;f.r=k;if(bSendToLMS&&k){var c=this.slideUI.slide,d=Prez.GetLearnerResponse(c,this.ctrl,f),e=Prez.GetCorrectResponse(c,this.ctrl);Prez.LMS.StoreInteractionData(this.ctrl,this.slideUI.slide,b.jud,b.pt,d,e)}var g=EvtMan.DoActions(b.acts,this);if(b.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return g}},GetResponse:function(h,e){var a={jud:Judge.UNEXPECTED,pt:0,acts:[],v:"",rv:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return a}var d=false;switch(h){case EvtType.ACCEPT:d=true;a=this.evtMan.GetResponse(h,e);break;case EvtType.REJECT:d=true;a=this.evtMan.GetResponse(h,e);break;default:if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}break}if(d){if(e.ctrl){a.v=e.ctrl.id}}a.rv=[];if(this.dropHelper){var g=this.dropHelper.GetDroppedUIs(),c,f,b;for(c=0,f=g.length;c<f;++c){b=g[c];if(this.dropHelper.IsAbsoluteDroppedPos()&&b.pos){a.rv.push({id:b.ctrl.id,t:b.pos.t,l:b.pos.l})}else{a.rv.push(b.ctrl.id)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}if(this.dropHelper){this.dropHelper.ResetAllDropped()}},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}},LoadSubmitedData:function(d){var a=d[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a;var e=a.rv;if(e&&e.length){var c,g,b,f={top:0,left:0};for(c=0,g=e.length;c<g;++c){if(typeof e[c]==="object"){b=this.slideUI.GetCtrlUI(e[c].id,true);f.top=e[c].t;f.left=e[c].l}else{b=this.slideUI.GetCtrlUI(e[c],true)}if(b){this.dropHelper.Drop(b,f,false)}}}}});AnswerUI.Type={RADIO:1,CHECK:2,TEXT:3,COMBO:4,SCALE:5};function AnswerUI(f,b,e){CtrlUI.call(this,f,b,e);this.ctrlUIs=[];if(f.type==AnswerUI.Type.SCALE){this.actUIs=[]}this.html='<div id="'+this.id+'" class="comctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,1)+'">';var g,a=this.ctrl.ctrls,c=a.length,d;for(d=0;d<c;++d){g=b.CreateControl(a[d],this);if(g){this.html+=g.GetHTML();if(g.ctrl.kind==CtrlKind.TOGGLE){if(f.type==AnswerUI.Type.SCALE){this.actUIs.push(g)}else{this.actUI=g}}else{if(g.ctrl.kind==CtrlKind.NOTE){this.noteUI=g}else{if(g.ctrl.kind==CtrlKind.TEXTINPUT){this.actUI=g}}}this.ctrlUIs.push(g)}}if(this.actUIs){this.actUIs.sort(function(h,k){return h.ctrl.id-k.ctrl.id})}this.html+="</div>"}$.extend(AnswerUI.prototype,CtrlUI.prototype,{constructor:AnswerUI,GetHTML:function(){return this.html},SetText:function(a){window.console&&console.log("Answer doesn't support SetText")},GetText:function(a){window.console&&console.log("Answer doesn't support GetText")},OnAttached:function(){if(this.actUI&&this.noteUI&&this.actUI.ctrl.kind==CtrlKind.TOGGLE){var b=this.actUI,a=this.noteUI.id;$('<div id="'+a+'_inp" class="evtreceiver"></div>').appendTo($("#"+a)).click(function(){b.Click();return false}).hover(function(){b.Hover(true)},function(){b.Hover(false)}).bind("mousedown mouseup",function(c){c.stopPropagation()}).css("cursor","pointer")}CtrlUI.prototype.OnAttached.call(this)}});QuizUI.Type={MULTI_CHOICE:1,MULTI_RESPONSE:2,TRUE_FALSE:3,SINGLELINE_TEXT:4,MULTI_SINGLELINE_TEXT:5,MULTILINE_TEXT:6,DROPDOWN:8,MULTI_DROPDOWN:9,SEQUENCE_DRAGDROP:10,MATCH_DRAGDROP:12,LIKERT:16};function QuizUI(a,o,n){function e(s,t){var r=CtrlKind.ANSWER,q=undefined;switch(s.type){case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:r=CtrlKind.TEXTINPUT;break;case QuizUI.Type.DROPDOWN:r=CtrlKind.COMBO;break;case QuizUI.Type.SEQUENCE_DRAGDROP:r=CtrlKind.NOTE;q=NoteType.ANSWER;break;case QuizUI.Type.MATCH_DRAGDROP:return !isNaN(t.flags)&&(t.flags&(CtrlFlags.DRAGGABLE|CtrlFlags.DROPPABLE))!=0}return(t.kind==r)&&(q===undefined||t.type==q)}CtrlUI.call(this,a,o,n);this.ctrlUIs=[];this.ansUIs=[];this.html='<div id="'+this.id+'" class="comctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,1)+'">';var d=this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP&&!this.ctrl.ansPos;var h=[];var c,f=this.ctrl.ctrls,b=f.length,l;for(l=0;l<b;++l){c=o.CreateControl(f[l],this);if(c){if(e(this.ctrl,c.ctrl)){this.ansUIs.push(c);if(d){h.push({top:c.ctrl.rect.t,left:c.ctrl.rect.l})}}this.html+=c.GetHTML();this.ctrlUIs.push(c)}}if(d){h.sort(function(r,q){return(r.top-q.top)||(r.left-q.left)});this.ctrl.ansPos=h;b=this.ansUIs.length;var m=RandomPermutation(b),g,a;for(l=0;l<b;++l){a=this.ansUIs[l].ctrl;a.curOrder=m[l];for(g=0;g<b;++g){if(h[g].top==a.rect.t&&h[g].left==a.rect.l){a.correctOrder=g;break}}}}var k,p;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){for(l=0,b=this.ansUIs.length;l<b;++l){c=this.ansUIs[l];c.curOrder=c.ctrl.curOrder;k=c.ctrl.rect;p=this.ctrl.ansPos[c.curOrder];k.t=p.top;k.l=p.left}}this.html+="</div>"}$.extend(QuizUI.prototype,CtrlUI.prototype,{constructor:QuizUI,GetHTML:function(){return this.html},SetText:function(a){window.console&&console.log("Question doesn't support SetText")},GetText:function(a){window.console&&console.log("Question doesn't support GetText")},OnAttached:function(){var f=this;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){var a={cursor:"default",start:function(g,h){f.draggingUI=f.slideUI.GetCtrlUI(this.id,false);if(!f.draggingUI||!f.draggingUI.IsEnabled()){f.draggingUI=null;return false}if(f.draggingUI){var m=convertPointFromPageToNode(f.draggingUI.GetDOM().get(0),g.pageX,g.pageY);
DropHelper.DragEffect(f.draggingUI,true,m.x,m.y);rect=f.draggingUI.ctrl.rect,strPlaceHolder='<div class="ctrl" id="ctrl_placeholder" style="'+CtrlUI.GenCSSRect(rect,1)+'"></div>',transform=f.draggingUI.ctrl.tf;f.draggingUI.holder=$(strPlaceHolder).appendTo(f.draggingUI.parentUI?f.draggingUI.parentUI.GetDOM():f.slideUI.GetDOM());if(transform){f.draggingUI.holder.css({transformOrigin:transform.oX+"% "+transform.oY+"%",transform:"rotate("+transform.r+"deg)"})}var l=parseFloat(f.draggingUI.GetDOM().css("left"))||0,k=parseFloat(f.draggingUI.GetDOM().css("top"))||0;f.draggingUI.dragOffsetX=(l-h.position.left);f.draggingUI.dragOffsetY=(k-h.position.top);f.draggingUI.mousePos={x:g.pageX,y:g.pageY}}},stop:function(g,h){if(f.draggingUI){DropHelper.DragEffect(f.draggingUI,false);var k=f.ctrl.ansPos[f.draggingUI.curOrder];h.helper.animate({top:k.top,left:k.left},DropHelper.RevertTime,function(){f.draggingUI.holder.remove();delete f.draggingUI.holder;delete f.draggingUI.dragOffsetX;delete f.draggingUI.dragOffsetY;delete f.draggingUI.mousePos;f.draggingUI=null})}},drag:function(g,q){if(!f.draggingUI){return}var k,r,m,l,o;o=f.draggingUI.GetDOM().get(0).parentNode;k=convertPointFromPageToNode(o,q.originalPosition.left,q.originalPosition.top),r=convertPointFromPageToNode(o,q.position.left,q.position.top);m=r.x-k.x;l=r.y-k.y;q.position.left=q.originalPosition.left+m;q.position.top=q.originalPosition.top+l;if(f.draggingUI.dragOffsetX){q.position.left+=f.draggingUI.dragOffsetX}if(f.draggingUI.dragOffsetY){q.position.top+=f.draggingUI.dragOffsetY}f.draggingUI.mousePos={x:g.pageX,y:g.pageY};for(b=0,e=f.ansUIs.length;b<e;++b){var h=f.ansUIs[b];if(h==f.draggingUI){continue}var p=convertPointFromPageToNode(h.GetDOM().get(0),g.pageX,g.pageY),n=h.ctrl.rect;if(p.x>=0&&p.y>=0&&p.x<=n.w&&p.y<=n.h){f.draggingUI.holder.css({top:n.t,left:n.l});f.SortAnswers(f.draggingUI,h);break}}}};for(var b=0,e=this.ansUIs.length;b<e;++b){var c=this.ansUIs[b];var d=this.ctrl.ansPos[c.ctrl.curOrder];c.GetDOM().append('<div id="'+c.id+'_inp" class="evtreceiver"></div>').css({top:d.top,left:d.left}).bind("mousedown",function(g){g.stopPropagation()}).draggable(a)}}CtrlUI.prototype.OnAttached.call(this)},Submit:function(c){if(!this.IsEnabled(true)){return}var k=this.GetSubmitedDataObject();k.v={};var w=!(this.ctrl.evt.mod&EvtMode.SURVEY);var u=!(this.ctrl.evt.mod&EvtMode.NO_REPORT);var t=(w&&((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE)),m=(w&&((this.ctrl.evt.mod&EvtMode.PARTIAL_ACTION)==EvtMode.PARTIAL_ACTION)),f=0,l=[],h=false,e,d;var r=0;var s=0,v=this.ansUIs.length;if(!w){d=Judge.NEUTRAL}else{d=Judge.CORRECT}switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:m=false;case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(s=0;s<v;++s){e=this.ansUIs[s].actUI;if(w){if(e.IsChecked()){++f;if(!e.ctrl.checked){d=Judge.WRONG}if(e.evtMan){if(t){r+=e.evtMan.GetPoints(EvtType.CHECK)}if(m){l=e.evtMan.GetActions(EvtType.CHECK)}}}else{if(e.ctrl.checked&&d!=Judge.WRONG){d=Judge.PARTIAL_CORRECT}}}else{if(e.IsChecked()){++f}}k.v[e.ctrl.id]=e.IsChecked()}if(f==0){l=this.evtMan.GetActions(EvtType.INCOMPLETE);if(l.length){d=Judge.INCOMPLETE;h=true}else{if(w){d=Judge.WRONG}else{d=Judge.NEUTRAL}}}else{if(w){if(d==Judge.CORRECT){if(!t){r=this.ctrl.evt.pt}}else{if(this.ctrl.type==QuizUI.Type.MULTI_RESPONSE&&d==Judge.WRONG){r=0;l.length=0}d=Judge.WRONG}}else{d=Judge.NEUTRAL;r=0}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(s=0;s<v;++s){e=this.ansUIs[s];e.ctrl.curOrder=e.curOrder;if(d==Judge.CORRECT){if(e.curOrder!=e.ctrl.correctOrder){d=Judge.WRONG}}k.v[e.ctrl.id]=e.curOrder}if(d==Judge.CORRECT){r=this.ctrl.evt.pt}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:e=this.ansUIs[0];if(e&&e.ctrl.kind==CtrlKind.TEXTINPUT){var g=e.evtMan.GetResponse(EvtType.TEXT,e.GetValue(),e.IsCaseSensitive(),this.evtMan,true);d=g.jud;r=g.pt;l=g.acts;h=true;k.v[e.ctrl.id]=e.GetValue()}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:var n=false,g;for(s=0;s<v;++s){e=this.ansUIs[s].actUI;g=e.evtMan.GetResponse(EvtType.TEXT,e.GetValue(),e.IsCaseSensitive(),this.evtMan,false);if(g.jud==Judge.INCOMPLETE){d=Judge.INCOMPLETE;break}else{if(g.jud==Judge.WRONG){n=true}else{if(g.jud==Judge.CORRECT){r+=g.pt}}}k.v[e.ctrl.id]=e.GetValue()}if(d==Judge.INCOMPLETE){r=0}else{if(w){if(n){d=Judge.WRONG}if(!t){r=d==Judge.WRONG?0:this.ctrl.evt.pt}}else{r=0}}break;case QuizUI.Type.MATCH_DRAGDROP:if(!c){c=this.GetResponse()}h=true;d=c.jud;if(d==Judge.PARTIAL_CORRECT){d=Judge.WRONG}r=c.pt;l=c.acts;k.v=c.v;break;case QuizUI.Type.LIKERT:for(s=0;s<v;++s){var o=this.ansUIs[s].actUIs,q;for(q=0;q<o.length;++q){if(o[q].IsChecked()){++f;k.v[this.ansUIs[s].ctrl.id]=q;break}}}if(f<v){l=this.evtMan.GetActions(EvtType.INCOMPLETE);if(l.length){d=Judge.INCOMPLETE;h=true}else{d=Judge.NEUTRAL}}else{d=Judge.NEUTRAL;r=0}break}if(!h){switch(d){case Judge.INCOMPLETE:l=this.evtMan.GetActions(EvtType.INCOMPLETE);break;case Judge.NEUTRAL:l=this.evtMan.GetActions(EvtType.COMPLETE);break;case Judge.CORRECT:l=l.concat(this.evtMan.GetActions(EvtType.CORRECT));break;case Judge.WRONG:l=l.concat(this.evtMan.GetActions(EvtType.WRONG));break}}if(d!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}}k.a=this.evtMan.curAtp;k.p=r;k.j=d;k.r=u;if(bSendToLMS&&u){var a=this.slideUI.slide,b=Prez.GetLearnerResponse(a,this.ctrl,k),p=Prez.GetCorrectResponse(a,this.ctrl);Prez.LMS.StoreInteractionData(this.ctrl,this.slideUI.slide,d,r,b,p)}EvtMan.DoActions(l,this)},GetResponse:function(){var h={jud:Judge.UNEXPECTED,pt:0,acts:[],v:{}};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return h}if(this.ctrl.type!=QuizUI.Type.MATCH_DRAGDROP){return h}var p,k,e,f,b,q,a,o,d=false,t=false,l=false,s=false,c=this.ctrl.dragdrops,g=this.ansUIs,r;for(p=0,e=g.length;p<e;++p){if(!(g[p].ctrl.flags&CtrlFlags.DRAGGABLE)){if(g[p].ctrl.flags&CtrlFlags.DROPPABLE){q=g[p];o=q.ctrl.id;r=q.dropHelper?q.dropHelper.GetDroppedUIs():[];f=r.length;if(f>0){if(!h.v[o]){h.v[o]=[]}for(k=0;k<f;++k){b=r[k];if(q.dropHelper.IsAbsoluteDroppedPos()&&b.pos){h.v[o].push({id:b.ctrl.id,t:b.pos.t,l:b.pos.l})}else{h.v[o].push(b.ctrl.id)}}}}continue}d=true;b=g[p];a=b.ctrl.id;q=b.GetDropCtrlUI();if(q){o=q.ctrl.id;t=true;if(c){if(c[a]&&c[a][o]!==undefined){h.pt+=c[a][o]}else{l=true}}}else{if(!s&&!l&&c&&c[a]){s=true}}}if(d&&!t){h.acts=this.evtMan.GetActions(EvtType.INCOMPLETE);if(h.acts.length){h.jud=Judge.INCOMPLETE;h.pt=0}else{if(!s&&c){s=true}}}if(h.jud!=Judge.INCOMPLETE){if(this.ctrl.evt.mod&EvtMode.SURVEY){h.jud=Judge.NEUTRAL;h.pt=0;h.acts=this.evtMan.GetActions(EvtType.COMPLETE)}else{if(l||s){h.jud=l?Judge.WRONG:Judge.PARTIAL_CORRECT;h.acts=this.evtMan.GetActions(EvtType.WRONG)}else{h.jud=Judge.CORRECT;h.acts=this.evtMan.GetActions(EvtType.CORRECT)}if((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)!=EvtMode.PARTIAL_SCORE){h.pt=h.jud==Judge.WRONG?0:this.ctrl.evt.pt}}}return h},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}var c=0,f=this.ansUIs.length,g,h;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(c=0;c<f;++c){this.ansUIs[c].actUI.Check(false)}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(c=0;c<f;++c){g=this.ansUIs[c];g.curOrder=g.ctrl.curOrder;h=this.ctrl.ansPos[g.curOrder];g.GetDOM().css({top:h.top,left:h.left});g.ctrl.rect.t=h.top;g.ctrl.rect.l=h.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:g=this.ansUIs[0];if(g&&g.SetValue){g.SetValue("")}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(c=0;c<f;++c){g=this.ansUIs[c].actUI;if(g&&g.SetValue){g.SetValue("")}}break;case QuizUI.Type.MATCH_DRAGDROP:var e=this.ansUIs;for(c=0;c<e.length;++c){if(e[c].dropHelper){e[c].dropHelper.ResetAllDropped()}}break;case QuizUI.Type.LIKERT:for(c=0;c<f;++c){var d=this.ansUIs[c].actUIs,b;for(b=0;b<d.length;++b){d[b].Check(false)}}break}},RadioChecked:function(g){var d,c,e,f,b,h,a;for(d=0,h=this.ansUIs.length;d<h;++d){if(this.ctrl.type==QuizUI.Type.LIKERT){f=this.ansUIs[d].actUIs;
b=-1;for(c=0,a=f.length;c<a;++c){if(f[c]==g){b=c;break}}if(b<0){continue}for(c=0;c<f.length;++c){e=f[c];if(e!=g&&e.IsChecked&&e.IsChecked()){e.Check(false)}}break}else{e=this.ansUIs[d].actUI;if(e!=g&&e.IsChecked&&e.IsChecked()){e.Check(false)}}}},SortAnswers:function(b,g){var a,d,h,k,f,c=this.ansUIs.length,l=b.curOrder,e=g.curOrder;for(f=0;f<c;++f){a=this.ansUIs[f];if(a==b){b.curOrder=e;h=this.ctrl.ansPos[e];k=a.ctrl.rect;k.t=h.top;k.l=h.left;continue}d=a.curOrder;if(d>l){--d}if(d>=e){++d}if(d!=a.curOrder){a.curOrder=d;h=this.ctrl.ansPos[d];k=a.ctrl.rect;a.GetDOM().css({top:h.top,left:h.left});k.t=h.top;k.l=h.left}}},LoadSubmitedData:function(o){var n=o[this.ctrl.id];if(!n){return}if(n.a){this.evtMan.curAtp=n.a}var b=n.v;if(!b){return}var c,k,l;var h=0,m=this.ansUIs.length;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(h=0;h<m;++h){c=this.ansUIs[h].actUI;k=b[c.ctrl.id];if(k!=undefined){c.Check(k)}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(h=0;h<m;++h){c=this.ansUIs[h];c.curOrder=b[c.ctrl.id];c.ctrl.curOrder=c.curOrder;l=this.ctrl.ansPos[c.curOrder];c.GetDOM().css({top:l.top,left:l.left});c.ctrl.rect.t=l.top;c.ctrl.rect.l=l.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:c=this.ansUIs[0];if(c&&c.ctrl.kind==CtrlKind.TEXTINPUT){k=b[c.ctrl.id];if(k!=undefined){c.SetValue(k)}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(h=0;h<m;++h){c=this.ansUIs[h].actUI;k=b[c.ctrl.id];if(k!=undefined){c.SetValue(k)}}break;case QuizUI.Type.MATCH_DRAGDROP:var d=this.ansUIs;for(h=0;h<d.length;++h){if(d[h].dropHelper){d[h].dropHelper.ResetAllDropped()}}var g,f,a,l={top:0,left:0};for(g in b){if(b.hasOwnProperty(g)){f=this.slideUI.GetCtrlUI(g,true);if(f&&f.dropHelper){for(h=0;h<b[g].length;++h){if(typeof b[g][h]==="object"){a=this.slideUI.GetCtrlUI(b[g][h].id,true);l.top=b[g][h].t;l.left=b[g][h].l}else{a=this.slideUI.GetCtrlUI(b[g][h],true)}if(a){f.dropHelper.Drop(a,l,false)}}}}}break;case QuizUI.Type.LIKERT:for(h=0;h<m;++h){var p=this.ansUIs[h].actUIs,e;k=b[this.ansUIs[h].ctrl.id];for(e=0;e<p.length;++e){p[e].Check(k!==undefined&&k==e)}}break}}});ToggleUI.State={COUNT:3,CHECKED:1,HOVERED:2,DISABLED:4,PUSHED:8};function ToggleUI(c,a,b){CtrlUI.call(this,c,a,b);this.bgId=this.id+"_bg";this.inputId=this.id+"_inp";this.curState=0}$.extend(ToggleUI.prototype,CtrlUI.prototype,{constructor:ToggleUI,GetHTML:function(){var b,a="";if(this.ctrl.acctext){a=this.ctrl.acctext}b='<img id="'+this.bgId+'" class="togglebgimg" src="'+this.GetImg()+'" alt="'+a+'" role="presentation" width="200%" height="300%" />';return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,1)+'">'+b+'<div id="'+this.inputId+'" class="evtreceiver"></div></div>'},SetText:function(a){window.console&&console.log("Checkbox and Radio button don't support SetText")},GetText:function(a){window.console&&console.log("Checkbox and Radio button don't support GetText")},OnAttached:function(){this.UpdateBGPos();var a=this;$("#"+this.inputId).click(function(b){a.Click();return false}).hover(function(){a.Hover(true)},function(){a.Hover(false)}).bind("mousedown mouseup",function(b){b.stopPropagation()}).css("cursor","pointer");CtrlUI.prototype.OnAttached.call(this)},IsEnabled:function(a){if(this.curState&ToggleUI.State.DISABLED){return false}return CtrlUI.prototype.IsEnabled.call(this,a)},GetImg:function(){return Prez.GetResource(this.ctrl.image,"png")},Check:function(a){if(a){this.curState|=ToggleUI.State.CHECKED}else{this.curState&=~ToggleUI.State.CHECKED}this.UpdateBGPos()},IsChecked:function(){return(this.curState&ToggleUI.State.CHECKED)},Click:function(){if(!this.IsEnabled()){return}if(!this.ctrl.radio){this.curState^=ToggleUI.State.CHECKED;this.UpdateBGPos()}else{if((this.curState&ToggleUI.State.CHECKED)==0){this.curState|=ToggleUI.State.CHECKED;this.UpdateBGPos();var a=this.GetTopLevel();if(a.RadioChecked){a.RadioChecked(this)}}}},Hover:function(a){if(!this.IsEnabled()){return}if(a){this.curState|=ToggleUI.State.HOVERED}else{this.curState&=~ToggleUI.State.HOVERED}this.UpdateBGPos()},UpdateBGPos:function(){var a=0,b=0;if(!(this.curState&ToggleUI.State.CHECKED)){a=-100}if(this.curState&ToggleUI.State.DISABLED){b=2}else{if(this.curState&ToggleUI.State.PUSHED){b=3}else{if(this.curState&ToggleUI.State.HOVERED){b=1}}}if(b>ToggleUI.State.COUNT-1){b=0}if(b!=0){b*=-100}$("#"+this.bgId).css({top:b+"%",left:a+"%"})},CleanUp:function(){var a=$("#"+this.inputId);if(this.showState!=CtrlShowState.HIDE){a.removeClass("evtreceiver")}a.unbind();CtrlUI.prototype.CleanUp.call(this)}});function FeedbackUI(c,a,b){CtrlUI.call(this,c,a,b);this.keyH=c.rect.h;this.keySpacing=Math.floor(this.keyH/6);this.mouseW=Math.floor((this.keyH-1)*2/3)+1;this.LMBgPos=-(6*this.keyH+2);this.RMBgPos=-(-this.LMBgPos+this.mouseW+2);this.minTextW=this.keyH-2*c.tr.l;if(this.minTextW<0){this.minTextW=0}this.prevModifiers=0}$.extend(FeedbackUI.prototype,CtrlUI.prototype,{constructor:FeedbackUI,GetHTML:function(){var a='<div id="'+this.id+'" class="feedbackctrl" style="top:'+(this.ctrl.rect.t)+"px;left:"+(this.ctrl.rect.l)+'px;">'+this._GetKeyHTML(this.id+"_c","Ctrl")+this._GetKeyHTML(this.id+"_s","Shift")+this._GetKeyHTML(this.id+"_a","Alt")+this._GetKeyHTML(this.id+"_k","A")+this._GetMouseHTML(this.id+"_m")+"</div>";return a},SetText:function(a){window.console&&console.log("Feedback doesn't support SetText")},GetText:function(a){window.console&&console.log("Feedback doesn't support GetText")},_GetKeyHTML:function(d,c){var a=" url('"+this.GetImg()+"') no-repeat;";var b='<div id="'+d+'" class="ctrl" style="width:'+this.keyH+"px;height:"+this.keyH+'px;top:0px;left:0px;"><div id="'+d+'_l" style="background:'+a+"width:"+this.keyH+'px;height:100%;"></div><div id="'+d+'_r" style="background:top right'+a+'position:absolute;top:0;left:0;width:100%; height:100%;"><div id="'+d+'_text" style="position:absolute;white-space:nowrap;top:'+this.ctrl.tr.t+"px;margin:0px "+this.ctrl.tr.l+"px;"+this.ctrl.css+'">'+c+"</div></div></div>";return b},_GetMouseHTML:function(b){var a='<div id="'+b+'" class="ctrl" style="width:'+this.mouseW+"px;height:"+this.keyH+"px;top:0px;left:0px;background:"+this.LMBgPos+"px 0px url('"+this.GetImg()+"') no-repeat;\"></div>";return a},_SetKey:function(d,c){var a=this.keyH,b=this._GetTextWidth(c);if(b>this.minTextW){a+=(b-this.minTextW)}$("#"+d).width(a);$("#"+d+"_l").width(a-Math.floor(this.keyH/2)+3);$("#"+d+"_text").text(c).width(a-2*this.ctrl.tr.l)},_GetTextWidth:function(c){var a=$('<span style="position:absolute;top:-1000px;left:-1000px;'+this.ctrl.css+'"></span>');var b=a.text(c).appendTo(UI.ViewPort()).width();a.remove();return b},OnAttached:function(){this._SetKey(this.id+"_c","Ctrl");this._SetKey(this.id+"_s","Shift");this._SetKey(this.id+"_a","Alt");CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);var b=this;$(document).bind("feedback."+this.id,function(d,c){b.SetValue(c)})},_OnHideComplete:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype._OnHideComplete.call(this)},CleanUp:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype.CleanUp.call(this)},SetValue:function(c){$(this).stopTime("hidekeys");var f=0,b=0;if(c.ctrlKey){f+=$("#"+this.id+"_c").show().width()+this.keySpacing;b|=Key.MOD_CTRL}else{$("#"+this.id+"_c").hide()}if(c.shiftKey){f+=$("#"+this.id+"_s").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_SHIFT}else{$("#"+this.id+"_s").hide()}if(c.altKey){f+=$("#"+this.id+"_a").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_ALT}else{$("#"+this.id+"_a").hide()}var d=b!=this.prevModifiers;this.prevModifiers=b;var a=c.apWhich;switch(a){case Key.CTRL:case Key.SHIFT:case Key.ALT:$("#"+this.id+"_k").hide();if(d){$("#"+this.id+"_m").hide()}break;case Mouse.Buttons.LEFT:case Mouse.Buttons.DBLEFT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.LMBgPos+"px 0px"}).show();
break;case Mouse.Buttons.RIGHT:case Mouse.Buttons.DBRIGHT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.RMBgPos+"px 0px"}).show();break;default:var e;if((Key.NUMBER0<=a&&a<=Key.NUMBER9)||(Key.A<=a&&a<=Key.Z)){e=String.fromCharCode(a)}else{if(Key.NUMPAD0<=a&&a<=Key.NUMPAD9){e="Numpad "+(a-Key.NUMPAD0)}else{if(Key.F1<=a&&a<=Key.F12){e="F"+(a-Key.F1+1)}else{e=KeyNames[a];if(e===undefined){e="Unrecognized"}}}}$("#"+this.id+"_m").hide();this._SetKey(this.id+"_k",e);$("#"+this.id+"_k").css("left",f+"px").show();break}$(this).oneTime(1000,"hidekeys",function(){$("#"+this.id+"_c").hide();$("#"+this.id+"_s").hide();$("#"+this.id+"_a").hide();$("#"+this.id+"_k").hide();$("#"+this.id+"_m").hide();this.prevModifiers=0})},UpdateZoomAreaEffect:function(){var d=this.GetDOM();if(ZoomUI.Scale==1&&ZoomUI.X==0&&ZoomUI.Y==0){d.css({transformOrigin:"",transform:""})}else{var c=1/ZoomUI.Scale,b=this.ctrl.rect,a,e;a=b.l/ZoomUI.Scale+ZoomUI.X;e=b.t/ZoomUI.Scale+ZoomUI.Y;d.css({transformOrigin:"0% 0%",transform:"scale("+c+", "+c+")"});d.css("left",a).css("top",e)}}});function GetMediaAltHTML(){return""}function MediaUI(g,a,f){CtrlUI.call(this,g,a,f);if(g.kind==CtrlKind.AUDIO){g.rect={t:0,l:0,w:1,h:1};if(g.audio>0){this.resUrl="data/res_"+g.audio+"."+MediaManager.strAudioExt}this.playerId=a.GetAudioPlayerId()}else{if(g.video>0){this.resUrl="data/res_"+g.video+"."+MediaManager.strVideoExt}this.playerId=a.isPrjSldTop?Prez.slideUI.GetVideoPlayerId():a.GetVideoPlayerId();a.lastDOMId=this.playerId}this.id=this.playerId;$("#"+this.id).attr("style",CtrlUI.GenCSSRect(this.ctrl.rect,1));if(g.kind==CtrlKind.VIDEO){this.vStartFrameId=this.id+"_vstart_frame";this.vEndFrameId=this.id+"_vend_frame";var c="";var b=a.slide.id;if(g.slideContainerID!=undefined){b=g.slideContainerID}if(this.ctrl.acctext){c=this.ctrl.acctext}if(this.resUrl){var e="data/vstart_img_"+b+"."+this.ctrl.id+".jpg";var d="data/vend_img_"+b+"."+this.ctrl.id+".jpg";$("#"+this.vStartFrameId).attr("alt",c).attr("src",e).show();$("#"+this.vEndFrameId).attr("alt",c).attr("src",d).show();this.firstFrameHidden=false}else{$("#"+this.vStartFrameId).attr("alt",c).attr("src","").hide();$("#"+this.vEndFrameId).attr("alt",c).attr("src","").hide()}$("#"+this.id).css("transform-origin","0% 0%").css("transform","scale(1, 1)")}this.player=null;this.bIncBuffCount=false;if(!this.IsTriggeredByEvent()){if(!this.resUrl||((this.ctrl.outeff||(!isNaN(this.endTime)&&this.endTime<0))&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){this.hideWhenComplete=false}else{this.hideWhenComplete=true}}this.waitForTimeUpdate=false;this.resumeTokenAccepted=false;this.mediaSeeked=true}$.extend(MediaUI.prototype,CtrlUI.prototype,{constructor:MediaUI,GetHTML:function(){return""},SetText:function(a){window.console&&console.log("Audio and Video don't support SetText")},GetText:function(a){window.console&&console.log("Audio and Video don't support GetText")},IsBGMedia:function(){if(this.ctrl.flags){return(this.ctrl.flags&CtrlFlags.NOT_WAIT)}return false},IsLoop:function(){if(this.ctrl.flags){return(this.ctrl.flags&CtrlFlags.LOOP)}return false},InitMediaPlayer:function(){if(!this.resUrl){return}var a={width:this.ctrl.rect.w,height:this.ctrl.rect.h,file:this.resUrl,repeat:this.IsLoop()?"true":"false",mode:"audio"};if(this.ctrl.kind==CtrlKind.VIDEO){a.displayheight=a.height;a.mode="video";a.v_w=this.ctrl.v_w;a.v_h=this.ctrl.v_h}var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()},timeupdated:function(c){this._OnPlayerTimeUpdated(c)}};$("#"+this.playerId).show();this.player=MediaManager.CreatePlayer(a,this.playerId,b);if(this.player.SetPlaybackRate){this.player.SetPlaybackRate(Prez.playbackRate)}},Attach:function(a){if(this.ctrl.kind!=CtrlKind.AUDIO){if(a.isPrjSldTop){a=Prez.slideUI}if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id}},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);this._HandleExitFullScreenIfIPhone(true)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsTriggeredByEvent()){if(!this.resUrl||(this.ctrl.outeff&&(this.ctrl.duration==0||(this.ctrl.duration>0&&!this.IsLoop())))){this.hideWhenComplete=false}else{this.hideWhenComplete=true}}if(!this.player){this.InitMediaPlayer()}if(!this.player){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var b=this.player.GetState();Log(this.id+": _OnShowStart Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.player.Play(false,a)}b=this.player.GetState();Log(this.id+": _OnShowStart Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this.playingPaused=true;this._IncBufCount()}else{if(b!=MediaStates.ERROR){if(Prez.runningStreams==PrezStreams.NONE||(Prez.runningStreams==PrezStreams.SECOND&&!this.IsBGMedia()&&!this.IsTriggeredByEvent())){this.player.Play(false);this.playingPaused=true}else{if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._IncBufCount();this.player.Play(true);this.playingPaused=false;this.waitForTimeUpdate=true;this.mediaSeeked=false}else{this.player.Play(true);this.playingPaused=false}if(BrowserInfo.ie){this.player.SetPlaybackRate(Prez.playbackRate)}}}}},_OnHideComplete:function(){if(this.player){var a=this.player.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.player.Play(false)}}CtrlUI.prototype._OnHideComplete.call(this)},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:this.GetShowState(a,b);if(b.value!=this.showState&&(b.value!=CtrlShowState.HIDE||!this.hideWhenComplete)){this.Show(b)}break;case CtrlShowState.HIDE:if(!this.ended){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break}},Update:function(a){if(this.player){this.player.Play(false)}if(a){this._DecBufCount()}else{this.bIncBuffCount=false}this.playingPaused=false;this.ended=false;if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).show()}CtrlUI.prototype.Update.call(this,a)},_HandleExitFullScreenIfIPhone:function(c){Log("Handle: "+c);if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.iPhone){var a=$("#"+MediaManager.GetPlayerId(this.id,false));if(c){var b=this;a.bind("webkitendfullscreen webkitfullscreenchange mozfullscreenchange fullscreenchange",function(f){Log(f.type);var d=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||a[0].webkitDisplayingFullscreen;if(!d){if(b.ignoreNextExitFSEvent){Log("Ignore exit full screen event");delete b.ignoreNextExitFSEvent;return}if(b.showState==CtrlShowState.SHOW){Log("Pause presentation due to exiting full screen manually");Prez.Pause(PrezStreams.ALL);b.iPhoneResume=true;a.css("pointer-events","auto")}}});a.bind("click",function(){if(b.iPhoneResume){delete b.iPhoneResume;Prez.TogglePause();a.css("pointer-events","none")}})}else{a.unbind("webkitendfullscreen webkitfullscreenchange mozfullscreenchange fullscreenchange");a.unbind("click")}}},_ExitFullScreenIfIPhone:function(){if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.iPhone){var a=$("#"+MediaManager.GetPlayerId(this.id,false))[0];var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||a.webkitDisplayingFullscreen;if(!b){return}this.ignoreNextExitFSEvent=true;Log("Exit fullscreen mode automatically");if(a.webkitExitFullscreen){a.webkitExitFullscreen()}else{if(a.mozCancelFullScreen){a.mozCancelFullScreen()}else{if(a.msExitFullscreen){a.msExitFullscreen()}else{if(a.exitFullscreen){a.exitFullscreen()}}}}}},UpdatePrezStateChanged:function(){if((Prez.runningStreams==PrezStreams.NONE&&(!Prez.IsBuffering()||!this.IsBGMedia()))||(Prez.runningStreams==PrezStreams.SECOND&&!this.IsBGMedia()&&!this.IsTriggeredByEvent())){if(this.player&&this.showState!=CtrlShowState.HIDE){var a=this.player.GetState();
if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.BUFFERING){this.player.Play(false);this._ExitFullScreenIfIPhone()}else{Log(this.id+": Pause a non ready player, state: "+a)}}this.playingPaused=true}if(Prez.runningStreams==PrezStreams.ALL||(Prez.runningStreams==PrezStreams.SECOND&&(this.IsBGMedia()||this.IsTriggeredByEvent()))){if(this.playingPaused&&this.player&&this.showState!=CtrlShowState.HIDE){var a=this.player.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.player.Play(true);if(BrowserInfo.ie){this.player.SetPlaybackRate(Prez.playbackRate)}}else{Log(this.id+": Resume a non ready player, state: "+a)}}this.playingPaused=false}if(this.iPhoneResume&&Prez.runningStreams!=PrezStreams.NONE){delete this.iPhoneResume;$("#"+MediaManager.GetPlayerId(this.id,false)).css("pointer-events","none")}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},UpdatePlaybackRateChanged:function(){if(this.player&&this.player.SetPlaybackRate){this.player.SetPlaybackRate(Prez.playbackRate)}},Zoom:function(b,a,c){if(this.ctrl.kind!=CtrlKind.AUDIO){CtrlUI.prototype.Zoom.call(this,b,a,c)}},CleanUp:function(){this._HandleExitFullScreenIfIPhone(false);if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide();$(this).stopTime("hide_vstart_frame")}if(this.player){this.player.CleanUp();this.player=null}CtrlUI.prototype.CleanUp.call(this)},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.player){this.player.SetVolume(a)}},AcceptResumeToken:function(){if(!this.player){return false}if(Prez.runningStreams==PrezStreams.ALL||(Prez.runningStreams==PrezStreams.SECOND&&(this.IsBGMedia()||this.IsTriggeredByEvent()))){if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying&&this.mediaSeeked){this.playingPaused=false;this.resumeTokenAccepted=true;this.mediaSeeked=false;Log(this.id+": AcceptResumeToken: Accepted");this.player.Play(true);if(BrowserInfo.ie){this.player.SetPlaybackRate(Prez.playbackRate)}return true}}return false},_OnPlayerReady:function(){if(this.player){this.player.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=undefined}this.player.Play(false,a)}b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide()}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._OnPlayerTimeUpdated(1)}if(this.player&&this.player.IsReady()){if(!this.IsLoop()){this._ExitFullScreenIfIPhone();if(this.hideWhenComplete){this.Hide(false)}this.ended=true}}},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.player){return}var a=this.player.GetState();if(!this.bIncBuffCount){if(a==MediaStates.OPENING||a==MediaStates.BUFFERING){this._IncBufCount()}}else{if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.ERROR||a==MediaStates.STOPPED){this._DecBufCount()}}},_OnPlayerTimeUpdated:function(a){if(!this.firstFrameHidden&&this.ctrl.kind==CtrlKind.VIDEO&&a>0){this.firstFrameHidden=true;$("#"+this.vStartFrameId).hide()}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){if(a>0){if(this.waitForTimeUpdate){this.waitForTimeUpdate=false;this._DecBufCount()}if(this.resumeTokenAccepted){this.resumeTokenAccepted=false;Prez.Resume(Prez.shouldResumeStreams);Prez.shouldResumeStreams=PrezStreams.NONE}}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime}if(this.IsLoop()){var b=this.ctrl.duration;if(b>0){while(a>=b){a-=b}}}if(a<0){a=0}return a}});function YouTubeUI(c,a,b){CtrlUI.call(this,c,a,b);this.YTPlayer=null;this.autoplay=c.YT_params.auto_play;this.userClickPlay=false;if(c.YT_params.play_range===true){this.videoStart=c.YT_params.start_time||0;this.videoStop=c.YT_params.stop_time||0}else{this.videoStart=0;this.videoStop=0}}YouTubeUI.State={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,VIDEOCUED:5};$.extend(YouTubeUI.prototype,CtrlUI.prototype,{constructor:YouTubeUI,GetLabelHTML:function(){return""},GetHTML:function(){var b=this.ctrl.rect,a=this.GetARIAAttrs();return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(b,1)+';background-color:black; pointer-events:auto;" aria-hidden="true" '+a+'><div id="'+this.id+'_player" class="bgimg"></div></div>'},GetInputHTML:function(){return""},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);var b=this.ctrl.rect,a=this,d=this.ctrl.YT_params,c={rel:0,showinfo:0,autoplay:0,playsinline:1};if(Prez.YTState!=RL_YT_State.LOADED){$("#"+this.id+"_player").append(Lang.YouTubeError);return}c.controls=d.hide_controls?0:1;c.iv_load_policy=d.hide_annotations?3:1;c.start=this.videoStart/1000;if(this.videoStop>0){c.end=this.videoStop/1000}this.YTPlayer=new YT.Player(this.id+"_player",{height:b.h,width:b.w,videoId:d.youtube_id,playerVars:c,events:{onReady:function(){a._OnPlayerReady()},onStateChange:function(){a._OnPlayerStateChanged()},onError:function(){a._OnPlayerError()}}});this.UpdatePrezPropertyChanged("Scale")},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(!this.YTPlayer||!this.autoplay){return}var b=(typeof this.YTPlayer.getPlayerState==="function")?this.YTPlayer.getPlayerState():YouTubeUI.State.UNSTARTED;Log(this.id+": YouTube:_OnPlayerReady Player State 1: "+b);if(b==YouTubeUI.State.BUFFERING||b==YouTubeUI.State.PAUSED||b==YouTubeUI.State.PLAYING||b==YouTubeUI.State.VIDEOCUED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;a+=this.videoStart/1000;if(a<0.5){a=0}this.YTPlayer.pauseVideo();this.YTPlayer.seekTo(a,true)}b=(typeof this.YTPlayer.getPlayerState==="function")?this.YTPlayer.getPlayerState():YouTubeUI.State.UNSTARTED;Log(this.id+": YouTube:_OnPlayerReady Player State 2: "+b);if(b==YouTubeUI.State.UNSTARTED||b==YouTubeUI.State.ENDED||b==YouTubeUI.State.BUFFERING){this.playingPaused=true;this._IncBufCount()}else{if(Prez.runningStreams==PrezStreams.NONE||(Prez.runningStreams==PrezStreams.SECOND&&!this.IsTriggeredByEvent())){this.YTPlayer.pauseVideo();this.playingPaused=true}else{this.YTPlayer.playVideo();if(BrowserInfo.ie){this.YTPlayer.setPlaybackRate(Prez.playbackRate)}this.playingPaused=false}}},_OnHideComplete:function(){if(this.YTPlayer){var a=(typeof this.YTPlayer.getPlayerState==="function")?this.YTPlayer.getPlayerState():YouTubeUI.State.UNSTARTED;if(a==YouTubeUI.State.BUFFERING||a==YouTubeUI.State.PAUSED||a==YouTubeUI.State.PLAYING||a==YouTubeUI.State.VIDEOCUED){this.YTPlayer.pauseVideo()}}CtrlUI.prototype._OnHideComplete.call(this)},Update:function(a){if(!this.YTPlayer||!this.autoplay){CtrlUI.prototype.Update.call(this,a);return}if(this.YTPlayer.pauseVideo){this.YTPlayer.pauseVideo()}if(a){this._DecBufCount()}else{this.bIncBuffCount=false}this.playingPaused=false;CtrlUI.prototype.Update.call(this,a)},UpdatePrezStateChanged:function(){if(!this.YTPlayer||(!this.autoplay&&!this.userClickPlay)){CtrlUI.prototype.UpdatePrezStateChanged.call(this);return}var b=Prez.runningStreams;if((b==PrezStreams.NONE&&!Prez.IsBuffering())||(b==PrezStreams.SECOND&&!this.IsTriggeredByEvent())){if(this.YTPlayer&&this.showState!=CtrlShowState.HIDE){var a=(typeof this.YTPlayer.getPlayerState==="function")?this.YTPlayer.getPlayerState():YouTubeUI.State.UNSTARTED;if(a==YouTubeUI.State.PAUSED||a==YouTubeUI.State.PLAYING||a==YouTubeUI.State.BUFFERING||a==YouTubeUI.State.VIDEOCUED){this.YTPlayer.pauseVideo()}else{Log(this.id+": YouTube: Pause a non ready player, state: "+a)
}}this.playingPaused=true}if(b==PrezStreams.ALL||(b==PrezStreams.SECOND&&this.IsTriggeredByEvent())){if(this.playingPaused&&this.YTPlayer&&this.showState!=CtrlShowState.HIDE){var a=(typeof this.YTPlayer.getPlayerState==="function")?this.YTPlayer.getPlayerState():YouTubeUI.State.UNSTARTED;if(a==YouTubeUI.State.PAUSED||a==YouTubeUI.State.PLAYING||a==YouTubeUI.State.ENDED||a==YouTubeUI.State.VIDEOCUED){this.YTPlayer.playVideo();if(BrowserInfo.ie){this.YTPlayer.setPlaybackRate(Prez.playbackRate)}}else{Log(this.id+": YouTube: Resume a non ready player, state: "+a)}}this.playingPaused=false}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},UpdatePrezPropertyChanged:function(c,e){if(c=="Scale"){if(this.ctrl.YT_params.disable_scaling){var a=$("#"+this.id+"_player"),b={x:0,y:0,transformOrigin:"",transform:"",width:this.ctrl.rect.w,height:this.ctrl.rect.h};if(Prez.Scale!=1){var d=1/Prez.Scale;b.width*=Prez.Scale;b.height*=Prez.Scale;b.transformOrigin="0% 0%";b.transform="scale("+d+", "+d+")"}a.css(b)}}else{CtrlUI.prototype.UpdatePrezPropertyChanged(c,e)}},UpdatePlaybackRateChanged:function(){if(!this.YTPlayer){return}if(typeof this.YTPlayer.setPlaybackRate==="function"){this.YTPlayer.setPlaybackRate(Prez.playbackRate)}},CleanUp:function(){if(this.YTPlayer){this.YTPlayer=null}CtrlUI.prototype.CleanUp.call(this)},_OnPlayerReady:function(){if(!this.YTPlayer){return}this.YTPlayer.setVolume(Prez.GetVolume(true));this.YTPlayer.setPlaybackRate(Prez.playbackRate);if(this.showState==CtrlShowState.HIDE){return}if(!this.autoplay){return}var b=this.YTPlayer.getPlayerState();Log(this.id+": YouTube:_OnPlayerReady Player State 1: "+b);if(b==YouTubeUI.State.BUFFERING||b==YouTubeUI.State.PAUSED||b==YouTubeUI.State.PLAYING||b==YouTubeUI.State.VIDEOCUED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;a+=this.videoStart/1000;if(a<0.5){a=0}Log(this.id+": YouTube:seekTo Player State 1: "+b);this.YTPlayer.seekTo(a,true)}b=this.YTPlayer.getPlayerState();Log(this.id+": YouTube:_OnPlayerReady Player State 2: "+b);if(b==YouTubeUI.State.UNSTARTED||b==YouTubeUI.State.ENDED||b==YouTubeUI.State.BUFFERING){this._IncBufCount()}else{this._DecBufCount()}},_OnPlayerStateChanged:function(){if(!this.YTPlayer){return}Log(this.id+": YouTube:_OnPlayerStateChanged....");if(this.showState==CtrlShowState.HIDE){return}var a=this.YTPlayer.getPlayerState();if(!this.autoplay){if(a==YouTubeUI.State.PLAYING){this.userClickPlay=true}return}Log(this.id+": YouTube:_OnPlayerStateChanged Player State "+a);if(!this.bIncBuffCount){if(a==YouTubeUI.State.BUFFERING||a==YouTubeUI.State.UNSTARTED){this._IncBufCount()}}else{if(a==YouTubeUI.State.PAUSED||a==YouTubeUI.State.PLAYING||a==YouTubeUI.State.ENDED||a==YouTubeUI.State.VIDEOCUED){this._DecBufCount()}}},_OnPlayerError:function(){if(!this.YTPlayer||!this.autoplay){return}if(this.bIncBuffCount){this._DecBufCount()}}});function WebObjectUI(c,a,b){CtrlUI.call(this,c,a,b);this.frameId=this.id+"_frame";this.error=false;this.loaded=false;this.loadFrameTimeOut=20000}$.extend(WebObjectUI.prototype,CtrlUI.prototype,{constructor:WebObjectUI,GetLabelHTML:function(){return""},GetHTML:function(){var b=this.ctrl.rect,a=this.GetARIAAttrs(),c;if(this.ctrl.web_params.address){c='<iframe id="'+this.frameId+'" style="position:absolute;left:0px;top:0px;width:100%;height:100%;border:none;"></iframe>'}else{c='<div id="'+this.frameId+'" style="position:absolute;left:0px;top:0px;width:100%;height:100%;border:none;">'+this.ctrl.web_params.embed_code+"</div>"}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(b,1)+';overflow:hidden;pointer-events:auto;" aria-hidden="true" '+a+">"+c+"</div>"},GetInputHTML:function(){return""},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);var a=this.ctrl.web_params,d=this,e=this.GetDOM(),c=$("#"+this.frameId);c.attr("scrolling",a.scrolling?"auto":"no");c.css("overflow",a.scrolling?"auto":"hidden");if(a.address){var b=c.get(0);b.onload=function(){d._OnFrameLoaded};b.onerror=function(){d._OnFrameError};b.src=a.address;$(this).oneTime(this.loadFrameTimeOut,"tm_iframe_load",function(){d._OnFrameTimeOut()})}else{this.loaded=true;e.bind("mousedown",function(f){f.stopPropagation()})}this.UpdatePrezPropertyChanged("Scale")},UpdatePrezPropertyChanged:function(c,e){if(c=="Scale"){if(this.ctrl.web_params.disable_scaling){var a=$("#"+this.frameId),b={x:0,y:0,transformOrigin:"",transform:"",width:this.ctrl.rect.w,height:this.ctrl.rect.h};if(Prez.Scale!=1){var d=1/Prez.Scale;b.width*=Prez.Scale;b.height*=Prez.Scale;b.transformOrigin="0% 0%";b.transform="scale("+d+", "+d+")"}a.css(b)}}else{CtrlUI.prototype.UpdatePrezPropertyChanged(c,e)}},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(!this.loaded&&!this.error){this._IncBufCount()}},_OnFrameLoaded:function(){this.loaded=true;$(this).stopTime("tm_iframe_load");this._DecBufCount()},_OnFrameError:function(){this.error=true;$(this).stopTime("tm_iframe_load");Log("Load frame error:"+this.id+": "+this.ctrl.web_params.address);this._DecBufCount()},_OnFrameTimeOut:function(){this.error=true;Log("Load frame timeout:"+this.id+": "+this.ctrl.web_params.address);this._DecBufCount()},CleanUp:function(){$(this).stopTime("tm_iframe_load");var a=$("#"+this.frameId).get(0);if(a){a.onload=null;a.onerror=null}CtrlUI.prototype.CleanUp.call(this)},});CursorUI.State={START:1,MOVING:2,STOP:3};CursorUI.Interval=20;CursorUI.GetCursorRect=function(b,c){var d=b?b.pos:{t:0,l:0},a=c.hl_type==HiLightType.NONE?1:c.hl_size;return{t:d.t-a,l:d.l-a,w:2*a,h:2*a}};function CursorUI(c,a,b){CtrlUI.call(this,c,a,b);this.bgId=this.id+"_bg";this.curIdx=0;this.hlSize=c.hl_type==HiLightType.NONE?1:c.hl_size;if(!c.rect){c.rect=CursorUI.GetCursorRect(c.cursors[0],c)}this.curCursor=null;this.nextCursor=null;this.cursorTs=0;this.state=CursorUI.State.START;this.timerAnimate=undefined;this.animatePaused=false;this.element=null;this.prevAnimTime=0;this.clicked=false}$.extend(CursorUI.prototype,CtrlUI.prototype,{constructor:CursorUI,GetHTML:function(){var g=this.ctrl.cursors[this.curIdx],c=g?g.img:null,a=c?("data/res_"+c.id+".png"):UI.BlankImgUrl(),e=CursorUI.GetCursorRect(g,this.ctrl),d="",b;if(this.ctrl.hl_type!=HiLightType.NONE){var f=this.ctrl.hl_color;d="background-color: rgba("+((f>>16)&255)+","+((f>>8)&255)+","+(f&255)+","+((f>>24)&255)/255+");";if(this.ctrl.hl_type==HiLightType.CIRCLE){d+="border-radius: 50%;"}}if(c){b={l:e.w/2-c.hpx,t:e.h/2-c.hpy,w:c.w,h:c.h}}else{b={l:0,t:0,w:0,h:0}}return'<div id="'+this.id+'" class="ctrl" style="overflow:visible;'+CtrlUI.GenCSSRect(e,1)+d+'"><img id="'+this.bgId+'" class="bgimg" src="'+a+'" alt="'+Lang.Cursor+'" style="'+CtrlUI.GenCSSRect(b,1)+'"/></div>'},GetIniProps:function(){return{}},SetText:function(a){window.console&&console.log("Cursor doesn't support SetText")},GetText:function(a){window.console&&console.log("Cursor doesn't support GetText")},GetPosition:function(){if(this.element){return{x:this.element.style.left,y:this.element.style.top}}return{x:0,y:0}},SetPosition:function(a,b){if(!this.element){return}this.element.style.left=a+"px";this.element.style.top=b+"px"},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);this.element=$("#"+this.id)[0]},IsTriggeredByEvent:function(){return false},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Prez.runningStreams&PrezStreams.MAIN){this._StartAnimate()}else{this.animatePaused=true}},_OnHideComplete:function(){this._StopAnimate();CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(d,b,e){var a=this.GetDOM();if(d!=1){if(b!==undefined&&e!==undefined){var c=CursorUI.GetCursorRect(this.curCursor,this.ctrl);a.css({transformOrigin:b/c.w*100+"% "+e/c.h*100+"%",transform:"scale("+d+","+d+")"})}else{a.css({transformOrigin:"50% 50%",transform:"scale("+d+","+d+")"})}}else{a.css({transformOrigin:"",transform:""})}},UpdatePrezStateChanged:function(){if(Prez.runningStreams&PrezStreams.MAIN){if(this.animatePaused){this._StartAnimate();this.animatePaused=false}}else{if(this.timerAnimate!==undefined){this._StopAnimate();
this.animatePaused=true}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},UpdatePlaybackRateChanged:function(){this.Update()},_StartAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate)}if(!this.element){return}var a=this;this.timerAnimate=window.setInterval(function(){a._OnInterval()},CursorUI.Interval);this.prevAnimTime=(new Date).getTime()},_StopAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate);this.timerAnimate=undefined}},Update:function(){if(!this.element){return}this.curIdx=-1;this.curCursor=null;this.nextCursor=null;this.clicked=true;this._StopAnimate();var f,a,g,c=this.slideUI.ts,e,d=this.ctrl.cursors;for(a=0,g=d.length;a<g;++a){f=d[a];e=f.start+f.move+f.stop;if(c<=e||f.start<0){this.cursorTs=c;this.curIdx=a;this.curCursor=f;this.nextCursor=d[a+1];this._UpdateShape(true);if(c<=f.start||f.start<0){this.state=CursorUI.State.START;this._UpdatePos(f.pos)}else{if(c<(f.start+f.move)){this.state=CursorUI.State.MOVING;this._Move()}else{this.state=CursorUI.State.STOP;this._UpdatePos(this.nextCursor.pos)}}break}c-=e}this.showState=CtrlShowState.HIDE;if(this.curCursor){this.Show({value:CtrlShowState.SHOW,ts:0,ctrlTs:0});if(Prez.prjSldBotUI&&!isNaN(this.curCursor.click)){if(this.cursorTs==this.curCursor.click){if(this.curCursor.sound){Prez.prjSldBotUI.PlayClickSound(this.curCursor.sound)}if(this.curCursor.click_eff){var b=this.curCursor.click_eff;Prez.prjSldBotUI.PlayPointerEffect(true,b.type,this.curCursor.pos.l,this.curCursor.pos.t,b.w,b.h,b.color,b.radius,b.fr_dur,b.fr_count)}}else{if(this.cursorTs<this.curCursor.click){this.clicked=false}}}}else{this.Hide(false)}},_UpdateShape:function(b){var d=$("#"+this.bgId)[0],c=d.style,f=this.ctrl.cursors,a=this.curIdx,g;while(a>=0){g=f[a];if(g.img){var e=CursorUI.GetCursorRect(g,this.ctrl);c.left=(e.w/2-g.img.hpx)+"px";c.top=(e.h/2-g.img.hpy)+"px";c.width=g.img.w+"px";c.height=g.img.h+"px";d.src="data/res_"+g.img.id+".png";return}if(!b){return}--a}d.src=UI.BlankImgUrl();c.left="0px";c.top="0px";c.width="0px";c.height="0px"},_UpdatePos:function(a){this.element.style.left=(a.l-this.hlSize)+"px";this.element.style.top=(a.t-this.hlSize)+"px"},Tick:function(){},_OnInterval:function(){if(this.cleaned){return}var e=this.curCursor,b=(new Date).getTime();var a=(b-this.prevAnimTime)*Prez.playbackRate;this.cursorTs+=a;this.prevAnimTime=b;var d=this.cursorTs;while(e){if(!isNaN(e.click)&&!this.clicked&&e.click<=d&&Prez.prjSldBotUI){if(e.sound){Prez.prjSldBotUI.PlayClickSound(e.sound)}if(e.click_eff){var c=e.click_eff;Prez.prjSldBotUI.PlayPointerEffect(true,c.type,e.pos.l,e.pos.t,c.w,c.h,c.color,c.radius,c.fr_dur,c.fr_count)}this.clicked=true}if(d<=e.start||e.start<0){this.state=CursorUI.State.START;if(e.start<0&&(this.clicked||(!e.sound&&!e.click_eff))){this._StopAnimate()}return}if(d<e.start+e.move){this.state=CursorUI.State.MOVING;this._Move();return}d-=(e.start+e.move+e.stop);if(d<0){if(this.state!=CursorUI.State.STOP){this.state=CursorUI.State.STOP;if(this.nextCursor){this._UpdatePos(this.nextCursor.pos)}}return}++this.curIdx;this.curCursor=e=this.nextCursor;this.nextCursor=this.ctrl.cursors[this.curIdx+1];this.cursorTs=d;this.state=CursorUI.State.START;this.clicked=false;if(e){this._UpdateShape(false);this._UpdatePos(e.pos)}}this.Hide(false)},_Move:function(){if(this.nextCursor){var a=$.easing.easeInOutQuad((this.cursorTs-this.curCursor.start)/this.curCursor.move,this.cursorTs-this.curCursor.start,0,1,this.curCursor.move);this.element.style.left=((1-a)*(1-a)*this.curCursor.pos.l+2*a*(1-a)*this.curCursor.cpos.l+a*a*this.nextCursor.pos.l-this.hlSize)+"px";this.element.style.top=((1-a)*(1-a)*this.curCursor.pos.t+2*a*(1-a)*this.curCursor.cpos.t+a*a*this.nextCursor.pos.t-this.hlSize)+"px"}},CleanUp:function(){this._StopAnimate();CtrlUI.prototype.CleanUp.call(this);this.element=null}});ZoomUI.Scale=1;ZoomUI.X=0;ZoomUI.Y=0;ZoomUI.Reset=function(){ZoomUI.Scale=1;ZoomUI.X=0;ZoomUI.Y=0;UI.$Slides.css("transform-origin","");UI.$Slides.css("transform","")};function ZoomUI(b,a){this.slideUI=a;this.stateTs=0;this.timerAnimate=undefined;this.animatePaused=false;this.activeIndexChanged=true;this.prevAnimTime=0;this.zoomAreas=[];var d,c;for(d=0,c=b.length;d<c;++d){if((b[d].showMode&Prez.Session.PMode)==Prez.Session.PMode){this.zoomAreas.push(b[d])}}this.activeIndex=-1;this.zooming=false;this.startTime=0}ZoomUI.prototype={constructor:ZoomUI,Update:function(){var c=this.slideUI.ts,b=this.zoomAreas;var a=b.length-1;while(a>=0&&b[a].startTime>c){--a}this._SetActiveZoom(a,c)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Tick:function(){if(this.zooming){return}var d=this.slideUI.ts,b=this.zoomAreas;var c=b.length,a=this.activeIndex+1;while(a<c&&b[a].startTime<=d){++a}--a;if(a!=this.activeIndex){this._SetActiveZoom(a,d)}},Step:function(){if(this.pausedTime!==undefined){return true}var b=+new Date;if(b>=this.startTime+this.duration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false;return false}else{var c=(b-this.startTime)/this.duration;var e=$.easing.easeInOutQuad(c,c,0,1,1);var a=this.preX+(this.X-this.preX)*e;var f=this.preY+(this.Y-this.preY)*e;var d=this.preS/(1-(1-this.preS/this.S)*e);this._DoZoom(a,f,d)}return true},_DoZoom:function(a,f,b){ZoomUI.Scale=b;ZoomUI.X=a;ZoomUI.Y=f;UI.$Slides.css("transform-origin","0% 0%");UI.$Slides.css("transform","scale("+b+","+b+") translate("+(-a)+"px,"+(-f)+"px)");var c,e;if(Prez.prjSldBotUI){c=Prez.prjSldBotUI.ctrlUIs;for(e in c){var d=c[e];if(d.UpdateZoomAreaEffect){d.UpdateZoomAreaEffect()}}}if(Prez.prjSldTopUI){c=Prez.prjSldTopUI.ctrlUIs;for(e in c){var d=c[e];if(d.UpdateZoomAreaEffect){d.UpdateZoomAreaEffect()}}}c=this.slideUI.ctrlUIs;for(e in c){var d=c[e];if(d.UpdateZoomAreaEffect){d.UpdateZoomAreaEffect()}}},_SetActiveZoom:function(b,a){EffectMan.StopZoom(this);this.activeIndex=b;var d=this.zoomAreas[b-1];if(d){this.preX=d.pos.l;this.preY=d.pos.t;this.preS=d.scale/100}else{this.preX=this.preY=0;this.preS=1}d=this.zoomAreas[b];if(d){this.duration=d.inDuration;this.X=d.pos.l;this.Y=d.pos.t;this.S=d.scale/100;var c=a-d.startTime;if(c>=d.inDuration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false}else{this.startTime=(new Date).getTime()-c;this.zooming=true;if(this.Step()){EffectMan.StartZoom(this)}}}else{this.X=this.Y=0;this.S=1;this._DoZoom(this.X,this.Y,this.S);this.zooming=false}},CleanUp:function(){EffectMan.StopZoom(this);this._DoZoom(0,0,1)}};var ClosedCaptionUI={MARGIN:5,Init:function(){if(this.inited){return}this.id=UI.IDs.ClosedCaption;this.bgId=this.id+"_bg";this.textId=this.id+"_txt";this.$CCaption=$("#"+this.id);this.$CCaption.css("z-index",ZIndexBase.ClosedCaption);this.show=false;if(TemplateParams.IniCCShow){this.Show(true)}else{this.Show(false)}this.$CCaption.empty();this.$CCaption.append('<img id="'+this.bgId+'" class="bgimg" alt="" src="data/'+g_closedCaption.bgimg+'" />');this.caption="";this.rect={t:0,l:0,w:2*this.MARGIN+1,h:2*this.MARGIN+1};this.$CCaption.append(this._GetCaptionNodeHTML());this.$Text=$("#"+this.textId);this.ClearCaption();this.inited=true},IsShown:function(){return this.show},Show:function(a){if(a===undefined){a=true}this.show=a;if(a){this.$CCaption.css("display","block");if(this.inited){var b=this.$Text.height()+2*this.MARGIN;this.rect.t-=b-this.rect.h;this.rect.h=b;this.$CCaption.css({top:this.rect.t+"px",height:this.rect.h+"px"})}}else{this.$CCaption.css("display","none")}if(UI.Toolbar){UI.Toolbar.SetCCaption(a)}},ToggleShow:function(){this.Show(!this.show)},SetCaption:function(a,c){this.rect={t:c.t,l:c.l,w:c.w,h:c.h};this.caption=a;this.$Text.html(a);this.$Text.width(c.w-2*this.MARGIN);var b=this.$Text.height()+2*this.MARGIN;this.rect.t-=b-this.rect.h;this.rect.h=b;this.$CCaption.css({top:this.rect.t+"px",left:this.rect.l+"px",width:this.rect.w+"px",height:this.rect.h+"px",visibility:"visible"})},ClearCaption:function(){this.$CCaption.css("visibility","hidden")
},_GetCaptionNodeHTML:function(){return'<div id="'+this.textId+'" style="position:absolute;top:'+(this.MARGIN)+"px;left:"+(this.MARGIN)+"px;width:"+((this.rect.w-2*this.MARGIN))+"px;"+g_closedCaption.css+'">'+this.caption+"</div>"}};function SlideCCaptionUI(b,a){this.caption=b;this.slideUI=a;this.nodes=b.nodes;this.curNode=null;this.curIdx=-1;this.curNodeShow=false}SlideCCaptionUI.prototype={constructor:SlideCCaptionUI,Update:function(){this.curIdx=-1;this.curNode=null;ClosedCaptionUI.ClearCaption();var c,b,d,a=this.slideUI.ts+Prez.INTERVAL*Prez.playbackRate;for(b=0,d=this.nodes.length;b<d;++b){c=this.nodes[b];if((c.startTime+c.duration>=a)&&c.duration!=0){this.curIdx=b;this.curNode=c;this._ShowCurrentNode(c.startTime<a);return}}},Tick:function(){if(!this.curNode){return}var b=this.curNode,a=this.slideUI.ts+Prez.INTERVAL*Prez.playbackRate;if(this.curNodeShow){if(b.startTime+b.duration<a){do{++this.curIdx;b=this.nodes[this.curIdx]}while(b&&b.duration==0);this.curNode=b;this._ShowCurrentNode(b&&b.startTime<a)}}else{if(this.curNode.startTime<a){this._ShowCurrentNode(true)}}},UpdatePrezStateChanged:function(){},_ShowCurrentNode:function(a){if(a===undefined){a=true}this.curNodeShow=a;if(a&&this.curNode){ClosedCaptionUI.SetCaption(this.curNode.html,this.curNode.rect)}else{ClosedCaptionUI.ClearCaption()}},CleanUp:function(){}};Effect.Type={NONE:0,FADE:1,FLY:2,PEEK:3,WIPE:4,HILIGHT:500,ZOOM:501};Effect.Dir={NONE:0,BOTTOM:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM_LEFT:5,BOTTOM_RIGHT:6,TOP_LEFT:7,TOP_RIGHT:8};function Effect(){}Effect.prototype={constructor:Effect,Start:function(b,d,a){a=a||{};this.elem=b;this.callback=a.callback;this.secondStream=a.secondStream;if(!d){if(a.callback){window.setTimeout(function(){a.callback.call(b)},1)}return false}if(a.exitEffect){this.starts=d.ends;this.ends=d.starts;this.mStarts=d.mEnds;this.mEnds=d.mStarts}else{this.starts=d.starts;this.ends=d.ends;this.mStarts=d.mStarts;this.mEnds=d.mEnds}this.duration=d.duration;var c=a.startTime;if(isNaN(c)||c<0){c=0}this.ts=c;this.prevTime=(new Date).getTime();this.playbackRate=Prez.playbackRate;this.paused=false;return this.Step(false,true,true)},Pause:function(){if(this.paused){return}this.paused=true;var b=(new Date).getTime();var a=(b-this.prevTime)*this.playbackRate;this.ts+=a;this.prevTime=b},Resume:function(){if(!this.paused){return}this.paused=false;this.prevTime=(new Date).getTime()},UpdatePlaybackRateChanged:function(){var b=(new Date).getTime();var a=(b-this.prevTime)*this.playbackRate;this.ts+=a;this.prevTime=b;this.playbackRate=Prez.playbackRate},Step:function(e,h,p){if(this.paused&&!e){return true}if(!this.elem){return false}var m,a,q,d,n,g={};var b=(new Date).getTime();var c=(p?0:b-this.prevTime)*this.playbackRate;this.ts+=c;this.prevTime=b;if(e||this.ts>=this.duration){n=this.ends;if(n){for(a in n){g[a]=n[a]}}if(g.opacity==1){g.opacity=""}if(this.mEnds){if(BrowserInfo.ie){var k=$(this.elem).attr("style");if(k){$(this.elem).attr("style",k.replace(/clip[^;]+;?/gi,""))}$(this.elem).css(g)}else{g.clip="";$(this.elem).css(g)}}else{$(this.elem).css(g)}if(this.callback&&(h||h===undefined)){if(p){var f=this;window.setTimeout(function(){if(f&&f.callback&&f.elem){f.callback.call(f.elem)}},1)}else{this.callback.call(this.elem)}}return false}else{var o=this.ts/this.duration;m=$.easing.easeInOutQuad(o,o,0,1,1);d=this.mStarts;n=this.mEnds;if(d){var l={};for(a in d){q=d[a];l[a]=(q+(n[a]-q)*m)}g.clip="rect("+l.t+"px "+(l.l+l.w)+"px "+(l.t+l.h)+"px "+l.l+"px)"}d=this.starts;n=this.ends;if(d){for(a in d){q=d[a];g[a]=q+(n[a]-q)*m}}$(this.elem).css(g)}return true},CleanUp:function(){this.elem=undefined},_Callback:function(){if(this.callback&&this.elem){this.callback.call(this.elem);this.callback=undefined}}};var EffectMan={INTERVAL:40,effects:[],timerId:undefined,zoomUI:null,StartZoom:function(a){this.zoomUI=a;if(Prez.runningStreams&PrezStreams.MAIN){this._CreateTimer()}else{a.Pause()}},StopZoom:function(a){if(this.zoomUI==a){this.zoomUI=null;if(!this.effects.length){this._DeleteTimer()}}},Start:function(c,e,a){var d=new Effect(),b=true;if(d.Start(c,e,a)){this.effects.push(d);if(d.secondStream){if(Prez.runningStreams&PrezStreams.SECOND){b=false}}else{if(Prez.runningStreams&PrezStreams.MAIN){b=false}}if(b){d.Pause()}else{this._CreateTimer()}}},Stop:function(c,b,e){if(!e){e=false}var d=this.effects;for(var a=d.length-1;a>=0;--a){if(d[a].elem==c){if(b){d[a].Step(true,e)}d[a].CleanUp();d.splice(a,1)}}if(!d.length&&!this.zoomUI){this._DeleteTimer()}},Reset:function(c,b){var a={};if(b.opacity!==undefined&&b.opacity!=1){a.opacity=b.opacity}else{a.opacity=""}if(b.top!==undefined){a.top=b.top}if(b.left!==undefined){a.left=b.left}if(BrowserInfo.ie){var d=$(c).attr("style");if(d){$(c).attr("style",d.replace(/clip[^;]+;?/gi,""))}$(c).css(a)}else{a.clip="";$(c).css(a)}},UpdatePrezStateChanged:function(){this._Step();if(Prez.runningStreams==PrezStreams.NONE){this.Pause(null)}else{if(Prez.runningStreams==PrezStreams.ALL){this.Resume()}else{if(Prez.runningStreams==PrezStreams.SECOND){this.Pause(null,true);this.Resume(null,true)}}}},UpdatePlaybackRateChanged:function(){var b=this.effects;for(var a=0,c=b.length;a<c;++a){b[a].UpdatePlaybackRateChanged()}},Pause:function(c,e){var d=this.effects;var b=0,f=d.length,a=0;if(c){for(b=0;b<f;++b){if(d[b].elem==c){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}}else{if(this.zoomUI){this.zoomUI.Pause();++a}for(b=0;b<f;++b){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}if(this.zoomUI){++f}if(a==f){this._DeleteTimer()}},Resume:function(d,b){var e=this.effects,a=false;var c=0,f=e.length;if(d){for(c=0;c<f;++c){if(e[c].elem==d){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}}else{if(this.zoomUI&&!b){this.zoomUI.Resume();a=true}for(c=0;c<f;++c){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}if(a){this._CreateTimer()}},CleanUp:function(){if(this.zoomUI){this.zoomUI.CleanUp();this.zoomUI=null}var b=this.effects;for(var a=0,c=b.length;a<c;++a){b[a].CleanUp()}b.length=0;this._DeleteTimer()},InitEffect:function(n,h){var d,a,b,k,e=0,c=0;switch(n.type){case Effect.Type.FADE:n.starts={opacity:0};n.ends={opacity:h.opacity!==undefined?h.opacity:1};break;case Effect.Type.FLY:var g;if(h.transform){var m=h.l+h.transform.oX*h.w/100,l=h.t+h.transform.oY*h.h/100,f=[];g={};f.push(RotatePoint(h.l,h.t,h.transform.r,m,l));f.push(RotatePoint(h.l+h.w,h.t,h.transform.r,m,l));f.push(RotatePoint(h.l+h.w,h.t+h.h,h.transform.r,m,l));f.push(RotatePoint(h.l,h.t+h.h,h.transform.r,m,l));f.sort(function(p,o){return p.x-o.x});g.l=f[0].x;g.w=f[3].x-f[0].x;f.sort(function(p,o){return p.y-o.y});g.t=f[0].y;g.h=f[3].y-f[0].y}else{g=h}d=-g.w-g.l;a=-g.h-g.t;b=UI.slideW-g.l;k=UI.slideH-g.t;case Effect.Type.PEEK:case Effect.Type.WIPE:if(n.type!=Effect.Type.FLY){d=-h.w;a=-h.h;b=h.w;k=h.h}switch(n.dir){case Effect.Dir.TOP:c=a;break;case Effect.Dir.BOTTOM:c=k;break;case Effect.Dir.RIGHT:e=b;break;case Effect.Dir.TOP_LEFT:e=d;c=a;break;case Effect.Dir.TOP_RIGHT:e=b;c=a;break;case Effect.Dir.BOTTOM_LEFT:e=d;c=k;break;case Effect.Dir.BOTTOM_RIGHT:e=b;c=k;break;default:e=d;break}if(n.type!=Effect.Type.WIPE){n.starts={left:h.l+e,top:h.t+c};n.ends={left:h.l,top:h.t};if(n.type==Effect.Type.PEEK){n.mStarts={t:h.t-n.starts.top,l:h.l-n.starts.left,w:h.w,h:h.h};n.mEnds={t:h.t-n.ends.top,l:h.l-n.ends.left,w:h.w,h:h.h}}}else{n.mStarts={t:c,l:e,w:h.w,h:h.h};n.mEnds={t:0,l:0,w:h.w,h:h.h}}break}},_Step:function(){if(this.zoomUI&&!this.zoomUI.Step()){this.zoomUI=null}var b=this.effects;for(var a=0;a<b.length;++a){if(!b[a].Step()){b[a].CleanUp();b.splice(a--,1)}}if(!b.length&&!this.zoomUI){this._DeleteTimer()}},_CreateTimer:function(){var a=this;if(!this.timerId){this.timerId=window.setInterval(function(){a._Step()},this.INTERVAL)}},_DeleteTimer:function(){if(this.timerId){window.clearInterval(this.timerId);this.timerId=undefined}}};function InitHandlers(){RemoveHandlers();Key.InitHandlers();Mouse.InitHandlers()}function RemoveHandlers(){Key.RemoveHandlers();Mouse.RemoveHandlers()}var Mouse={CLICK_OUTSIDE:-1,Buttons:{NONE:0,LEFT:1,MIDDLE:2,RIGHT:3,DBLEFT:4,DBRIGHT:5,SCROLLUP:6,SCROLLDOWN:7},DClickDelay:400,clkTimer:undefined,target:null,targetCtrlUI:null,time:undefined,value:undefined,fromTouchEvent:false,_handledTouchEvents:"touchstart pointerdown MSPointerDown",Norm:function(b,a){b.apWhich=b.which;
if(a){switch(b.apWhich){case this.Buttons.LEFT:b.apWhich=this.Buttons.DBLEFT;break}}},InitHandlers:function(){Mouse.fromTouchEvent=(BrowserInfo.iDevice||BrowserInfo.android);$(document).bind(Mouse._handledTouchEvents,function(b){var a=b.originalEvent||b;if(a.pointerType!="mouse"&&a.pointerType!=4){Mouse.fromTouchEvent=true;$(document).unbind(Mouse._handledTouchEvents)}else{Mouse.fromTouchEvent=false}});$(document).bind("mousedown",Mouse.OnMouseDown);$(document).bind("mouseup",Mouse.OnMouseUp);$(document).bind("contextmenu",EvtMan.StopEvent)},RemoveHandlers:function(){this.CleanUp();this.fromTouchEvent=false;$(document).unbind(Mouse._handledTouchEvents);$(document).unbind("mousedown",Mouse.OnMouseDown);$(document).unbind("mouseup",Mouse.OnMouseUp);$(document).unbind("contextmenu",EvtMan.StopEvent)},ClickOnSlide:function(a){var b=a.target.id;return b.substr(0,4)=="sld_"||b.substr(0,5)=="ctrl_"||b.substr(0,6)=="appwmk"||b.substr(0,UI.IDs.ClosedCaption.length)==UI.IDs.ClosedCaption||b=="CenterPauseResume"},OnMouseDown:function(a){a.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(a)}if(!Mouse.ClickOnSlide(a)){return}Mouse.Norm(a,false);$(document).trigger("feedback",[a]);if(Mouse.clkTimer===undefined){Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}else{if(a.target!=Mouse.target){Mouse._Submit();Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}}return EvtMan.StopEvent(a)},OnMouseUp:function(c){c.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){if((Prez.Session.PMode&PlayModes.DEMO)&&Mouse.ClickOnSlide(c)){Prez.TogglePause()}Mouse.CleanUp();return EvtMan.StopEvent(c)}if(!Mouse.target){return EvtMan.StopEvent(c)}if(c.target!=Mouse.target){if(Mouse.clkTimer===undefined){Mouse.target={};Mouse.targetCtrlUI=null;Mouse._Submit()}}else{if(Mouse.clkTimer!==undefined){if(Mouse.targetCtrlUI){Mouse.Norm(c,true);Mouse.value=InputUI.GetEvtValue(c)}Mouse._Submit()}else{Mouse.targetCtrlUI=null;var e=Prez.slideUI.inputUIs,a;var b=e.length;while(b>0){--b;a=e[b].id;if(c.target.id.substr(0,a.length)==a){Mouse.targetCtrlUI=e[b];Mouse.Norm(c,false);Mouse.value=InputUI.GetEvtValue(c);break}}if(Mouse.targetCtrlUI&&Mouse.targetCtrlUI.PlayClickSound){Mouse.targetCtrlUI.PlayClickSound()}var d=c.timeStamp-Mouse.time;if(d>=Mouse.DClickDelay){Mouse._Submit()}else{Mouse.clkTimer=window.setTimeout(function(){Mouse._Submit()},Mouse.DClickDelay-d)}}}return EvtMan.StopEvent(c)},CleanUp:function(){window.clearTimeout(this.clkTimer);this.target=this.targetCtrlUI=null;this.clkTimer=this.time=this.value=undefined},_Submit:function(){if(this.target){if(this.targetCtrlUI){this.targetCtrlUI.Submit(EvtType.CLICK,this.value)}else{var b=Prez.slideUI.inputUIs;for(var a=0,c=b.length;a<c;++a){b[a].Submit(EvtType.CLICK,this.CLICK_OUTSIDE)}}}this.CleanUp()},GetDisplayName:function(e){var d=parseInt(e),b=d>>24,a=d&16777215,c="";if(d==Mouse.CLICK_OUTSIDE){return Lang.ClickOutside}if(b&Key.MOD_CTRL){if(c!=""){c+="_"}c+="Ctrl"}if(b&Key.MOD_ALT){if(c!=""){c+="_"}c+="Alt"}if(b&Key.MOD_SHIFT){if(c!=""){c+="_"}c+="Shift"}var f="";switch(a){case Mouse.Buttons.LEFT:f=Lang.LeftClick;break;case Mouse.Buttons.MIDDLE:f=Lang.MiddleClick;break;case Mouse.Buttons.RIGHT:f=Lang.RightClick;break;case Mouse.Buttons.DBLEFT:f=Lang.LeftDClick;break;case Mouse.CLICK_OUTSIDE:f=Lang.ClickOutside;break;default:f=""+a;break}if(c!=""){f=c+"_"+f}return f}};var KeyNames={"2":"Middle Click","8":"Backspace","9":"Tab","12":"Clear","13":"Enter","19":"Pause/Break","20":"Caps Lock","27":"Esc","32":"Space","33":"Page Up","34":"Page Down","35":"End","36":"Home","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","44":"Print Screen","45":"Insert","46":"Delete","91":"Left Windows","92":"Right Windows","93":"Windows Menu","106":"Numpad *","107":"+","108":"Separator","109":"-","110":"Numpad .","111":"Numpad /","144":"Num Lock","145":"Scroll Lock","59":";","188":",","190":".","191":"/","192":"`","219":"[","220":"\\","221":"]","222":"'"};var Key={MOD_ALT:1,MOD_CTRL:2,MOD_SHIFT:4,SHIFT:16,CTRL:17,ALT:18,F1:112,F12:123,PRTSCR:44,CANCEL:3,PAUSE:19,TAB:9,NUMBER0:48,NUMBER9:57,A:65,Z:90,NUMPAD0:96,NUMPAD9:105,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,UseMozKey:false,ToMozKey:function(a){if(a==this.CANCEL){return this.PAUSE}if(this.UseMozKey){return a}if(!this.IE2MOZ){this.IE2MOZ=[{ie:186,moz:59},{ie:187,moz:61},{ie:189,moz:173}]}for(var b=0,c=this.IE2MOZ.length;b<c;++b){if(this.IE2MOZ[b].ie==a){return this.IE2MOZ[b].moz}}return a},InitHandlers:function(){$(document).bind("keydown",Key.OnKeyDown);$(document).bind("keyup",Key.OnKeyUp);window.onhelp=EvtMan.StopEvent;document.onhelp=EvtMan.StopEvent;if($.browser.mozilla||$.browser.opera){this.UseMozKey=true}},RemoveHandlers:function(){$(document).unbind("keydown",Key.OnKeyDown);$(document).unbind("keyup",Key.OnKeyUp);window.onhelp=null;document.onhelp=null},ShouldHandleKeyUp:function(a){if(a==this.PRTSCR){return true}return false},OnKeyDown:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},OnKeyUp:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(!Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},HandleKey:function(b){if(Options.AllowNavigate){if(b.apWhich==Key.TAB&&UI.MoveFocus(b.shiftKey)){return EvtMan.StopEvent(b)}if(b.apWhich==Key.TAB||b.apWhich==Key.SHIFT||b.shiftKey){return}}if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){if((Prez.Session.PMode&PlayModes.DEMO)&&b.apWhich==Key.SPACE){Prez.TogglePause()}return EvtMan.StopEvent(b)}$(document).trigger("feedback",[b]);var f=InputUI.GetEvtValue(b);var d=false;var a=Prez.slideUI.inputUIs;var c=a.length;if(c==1){if(a[0].ctrl.kind==CtrlKind.TEXTINPUT){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}}if(!d){a[0].Submit(EvtType.KEY_DOWN,f)}}else{if(c>1){var e=0;var l=new Array(c);for(e=0;e<c;++e){l[e]=a[e].GetResponse(EvtType.KEY_DOWN,f)}var k=true;for(e=0;e<c;++e){var g=l[e].jud;if(g==Judge.CORRECT||g==Judge.NEUTRAL){a[e].Submit(EvtType.KEY_DOWN,f,l[e]);k=false;break}if(g==Judge.PARTIAL_CORRECT){k=true}}if(k){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}if(!d){for(e=0;e<c;++e){if(l[e].jud==Judge.WRONG){if(a[e].Submit(EvtType.KEY_DOWN,f,l[e])===false){break}}}}}}}if(!d||(b.apWhich>=Key.F1&&b.apWhich<=Key.F12)){return EvtMan.StopEvent(b)}},GetDisplayName:function(a){var d=parseInt(a),c=d>>24,b=d&16777215,e="";if(c&Key.MOD_CTRL){if(e!=""){e+="_"}e+="Ctrl"}if(c&Key.MOD_ALT){if(e!=""){e+="_"}e+="Alt"}if(c&Key.MOD_SHIFT){if(e!=""){e+="_"}e+="Shift"}var f="";if((Key.NUMBER0<=b&&b<=Key.NUMBER9)||(Key.A<=b&&b<=Key.Z)){f=String.fromCharCode(b)}else{if(Key.NUMPAD0<=b&&b<=Key.NUMPAD9){f="Numpad "+(b-Key.NUMPAD0)}else{if(Key.F1<=b&&b<=Key.F12){f="F"+(b-Key.F1+1)}else{if(b>0){f=KeyNames[b];if(f===undefined){f="Unrecognized"}}}}}if(e!=""){f=e+"_"+f}return f}};var Gesture={Type:{NONE:0,SINGLE_TAP:1,DOUBLE_TAP:2,HOLD:3,SINGLE_TAP_2FINGERS:4,DOUBLE_TAP_2FINGERS:5,SWIPE_UP:6,SWIPE_RIGHT:7,SWIPE_DOWN:8,SWIPE_LEFT:9,ROTATE_LEFT:10,ROTATE_RIGHT:11,PINCH_IN:12,PINCH_OUT:13,FINGERS:14}};DropHelper.PosType={ABSOLUTE:0,ANCHOR:1,TILE:2};DropHelper.PosTileValue={TOPLEFT_RIGHT:0,BOTTOMLEFT_RIGHT:1,BOTTOMLEFT_TOP:2,TOPLEFT_BOTTOM:3,TOPRIGHT_LEFT:4,BOTTOMRIGHT_LEFT:5,BOTTOMRIGHT_TOP:6,TOPRIGHT_BOTTOM:7};DropHelper.PosTileMargin=0;DropHelper.RevertTime=200;DropHelper.DropTime=200;DropHelper.DefaultDropOpt={scale:100,alpha:255,posType:DropHelper.PosType.ANCHOR,posVal:4,maxAccept:-1,replace:false,acceptAny:true};DropHelper.ZoomEffectScale=1.1;DropHelper.DragEffect=function(a,e,d,b){var c={zIndex:e?ZIndexBase.CtrlDragging:""};if(!$.browser.msie||(parseInt($.browser.version)>=9)){c.opacity=e?0.8:""
}a.GetDOM().css(c);if(!a.ctrl.dragOpt){return}switch(a.ctrl.dragOpt.effect){case Effect.Type.HILIGHT:if(e){a.GetDOM().addClass("ap-ctrl-dragging-hilight")}else{a.GetDOM().removeClass("ap-ctrl-dragging-hilight")}break;case Effect.Type.ZOOM:if(e){a.Zoom(DropHelper.ZoomEffectScale,d,b)}else{a.Zoom(1)}break}};DropHelper.DropHoverEffect=function(a,b){if(!a.ctrl.dropOpt){return}switch(a.ctrl.dropOpt.effect){case Effect.Type.HILIGHT:if(b){a.GetDOM().addClass("ap-ctrl-droppable-hover-hilight")}else{a.GetDOM().removeClass("ap-ctrl-droppable-hover-hilight")}break;case Effect.Type.ZOOM:if(b){a.Zoom(DropHelper.ZoomEffectScale)}else{a.Zoom(1)}break}};function DropHelper(a){this.dropUI=a;this.droppedUIs=[];this.droppedZIdx=ZIndexBase.CtrlDroppedBase}DropHelper.prototype={constructor:DropHelper,GetDroppedUIs:function(){return this.droppedUIs},GetDroppedStrIDs:function(){var b=[],a,c;for(a=0,c=this.droppedUIs.length;a<c;++a){b.push(this.droppedUIs[a].ctrl.id+"")}return b},Drop:function(c,a,p){if(p===undefined){p=true}var g=this.dropUI,f=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt,e=f.maxAccept<0||this.droppedUIs.length<f.maxAccept,d=false,o=false;if(c.parentUI!=g.parentUI){e=false}else{if(!e){if(this.droppedUIs.length==f.maxAccept&&f.maxAccept>0){if(f.replace){d=true;e=true}else{o=true}}}if((e||o)&&!f.acceptAny){if(!g.evtMan.HasEvent(EvtType.ACCEPT_SPECIFIC,c.ctrl.id)){e=d=o=false}}}if(!e){if(p){c.GetDOM().animate({top:c.ctrl.rect.t,left:c.ctrl.rect.l},DropHelper.RevertTime,function(){if(g.ctrl.kind==CtrlKind.DROP&&!o){g.Submit(EvtType.REJECT,c)}else{var q=g.evtMan.GetActions(EvtType.REJECT);if(q.length){EvtMan.DoActions(q)}}})}else{c.GetDOM().css({top:c.ctrl.rect.t,left:c.ctrl.rect.l})}if(o){return}else{return false}}if(d){var l=this.droppedUIs[this.droppedUIs.length-1];if(l){this.StartDragOut(l,{revertPos:true,revertTime:(p?DropHelper.RevertTime:0)})}}this.droppedUIs.push(c);c.SetDropCtrlUI(g);var k={w:c.ctrl.rect.w,h:c.ctrl.rect.h},m=c.ctrl.tf,h=g.ctrl.tf,b=1;if(!isNaN(f.scale)&&f.scale!=100){b=f.scale/100;k.w*=b;k.h*=b}switch(f.posType){default:f.posType=DropHelper.DefaultDropOpt.posType;f.posVal=DropHelper.DefaultDropOpt.posVal;case DropHelper.PosType.ANCHOR:this.GetAnchorPos(k,g.ctrl.rect,f.posVal);break;case DropHelper.PosType.TILE:this.GetNextTilePos(k,g.ctrl.rect,f.posVal);break;case DropHelper.PosType.ABSOLUTE:k.t=a.top;k.l=a.left;break}c.GetDOM().css("z-index",this.droppedZIdx++);k=this.DropUIRectToDragUIRect(k,h,m,b,g.ctrl.rect);var n={top:k.t,left:k.l};c.pos={t:k.t,l:k.l};if(f.alpha!=255){n.opacity=f.alpha/255;c.opacity=n.opacity}if(h){n.rlTransform={sr:m?m.r:0,er:h.r,ss:1,es:b}}else{if(m){n.rlTransform={sr:m.r,er:0,ss:1,es:b}}else{n.rlTransform={sr:0,er:0,ss:1,es:b}}}if(n.rlTransform){c.transform={r:n.rlTransform.er,oX:m?m.oX:50,oY:m?m.oY:50}}c.InitEffects(false);if(p){c.GetDOM().animate(n,DropHelper.RevertTime,function(){if(g.ctrl.kind==CtrlKind.DROP){g.Submit(EvtType.ACCEPT,c)}else{var q=g.evtMan.GetActions(EvtType.ACCEPT_SPECIFIC,c.ctrl.id).concat(g.evtMan.GetActions(EvtType.ACCEPT));if(q.length){EvtMan.DoActions(q)}}})}else{c.GetDOM().css(n)}return true},StartDragOut:function(e,d){var h=$.inArray(e,this.droppedUIs);if(h<0){return true}if(!d){d={}}var g=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt,f=1,c=e.ctrl.tf,a=this.dropUI.ctrl.tf,b={};if(!isNaN(g.scale)&&g.scale!=100){f=g.scale/100}delete e.pos;delete e.scale;delete e.opacity;delete e.transform;this.droppedUIs.splice(h,1);e.ClearDropCtrlUI();e.InitEffects(false);if(d.revertPos&&d.revertTime){if(a){b.rlTransform={sr:a.r,er:c?c.r:0,ss:f,es:1}}else{if(c){b.rlTransform={sr:0,er:c.r,ss:f,es:1}}}b.top=e.ctrl.rect.t;b.left=e.ctrl.rect.l;e.GetDOM().animate(b,d.revertTime,function(){var k={zIndex:""};if(g.alpha!=255){k.opacity=""}$(this).css(k)})}else{b.zIndex="";if(g.alpha!=255){b.opacity=""}if(d.revertPos){b.top=e.ctrl.rect.t;b.left=e.ctrl.rect.l}e.GetDOM().css(b);e.Zoom(1)}if(g.posType==DropHelper.PosType.TILE){this.nextTileX=this.tileY=this.tileH=0;for(h=0;h<this.droppedUIs.length;++h){e=this.droppedUIs[h];rcDropped={w:e.ctrl.rect.w,h:e.ctrl.rect.h};if(f!=1){rcDropped.w*=f;rcDropped.h*=f}this.GetNextTilePos(rcDropped,this.dropUI.ctrl.rect,g.posVal);rcDropped=this.DropUIRectToDragUIRect(rcDropped,a,e.ctrl.tf,f,this.dropUI.ctrl.rect);b={top:rcDropped.t,left:rcDropped.l};e.GetDOM().css(b);e.pos={t:rcDropped.t,l:rcDropped.l};e.InitEffects(false)}}return true},DropUIRectToDragUIRect:function(f,g,h,a,b){var e={t:f.t,l:f.l,w:f.w,h:f.h};if(g){var d={x:e.l,y:e.t},c={x:b.l+b.w*g.oX/100,y:b.t+b.h*g.oY/100},k;if(h){k={x:e.l+e.w*h.oX/100,y:e.t+e.h*h.oY/100}}else{k={x:e.l+e.w/2,y:e.t+e.h/2}}d=RotatePoint(d.x,d.y,g.r,c.x,c.y);k=RotatePoint(k.x,k.y,g.r,c.x,c.y);d=RotatePoint(d.x,d.y,-g.r,k.x,k.y);e.l=d.x;e.t=d.y}if(a!=1){k;if(h){k={x:e.l+e.w*h.oX/100,y:e.t+e.h*h.oY/100}}else{k={x:e.l+e.w/2,y:e.t+e.h/2}}e.l=(e.l-k.x)/a+k.x;e.t=(e.t-k.y)/a+k.y;e.w/=a;e.h/=a}return e},ResetAllDropped:function(){while(this.droppedUIs.length){var a=this.droppedUIs[this.droppedUIs.length-1];this.StartDragOut(a,{revertPos:true})}},IsAbsoluteDroppedPos:function(){var a=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt;return a.posType==DropHelper.PosType.ABSOLUTE},GetAnchorPos:function(b,c,a){b.t=c.t+(c.h-b.h)*Math.floor(a/3)/2;b.l=c.l+(c.w-b.w)*(a%3)/2},GetNextTilePos:function(d,k,e){if(!this.nextTileX){this.nextTileX=DropHelper.PosTileMargin}if(!this.tileY){this.tileY=DropHelper.PosTileMargin}if(!this.tileH){this.tileH=0}var n,a,g,c,m,f;switch(e){case DropHelper.PosTileValue.TOPLEFT_RIGHT:case DropHelper.PosTileValue.BOTTOMLEFT_RIGHT:case DropHelper.PosTileValue.TOPRIGHT_LEFT:case DropHelper.PosTileValue.BOTTOMRIGHT_LEFT:default:g=d.w;c=d.h;m=k.w;f=false;break;case DropHelper.PosTileValue.BOTTOMLEFT_TOP:case DropHelper.PosTileValue.TOPLEFT_BOTTOM:case DropHelper.PosTileValue.BOTTOMRIGHT_TOP:case DropHelper.PosTileValue.TOPRIGHT_BOTTOM:g=d.h;c=d.w;m=k.h;f=true;break}if(this.nextTileX+g>m){this.tileY+=this.tileH+DropHelper.PosTileMargin;n=this.tileY;a=DropHelper.PosTileMargin;this.nextTileX=a+g+DropHelper.PosTileMargin;this.tileH=c}else{n=this.tileY;a=this.nextTileX;this.nextTileX+=g+DropHelper.PosTileMargin;if(c>this.tileH){this.tileH=c}}if(f){var b;b=n;n=a;a=b}switch(e){case DropHelper.PosTileValue.TOPLEFT_RIGHT:case DropHelper.PosTileValue.TOPLEFT_BOTTOM:default:d.t=k.t+n;d.l=k.l+a;break;case DropHelper.PosTileValue.BOTTOMLEFT_RIGHT:case DropHelper.PosTileValue.BOTTOMLEFT_TOP:d.t=k.t+k.h-n-d.h;d.l=k.l+a;break;case DropHelper.PosTileValue.TOPRIGHT_LEFT:case DropHelper.PosTileValue.TOPRIGHT_BOTTOM:d.t=k.t+n;d.l=k.l+k.w-a-d.w;break;case DropHelper.PosTileValue.BOTTOMRIGHT_LEFT:case DropHelper.PosTileValue.BOTTOMRIGHT_TOP:d.t=k.t+k.h-n-d.h;d.l=k.l+k.w-a-d.w;break}}};var MediaManager={strAudioExt:"mp3",strVideoExt:"mp4",arrPlayerIDs:[],arrPlayerTypes:[],requireAction:true,canPlayMedia:true,Init:function(){var e={mp3:'audio/mpeg; codecs="mp3"'};var a={mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'};if(Options.use_webm_ogg){e.ogg='audio/ogg; codecs="vorbis"';a.webm='video/webm; codecs="vp8, vorbis"'}var d;var c=document.createElement("audio");if(!c.canPlayType){e={}}else{for(d in e){if(!c.canPlayType(e[d]).replace(/^no$/,"")){delete e[d]}}}var b=document.createElement("video");if(!b.canPlayType){a={}}else{for(d in a){if(!b.canPlayType(a[d]).replace(/^no$/,"")){delete a[d]}}}if((!e.mp3&&!e.ogg)||(!a.webm&&!a.mp4)){this.canPlayMedia=false}else{if(e.mp3){this.strAudioExt="mp3"}else{if(e.ogg){this.strAudioExt="ogg"}}if(a.mp4){this.strVideoExt="mp4"}else{if(a.webm){this.strVideoExt="webm"}}}},CreatePlayer:function(a,b,c){return new MediaPlayerHTML5(a,b,c)},GetPlayerContainerId:function(a,b,c){return"ctrl_"+(c?"audio_":"video_")+b+"_"+a},GetPlayerId:function(a,b){return a+(b?"_audio_player":"_video_player")},CreatePlayerElements:function(b,c,d){var a=this.GetPlayerContainerId(b,c,d);return this.CreatePlayerElements2(a,d)},CreatePlayerElements2:function(a,d){var b="";b+='<div class="ctrl ap-ctrl-media" id="'+a+'" tabindex="-1">';var c=BrowserInfo.ff?"":"";
if(d){b+='<audio class="ap-audio-player" id="'+MediaManager.GetPlayerId(a,true)+'"'+c+' tabindex="-1"></audio>'}else{b+='<img src="'+UI.PlayerImageUrl("blank.gif")+'" class="bgimg" id="'+a+'_vend_frame" role="presentation" width="100%" height="100%" />';b+='<video class="ap-video-player" id="'+MediaManager.GetPlayerId(a,false)+'"'+c+' tabindex="-1"></video>';b+='<img src="'+UI.PlayerImageUrl("blank.gif")+'" class="bgimg" id="'+a+'_vstart_frame" role="presentation" width="100%" height="100%" />'}b+="</div>";this.arrPlayerIDs.push(a);this.arrPlayerTypes.push(d);return b},ClearPlayerIDs:function(){this.arrPlayerIDs=[];this.arrPlayerTypes=[]},InitPlayers:function(h,f){if(!BrowserInfo.android&&!BrowserInfo.iDevice){this.requireAction=false;h.call(f);return}this.players=new Array(this.arrPlayerIDs.length);for(var e=0,d=this.players.length;e<d;++e){this.players[e]=null;var b={context:this,ready:function(){this._OnInitPlayerUpdate(h,f)},end:function(){},statechanged:function(){this._OnInitPlayerUpdate(h,f)}};var a;if(this.arrPlayerTypes[e]){a={mode:"audio",init:true}}else{a={mode:"video",init:true,width:1,height:1,displayheight:1}}this.players[e]=this.CreatePlayer(a,this.arrPlayerIDs[e],b)}var c='<div id="UserActionReceiver" style="position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:100000;"></div>';UI.ViewPort().append(c);UI.ShowBigPlayButton("UserActionReceiver",true);this._UpdateActionReceiverPos();$("#UserActionReceiver").bind("click",function(){g._DispatchUserAction()});var g=this;UI.ViewPort().bind("viewport:layout.update_act_receiver",function(){g._UpdateActionReceiverPos()});this.requireAction=true;this._OnInitPlayerUpdate(h,f)},_UpdateActionReceiverPos:function(){var f=UI.Stage(),d=$("#UserActionReceiver"),b=$("#BigPlayButtonContainer"),c,e,a,g;if(d.length<=0||b.length<=0){return}c=d.offset();e=f.offset();a=(e.left-c.left)+(f.width()-b.width())/2;g=(e.top-c.top)+(f.height()-b.height())/2;b.css({position:"absolute",top:g+"px",left:a+"px",transform:"translate(0px, 0px)"})},_OnInitPlayerUpdate:function(e,c){if(!this.requireAction){return}for(var b=0,a=this.players.length;b<a;++b){if(this.players[b].IsRequireUserAction()==true){return}}$("#BigPlayButtonContainer").unbind("click");UI.ShowBigPlayButton("UserActionReceiver",false);UI.ViewPort().unbind("viewport:layout.update_act_receiver");$("#UserActionReceiver").unbind("click").remove();var d=this;$(this).oneTime(100,function(){for(var h=0,f=d.players.length;h<f;++h){var g=d.players[h];if(g){g.CleanUp()}}d.players=[];d.requireAction=false;if(e){e.call(c)}})},_DispatchUserAction:function(){for(var c=0,a=this.players.length;c<a;++c){var b=this.players[c];if(b.IsRequireUserAction()){b.DispatchUserAction()}}}};var MediaStates={NOT_READY:"NOT READY",CLOSED:"CLOSED",OPENING:"OPENING",PLAYING:"PLAYING",PAUSED:"PAUSED",BUFFERING:"BUFFERING",STOPPED:"STOPPED",ERROR:"ERROR"};var BrowserInfo={Init:function(){this.iDevice=(navigator.userAgent.match(/iPhone|iPad|iPod/i)?true:false);this.iPhone=(navigator.userAgent.match(/iPhone/i)?true:false);this.android=(navigator.userAgent.match(/Android/i)?true:false);this.ie=
/*@cc_on!@*/
false||!!document.documentMode;this.edge=!this.ie&&!!window.StyleMedia;this.ff=typeof InstallTrigger!=="undefined";this.chrome=!!window.chrome&&!!window.chrome.webstore;this.opera=(!!window.opr&&!!opr.addons)||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;this.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;this.stock=(this.android&&!this.chrome&&!this.ff&&!this.opera);this.canPlayMultiSounds=(!this.android&&!this.iDevice);this.fixDelayedPlaying=this.android||this.iDevice;this.mobile=this.iDevice||this.android;$(document.body).append('<audio id="mediaCapChecker"></audio>');var player=$("#mediaCapChecker").get(0);try{player.playbackRate=2;this.canChangePlaybackRate=(player.playbackRate==2)}catch(e){this.canChangePlaybackRate=false}try{player.volume=0.51;this.canChangeVolume=(player.volume==0.51)}catch(e){this.canChangeVolume=false}this.canChangeVolume=!this.mobile;$("#mediaCapChecker").remove()},GetiOSVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var a=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);var b=[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3]||0,10)];Log("iOS "+b[0]+"."+b[1]+"."+b[2]);return b}},GetIEVersion:function(){return parseInt($.browser.version)}};var HTML5MediaOpenManager={players:[],AddToQueue:function(a){Log("@Add Player to Queue: "+a.ctrlId);this.players.push(a);if(this.players.length==1){this._ProcessQueue()}},NotifyComplete:function(b){Log("@NotifyComplete: "+b.ctrlId);var a=this.players.indexOf(b);if(a===undefined||a<0){return}this.players.splice(a,1);this._ProcessQueue()},_ProcessQueue:function(){if(this.players.length>0){var a=this.players[0];Log("@_ProcessQueue: "+a.ctrlId);if(a.playList){a._Load()}else{a._Open()}}},RemoveFromQueue:function(b){var a=this.players.indexOf(b);if(a===undefined||a<0){return}Log("@RemoveFromQueue: "+b.ctrlId);this.players.splice(a,1);if(a==0){Log("Processing task removed");this._ProcessQueue()}}};function MediaPlayerHTML5(d,a,c){this.ctrlId=a;this.playerReady=false;this.error=false;this.player=null;this.handlers=c;this.requireUserAction=((!BrowserInfo.iDevice&&!BrowserInfo.android)?false:(d.init?true:false));this.configs=d;this.curIndex=-1;this.maxRetry=5;this.fixCanPlayThrough=null;this.pseudoPaused=true;if(this.configs.files){this.configs.files=this.configs.files.split(",")}else{this.configs.files=[]}if(this.configs.mode=="audio"){this.playerId=MediaManager.GetPlayerId(a,true)}else{this.playerId=MediaManager.GetPlayerId(a,false)}var b=$("#"+this.playerId);var k="",g,f,h,e;if(d.v_w!==undefined&&d.v_h!==undefined&&d.v_w>0&&d.v_h>0){g=0.01;f=d.v_w/d.v_h-d.width/d.height;if(f>g){scaledH=d.width/(d.v_w/d.v_h);k="scaleY("+d.height/scaledH+")"}else{if(f<-g){scaledW=d.height*(d.v_w/d.v_h);k="scaleX("+d.width/scaledW+")"}}b.attr({width:d.v_w,height:d.v_h});b.css({transform:k,"-ms-transform":k,"-moz-transform":k,"-webkit-transform":k,"-o-transform":k})}else{b.attr({width:"",height:""});b.css({transform:k,"-ms-transform":k,"-moz-transform":k,"-webkit-transform":k,"-o-transform":k})}this.player=b[0];this.playList=!this.configs.file;if(this.configs.init||this.playList){this._Open()}else{HTML5MediaOpenManager.AddToQueue(this)}}MediaPlayerHTML5.prototype={constructor:MediaPlayerHTML5,_Open:function(){var c=this;var a=this.handlers;var d=$("#"+this.playerId);if(this.player){if(this.configs.repeat=="true"){d.attr("loop","true")}if(!this.configs.init&&this.configs.file){this.player.src=this.configs.file;this.player.load()}try{this.player.volume=LimitValue(Prez.GetVolume()/100,0,1);this.player.muted=Prez.IsMuted()}catch(b){Log("MediaPlayer InitVolume Exception |"+this.playerId+"|"+b.toString())}d.bind("error",function(e){Log("MP| "+c.playerId+"| evt:"+e.type);c.error=true;HTML5MediaOpenManager.RemoveFromQueue(c);if(a&&a.context&&a.statechanged){a.statechanged.call(a.context)}}).bind("ended",function(e){Log("MP| "+c.playerId+"| evt:"+e.type);if(a&&a.context&&a.statechanged){a.statechanged.call(a.context)}if(a&&a.context&&a.end){a.end.call(a.context)}if(BrowserInfo.iDevice){try{c.player.currentTime=0}catch(f){Log("MediaPlayer Rewind Exception |"+c.playerId+"|"+f.toString())}}}).bind("loadstart durationchange loadedmetadata loadeddata canplay waiting playing canplaythrough stalled emptied suspend",function(e){Log("MP| "+c.playerId+"| evt:"+e.type);var g=false;if(BrowserInfo.android){if(c.requireUserAction==true){Log("MP| "+c.playerId+"| Remove Require User Action");c.requireUserAction=false}else{if(!c.playerReady){if(e.type=="loadedmetadata"){g=true}}}}else{if(BrowserInfo.iDevice){if(c.requireUserAction==true){Log("MP| "+c.playerId+"| Remove Require User Action");c.requireUserAction=false}else{if(!c.playerReady){if(e.type=="loadedmetadata"){$(c).stopTime("tm_reload");g=true}else{if((e.type=="stalled"||e.type=="suspend")&&c.maxRetry>0){$(c).oneTime(10000,"tm_reload",function(){c.player.load();
c.maxRetry--;Log("MP| "+c.playerId+"| Reload Retry Remain: "+c.maxRetry)})}else{$(c).stopTime("tm_reload")}}}}if(c.fixCanPlayThrough==null&&e.type=="canplaythrough"){try{c.fixCanPlayThrough=(c.player.readyState!=4?true:false);Log("MP| "+c.playerId+"| Fix CanPlayThrough: "+c.fixCanPlayThrough)}catch(f){Log("MP| "+c.playerId+"| Fix CanPlayThrough Exception: "+f.toString())}}}else{c.requireUserAction=false;if(!c.playerReady){if(BrowserInfo.chrome){if(e.type=="loadeddata"){g=true}}else{if(e.type=="loadedmetadata"){g=true}}}}}if(g){if(!c.playerReady){Log("MP| "+c.playerId+"| playerReady");c.playerReady=true;if(BrowserInfo.iDevice){Log("--"+c.player.currentTime);c.Play(false,0);Log("--"+c.player.currentTime)}else{c.Play(false)}if(!c.configs.init){HTML5MediaOpenManager.NotifyComplete(c)}if(a&&a.context&&a.ready){a.ready.call(a.context)}}}if(a&&a.context&&a.statechanged){a.statechanged.call(a.context)}});if(c.configs.mode=="video"){d.bind("timeupdate",function(e){if(a&&a.context&&a.timeupdated){a.timeupdated.call(a.context,c.player.currentTime)}})}}else{Log("MediaPlayer Init Error: "+this.playerId);this.error=true;if(!this.configs.init){HTML5MediaOpenManager.NotifyComplete(this)}}},SetVolume:function(b){if(this.error){return}try{this.player.volume=LimitValue(b/100,0,1);this.player.muted=false}catch(a){Log("MP::SetVolume Exception | "+this.playerId+"|"+a.toString())}},SetPlaybackRate:function(b){if(this.error){return}try{this.player.playbackRate=b}catch(a){Log("MP::SetPlaybackRate Exception | "+this.playerId+"|"+a.toString())}},Play:function(e,d,c){Log("MP::Play | "+this.playerId+"|"+e+"|"+d);if(e&&BrowserInfo.stock&&this.pseudoPaused){this.pseudoPaused=false}if(this.error){return}try{if(!isNaN(d)){var b=this.player.currentTime;if(d<b||d>b+0.5){this.player.currentTime=d}}if(e){this.player.play()}else{this.player.pause()}}catch(a){Log("MP::Play Exception | "+this.playerId+"|"+a.toString())}},LoadItem:function(a){Log("MP::LoadItem | "+this.playerId+"|"+a);if(this.error){return}if(a<0&&a>=this.configs.files.length){return}try{if(this.playerReady){this.player.pause();this.player.currentTime=0}if(this.curIndex!=a){this.playerReady=false;this.error=false;this.curIndex=a;HTML5MediaOpenManager.AddToQueue(this)}}catch(b){Log("MP::LoadItem Exception | "+this.playerId+"|"+b.toString())}},_Load:function(){this.player.src=this.configs.files[this.curIndex];this.player.load()},IsReady:function(){return this.playerReady},GetState:function(){if(this.error){Log("MP::GetState | "+this.playerId+" | ERROR");return MediaStates.ERROR}if(!this.playerReady){Log("MP::GetState | "+this.playerId+" | NOT_READY | paused:"+this.player.paused+"| readyState: "+this.player.readyState);return MediaStates.NOT_READY}if(BrowserInfo.stock&&this.pseudoPaused){Log("MP::GetState | "+this.playerId+" | PAUSED (PSEUDO) | paused:"+this.player.paused+"| readyState: "+this.player.readyState);return MediaStates.PAUSED}if(this.player.ended){Log("MP::GetState | "+this.playerId+" | STOPPED | ended");return MediaStates.STOPPED}var a=this.player.readyState;var b="";switch(a){case 0:b=MediaStates.BUFFERING;break;case 1:b=MediaStates.BUFFERING;break;case 2:b=MediaStates.BUFFERING;break;case 3:if(this.fixCanPlayThrough!=true&&!BrowserInfo.iDevice){b=MediaStates.BUFFERING}break;case 4:break;default:b=MediaStates.NOT_READY;break}if(b!=""){Log("MP::GetState | "+this.playerId+" | "+b+" | paused:"+this.player.paused+"| readyState: "+a);return b}if(this.player.paused){b=MediaStates.PAUSED}else{b=MediaStates.PLAYING}Log("MP::GetState | "+this.playerId+" | "+b+" | paused:"+this.player.paused+"| readyState: "+a);return b},IsRequireUserAction:function(){return this.requireUserAction},DispatchUserAction:function(){if(this.requireUserAction){Log("MP::DispatchUserAction | "+this.playerId);this.player.play()}},GetId:function(){return this.playerId},CleanUp:function(){Log("MP::CleanUp | "+this.playerId);$(this).stopTime("tm_reload");var b=$("#"+this.playerId);b.unbind("error ended loadstart durationchange loadedmetadata loadeddata canplay waiting playing canplaythrough stalled emptied suspend");b.unbind("timeupdate");if(this.player){try{this.player.pause();if(BrowserInfo.iDevice){this.player.currentTime=0;Log("--"+this.player.currentTime)}}catch(a){Log("MP::CleanUp Exception | "+this.playerId+"|"+a.toString())}}this.playerReady=false;HTML5MediaOpenManager.RemoveFromQueue(this)}};function CSSColor(f,e,c,d){if(e===undefined){return f}if(d===undefined||d==255){return"rgb("+Math.round(f)+","+Math.round(e)+","+Math.round(c)+")"}d/=255;return"rgba("+Math.round(f)+","+Math.round(e)+","+Math.round(c)+","+d.toFixed(6)+")"}function AutoShape(g,c){var b="http://www.w3.org/2000/svg";this.shape=c;var d=document.createElementNS(b,"svg"),f=document.createElementNS(b,"g"),e=document.createElementNS(b,"path"),a=d.style;a.width="100%";a.height="100%";a.position="absolute";a.overflow="visible";this.svgPath=f.appendChild(e);this.svgPathGroup=d.appendChild(f);this.svgNode=g.appendChild(d);this.domId=g.getAttribute("id");this.Realize=function(){this.GeneratePath();this.ApplyStyle()};this._GetLineDelta=function(n,l,m){var o,k,h;o=l%3;k=(o==0?2:(o==1?3:5))*m;o=Math.floor(l/3);h=(o==0?2:(o==1?3:5))*m;switch(n){case MarkerType.ARROW:case MarkerType.OPEN:case MarkerType.STEALTH:return l<MarkerSize.ARROW_SIZE_4?k*2.5/4:k*2/4;default:return 0}};this.GeneratePath=function(){var r=this.shape,A=r.l,v=r.t,B=r.w,q=r.h,l=r.nodes,D=r.line,s=r.adjs,u=r.type,C=new SVGPath(),o=AutoShapeType,n,z,p;n=D&&(D.type==LineType.SOLID)&&(D.width%2==1)?0.5:0;if(s){s=s.slice(0);for(p=0;p<s.length;++p){s[p]=s[p]/1000}}if(u>=o.STAR_MIN&&u<=o.STAR_MAX){z=u-o.STAR_MIN;u=o.STAR_MIN}switch(u){case o.RECTANGLE:C.addRect(n,n,B,q,s);break;case o.ROUNDED_RECT:C.addRoundedRect(n,n,B,q,s);break;case o.RECT_CALLOUT:C.addRectangleCallout(n,n,B,q,s);break;case o.ROUNDED_RECT_CALLOUT:C.addRoundedRectangleCallout(n,n,B,q,s);break;case o.RIGHT_ARROW:C.addRightArrow(n,n,B,q,s);break;case o.LEFT_ARROW:C.addLeftArrow(n,n,B,q,s);break;case o.TOP_ARROW:C.addUpArrow(n,n,B,q,s);break;case o.BOTTOM_ARROW:C.addDownArrow(n,n,B,q,s);break;case o.OVAL_CALLOUT:C.addOvalCallout(n,n,B,q,s);break;case o.CROSS:C.addCross(n,n,B,q,s);break;case o.OVAL:C.addOval(n,n,B,q,s);break;case o.DIAMOND:C.addDiamond(n,n,B,q,s);break;case o.CLOUD_CALLOUT:C.addCloudCallout(n,n,B,q,s);break;case o.LINE_CALLOUT_1:break;case o.LEFT_RIGHT_ARROW:C.addLeftRightArrow(n,n,B,q,s);break;case o.UP_DOWN_ARROW:C.addUpDownArrow(n,n,B,q,s);break;case o.RIGHT_ARROW_CALLOUT:C.addRightArrowCallout(n,n,B,q,s);break;case o.DOWN_ARROW_CALLOUT:C.addDownArrowCallout(n,n,B,q,s);break;case o.LEFT_ARROW_CALLOUT:C.addLeftArrowCallout(n,n,B,q,s);break;case o.UP_ARROW_CALLOUT:C.addUpArrowCallout(n,n,B,q,s);break;case o.NOTCHED_RIGHT_ARROW:C.addNotchedRightArrow(n,n,B,q,s);break;case o.CHEVRON:C.addChevron(n,n,B,q,s);break;case o.ISOSCELES_TRIANGLE:C.addIsoscelesTriangle(n,n,B,q,s);break;case o.RIGHT_TRIANGLE:C.addRightTriangle(n,n,B,q,s);break;case o.DATA:C.addData(n,n,B,q,s);break;case o.REGULAR_PENTAGON:C.addRegularPentagon(n,n,B,q,s);break;case o.HEXAGON:C.addHexagon(n,n,B,q,s);break;case o.OCTAGON:C.addOctagon(n,n,B,q,s);break;case o.PLAQUE:C.addPlaque(n,n,B,q,s);break;case o.CAN:break;case o.FOLDER_CORNER:break;case o.HEART:C.addHeart(n,n,B,q,s);break;case o.MOON:C.addMoon(n,n,B,q,s);break;case o.LEFT_BRACKET:break;case o.RIGHT_BRACKET:break;case o.PARALLELOGRAM:break;case o.TRAPEZOID:break;case o.FRAME:break;case o.DOUBLE_BRACKET:break;case o.DOUBLE_BRACE:break;case o.SNIP_CORNER_RECT:break;case o.ROUND_CORNER_RECT:break;case o.LIGHT_BOLT:break;case o.DONUT:break;case o.OFFPAGE_CONNECTOR:C.addOffpageConnector(n,n,B,q,s);break;case o.ACCESS_DATA:break;case o.DISPLAY:C.addDisplay(n,n,B,q,s);break;case o.CARD:C.addCard(n,n,B,q,s);break;case o.PENTAGON:C.addPentagon(n,n,B,q,s);break;case o.STORED_DATA:C.addStoredData(n,n,B,q,s);break;case o.WAVE:C.addWave(n,n,B,q,s);break;case o.PUNCHED_TAPE:break;case o.STAR_MIN:C.addStar(n,n,B,q,s,z);break;case o.LINE:case o.LINE_ARROW:case o.LINE_DOUBLE_ARROW:var m=Math.atan2(l[1].y-l[0].y,l[1].x-l[0].x),k=this._GetLineDelta(D.start_arrow_type,D.start_arrow_size,D.width),t=this._GetLineDelta(D.end_arrow_type,D.end_arrow_size,D.width);
C.moveTo(l[0].x-A+k*Math.cos(m)+n,l[0].y-v+k*Math.sin(m)+n);C.lineTo(l[1].x-A-t*Math.cos(m)+n,l[1].y-v-t*Math.sin(m)+n);break;default:break}this.svgPath.setAttribute("d",C.getPath())};this.ApplyStyle=function(){var w=this.shape.fill,x=this.shape.line,u=this.shape.shadow;if(this.shape.fill){var v=[],l,s,m,k,q,t,h,o,p;switch(w.type){case FillType.SOLID:l=w.argb;this.FillSolid((l>>16)&255,(l>>8)&255,l&255,(l>>24)&255);break;case FillType.GRADIENT:if(w.stops){for(m=0,k=w.stops.length;m<k;++m){l=w.stops[m].argb;q=w.stops[m].pos/1000*100;if(w.style==GradType.RADIAL){q=100-q}h=(l>>16)&255;o=(l>>8)&255;p=l&255;t=(l>>24)&255;h=(l>>16)&255;o=(l>>8)&255;p=l&255;t=(l>>24)&255;if(t<255){aScaled=t/255;h=h*aScaled+255*(1-aScaled);o=o*aScaled+255*(1-aScaled);p=p*aScaled+255*(1-aScaled)}s=[q,h,o,p,t];v.push(s)}v.sort(function(r,n){return r[0]-n[0]})}if(w.style==GradType.RADIAL){this.FillRadialGradient(50,50,v,GradShape.CIRCLE,GradSize.FAR_CORNER)}else{this.FillLinearGradient(w.rot+90,v)}break;case FillType.IMAGE:if(w.img_id){l=w.argb;this.FillImage("data/res_"+w.img_id+".png",w.style,w.hue,w.alpha,(l>>16)&255,(l>>8)&255,l&255,(l>>24)&255,w.img_w,w.img_h)}break;default:this.FillNone();break}}if(x){l=x.argb;this.SetLineStyle(x.type,x.style,x.width,(l>>16)&255,(l>>8)&255,l&255,(l>>24)&255,x.start_arrow_type,x.start_arrow_size,x.end_arrow_type,x.end_arrow_size)}if(u&&u.type==ShadowType.CUSTOM){l=u.argb;this.SetShadow(u.radius,u.angle,u.distance,(l>>16)&255,(l>>8)&255,l&255,(l>>24)&255)}};this.SetLineStyle=function(k,E,s,v,G,K,L,I,l,h,p){var C=this.shape.nodes,q=this.shape.l,o=this.shape.t,F,H,B,u,m;if(C){m=(k==LineType.SOLID)&&(s%2==1)?0.5:0;if(I!=MarkerType.NONE){B=this.svgPathGroup.appendChild(document.createElementNS(b,"path"));F=new SVGPath();F.addMarker(I,l,s);B.setAttribute("d",F.getPath());H=Math.atan2(C[0].y-C[1].y,C[0].x-C[1].x)*180/Math.PI;B.setAttribute("transform","translate("+(C[0].x-q+m)+" "+(C[0].y-o+m)+") rotate("+(180+H)+")")}if(h!=MarkerType.NONE){u=this.svgPathGroup.appendChild(document.createElementNS(b,"path"));F=new SVGPath();F.addMarker(h,p,s);u.setAttribute("d",F.getPath());H=Math.atan2(C[1].y-C[0].y,C[1].x-C[0].x)*180/Math.PI;u.setAttribute("transform","translate("+(C[1].x-q+m)+" "+(C[1].y-o+m)+") rotate("+(180+H)+")")}if(L!==undefined){this.svgPathGroup.style.opacity=L/255;L=undefined}}var J=this.svgPath.style;if(k==LineType.SOLID){J.strokeWidth=s;J.stroke=CSSColor(v,G,K);if(L===undefined){L=255}J.strokeOpacity=L/255;var t="none",n="butt",z="miter";if(E&LineStyle.CAP_SQUARE){n="square"}else{if(E&LineStyle.CAP_ROUND){n="round"}}J.strokeLinecap=n;if(E&LineStyle.JOIN_ROUND){z="round"}else{if(E&LineStyle.JOIN_BEVEL){z="bevel"}}J.strokeLinejoin=z;if(E&LineStyle.STYLE_DOT){t=(0.01)+" "+(2*s)}else{if(E&LineStyle.STYLE_DASH){t=(2*s)+" "+(2*s)}else{if(E&LineStyle.STYLE_DOT_DASH){t=(2*s)+" "+(2*s)+" "+(s*0)+" "+(2*s)}}}J.strokeDasharray=t;J.strokeMiterlimit=10;this._penPadding=s+(z=="miter"?10:0)}else{J.stroke="none"}if(B){var D=B.style;if(I==MarkerType.OPEN){D.stroke=J.stroke;D.strokeWidth=s;D.strokeLinecap="round";D.strokeLinejoin="miter";D.strokeMiterlimit=10;D.fill="none"}else{D.fill=J.stroke;D.stroke="none"}}if(u){var A=u.style;if(h==MarkerType.OPEN){A.stroke=J.stroke;A.strokeWidth=s;A.strokeLinecap="round";A.strokeLinejoin="miter";A.strokeMiterlimit=10;A.fill="none"}else{A.fill=J.stroke;A.stroke="none"}}};this.FillNone=function(){this.svgPath.style.fill="none"};this.FillSolid=function(n,m,h,k){var l=this.svgPath.style;l.fill=CSSColor(n,m,h);if(k===undefined){k=255}l.fillOpacity=k/255};this.FillImage=function(h,n,l,m,s,v,y,z,p,x){this.fillType=FillType.IMAGE;if(!this.svgDefs){this.svgDefs=document.createElementNS(b,"defs");this.svgNode.appendChild(this.svgDefs)}var t=document.createElementNS(b,"pattern"),w=document.createElementNS(b,"image"),q=this.domId+"_img_pattern",o=this.domId+"_hue_effect",A,u,k;if(l!=0){A=document.createElementNS(b,"filter");A.setAttribute("id",o);A.setAttribute("filterUnits","userSpaceOnUse");A.setAttribute("primitiveUnits","userSpaceOnUse");u=document.createElementNS(b,"feColorMatrix");u.setAttribute("in","SourceGraphic");u.setAttribute("type","hueRotate");u.setAttribute("values",l);A.appendChild(u);this.svgDefs.appendChild(A);w.setAttribute("filter","url(#"+o+")")}if(m&&m!=255){w.setAttribute("opacity",m/255)}if(z&&z>0){k=document.createElementNS(b,"rect");k.setAttribute("x","0%");k.setAttribute("y","0%");k.setAttribute("width","100%");k.setAttribute("height","100%");k.style.fillOpacity=z/255;k.style.fill=CSSColor(s,v,y);t.appendChild(k)}t.setAttribute("id",q);t.setAttribute("patternUnits","userSpaceOnUse");t.appendChild(w);this.svgDefs.appendChild(t);w.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);if(n===ImageFillType.STRETCH){t.setAttribute("width","100%");t.setAttribute("height","100%");w.setAttribute("width","100%");w.setAttribute("height","100%");w.setAttribute("preserveAspectRatio","none")}else{if(n===ImageFillType.TILE){t.setAttribute("width",p+"px");t.setAttribute("height",x+"px");w.setAttribute("width",p+"px");w.setAttribute("height",x+"px");w.setAttribute("preserveAspectRatio","none")}else{if(n===ImageFillType.FIT){t.setAttribute("width","100%");t.setAttribute("height","100%");w.setAttribute("width","100%");w.setAttribute("height","100%");w.setAttribute("preserveAspectRatio","xMidYMid meet")}else{if(n===ImageFillType.FILL){t.setAttribute("width","100%");t.setAttribute("height","100%");w.setAttribute("width","100%");w.setAttribute("height","100%");w.setAttribute("preserveAspectRatio","xMidYMid slice")}else{if(n===ImageFillType.CENTER){t.setAttribute("width","100%");t.setAttribute("height","100%");w.setAttribute("x","50%");w.setAttribute("y","50%");w.setAttribute("width",p+"px");w.setAttribute("height",x+"px");w.setAttribute("preserveAspectRatio","none");var r="translate(-"+(p/2)+",-"+(x/2)+")";w.setAttribute("transform",r)}}}}}this.svgPath.style.fill="url(#"+q+")";this.svgPath.style.fillOpacity=1};this.FillLinearGradient=function(r,l){var k=this.svgPath.style,o,m,h,s,p=toSvgLinearGrad(r,svgBBox(this.svgPath)),q=document.createElementNS(b,"linearGradient");if(!q){return}q.setAttribute("x1",p.x1);q.setAttribute("y1",p.y1);q.setAttribute("x2",p.x2);q.setAttribute("y2",p.y2);q.id=this.domId+"-lgrad";q.setAttribute("gradientUnits","userSpaceOnUse");for(o=0,m=l.length;o<m;++o){h=l[o];s=document.createElementNS(b,"stop");s.setAttribute("offset",h[0]+"%");s.setAttribute("stop-color",CSSColor(h[1],h[2],h[3]));s.setAttribute("stop-opacity",h[4]===undefined?1:h[4]/255);q.appendChild(s)}if(!this.svgDefs){this.svgDefs=document.createElementNS(b,"defs");this.svgNode.appendChild(this.svgDefs)}this.svgDefs.appendChild(q);this.svgLGrad=q;k.fill="url(#"+q.id+")";k.fillOpacity=1};this.FillRadialGradient=function(u,t,l,q,v){var k=this.svgPath.style,p,o,h,s,r,m=document.createElementNS(b,"radialGradient");if(!m){return}r=toSvgRadialGrad(u,t,q,v,svgBBox(this.svgPath));m.setAttribute("cx",r.x);m.setAttribute("cy",r.y);m.setAttribute("r",r.r);if(r.t===""){m.removeAttribute("gradientTransform")}else{m.setAttribute("gradientTransform",r.t)}m.id=this.domId+"-rgrad";m.setAttribute("gradientUnits","userSpaceOnUse");for(p=0,o=l.length;p<o;++p){h=l[p];s=document.createElementNS(b,"stop");s.setAttribute("offset",h[0]+"%");s.setAttribute("stop-color",CSSColor(h[1],h[2],h[3]));s.setAttribute("stop-opacity",h[4]===undefined?1:h[4]/255);m.appendChild(s)}if(!this.svgDefs){this.svgDefs=document.createElementNS(b,"defs");this.svgNode.appendChild(this.svgDefs)}this.svgDefs.appendChild(m);this.svgRGrad=m;k.fill="url(#"+m.id+")";k.fillOpacity=1};this.SetShadow=function(B,E,m,q,u,h,o){if(!this.svgDefs){this.svgDefs=document.createElementNS(b,"defs");this.svgNode.appendChild(this.svgDefs)}var C=document.createElementNS(b,"filter"),z=document.createElementNS(b,"feFlood"),H=document.createElementNS(b,"feComposite"),n=document.createElementNS(b,"feOffset"),p=(B>0?document.createElementNS(b,"feGaussianBlur"):null),F=document.createElementNS(b,"feComposite"),D=this.domId+"_dropshadow",s=svgBBox(this.svgPathGroup),w=m*Math.cos(E/180*Math.PI),v=m*Math.sin(E/180*Math.PI),k,A,x,y,I,G;
G=this._penPadding;if(G===undefined){G=0}s.x-=G;s.y-=G;s.width+=2*G;s.height+=2*G;k={x:s.x-B+w,y:s.y-B+v,width:s.width+2*B,height:s.height+2*B};A=Math.min(s.x,k.x);x=Math.min(s.y,k.y);y=Math.max(s.x+s.width,k.x+k.width);I=Math.max(s.y+s.height,k.y+k.height);C.appendChild(z);C.appendChild(H);C.appendChild(n);if(B>0){C.appendChild(p)}C.appendChild(F);C.setAttribute("id",D);C.setAttribute("filterUnits","userSpaceOnUse");C.setAttribute("primitiveUnits","userSpaceOnUse");C.setAttribute("x",A);C.setAttribute("y",x);C.setAttribute("width",y-A);C.setAttribute("height",I-x);C.setAttribute("style","color-interpolation-filters:sRGB");z.setAttribute("result","flood");z.setAttribute("flood-color","rgb("+q+","+u+","+h+")");z.setAttribute("flood-opacity",o===undefined?1:o/255);H.setAttribute("result","composite1");H.setAttribute("operator","in");H.setAttribute("in2","SourceGraphic");H.setAttribute("in","flood");n.setAttribute("result","offset");n.setAttribute("in","composite1");n.setAttribute("dx",w);n.setAttribute("dy",v);if(B>0){p.setAttribute("result","blur");p.setAttribute("in","offset");p.setAttribute("stdDeviation",B/3)}F.setAttribute("result","composite2");F.setAttribute("operator","over");F.setAttribute("in2",B>0?"blur":"offset");F.setAttribute("in","SourceGraphic");this.svgDefs.appendChild(C);this.svgPathGroup.setAttribute("filter","url(#"+D+")")}}var ShapeStarCache={};function SVGPath(){this.path="";this.getPath=function(){return this.path};this.moveTo=function(a,b){this.path+=" M"+a+","+b};this.lineTo=function(a,b){this.path+=" L"+a+","+b};this.arcTo=function(e,d,a,f,b,c){this.path+=" A"+e+","+d+" 0 "+(b?1:0)+","+(c?1:0)+" "+a+","+f};this.cubicTo=function(f,d,c,b,a,e){this.path+=" C"+f+","+d+" "+c+","+b+" "+a+","+e};this.quadraticTo=function(b,d,a,c){this.path+=" Q"+b+","+d+" "+a+","+c};this.addEllipse=function(a,d,c,b){this.moveTo(a-c,d);this.arcTo(c,b,a+c,d,true,true);this.arcTo(c,b,a-c,d,true,true);this.closeSubpath()};this.closeSubpath=function(){this.path+=" Z"};this.addMarker=function(f,h,c){var e,a,k,g=this;e=h%3,a=(e==0?2:(e==1?3:5))*c,e=Math.floor(h/3);k=(e==0?2:(e==1?3:5))*c;switch(f){case MarkerType.ARROW:g.moveTo(0,0);g.lineTo(a,-k/2);g.lineTo(a,k/2);g.closeSubpath();break;case MarkerType.OPEN:var b=Math.atan2(k/2,a),d=Math.floor(c/Math.sin(b)/2);g.moveTo(a+d,-k/2);g.lineTo(d,0);g.lineTo(a+d,k/2);break;case MarkerType.STEALTH:g.moveTo(0,0);g.lineTo(a,-k/2);g.lineTo(a/2,0);g.lineTo(a,k/2);g.closeSubpath();break;case MarkerType.DIAMOND:g.moveTo(-a/2,0);g.lineTo(0,-k/2);g.lineTo(a/2,0);g.lineTo(0,k/2);g.closeSubpath();break;case MarkerType.OVAL:g.addEllipse(0,0,a/2,k/2);break}};this.addRect=function(b,g,d,e,c){var f=this;f.moveTo(b,g);f.lineTo(b+d,g);f.lineTo(b+d,g+e);f.lineTo(b,g+e);f.closeSubpath()};this.addRoundedRect=function(b,k,d,e,c){var f=c[0]*Math.min(d/2,e/2),g=this;g.moveTo(b,k+f);g.arcTo(f,f,b+f,k,false,true);g.lineTo(b+d-f,k);g.arcTo(f,f,b+d,k+f,false,true);g.lineTo(b+d,k+e-f);g.arcTo(f,f,b+d-f,k+e,false,true);g.lineTo(b+f,k+e);g.arcTo(f,f,b,k+e-f,false,true);g.closeSubpath()};this.addCross=function(b,k,d,e,c){var f=c[0]*Math.min(d/2,e/2),g=this;g.moveTo(b+f,k);g.lineTo(b+d-f,k);g.lineTo(b+d-f,k+f);g.lineTo(b+d,k+f);g.lineTo(b+d,k+e-f);g.lineTo(b+d-f,k+e-f);g.lineTo(b+d-f,k+e);g.lineTo(b+f,k+e);g.lineTo(b+f,k+e-f);g.lineTo(b,k+e-f);g.lineTo(b,k+f);g.lineTo(b+f,k+f);g.closeSubpath()};this.addOval=function(b,f,d,e,c){this.addEllipse(b+d/2,f+e/2,d/2,e/2)};this.addDiamond=function(b,g,d,e,c){var f=this;f.moveTo(b+d/2,g);f.lineTo(b+d,g+e/2);f.lineTo(b+d/2,g+e);f.lineTo(b,g+e/2);f.closeSubpath()};this.addIsoscelesTriangle=function(b,g,d,e,c){var f=this;f.moveTo(b+c[0]*d,g);f.lineTo(b+d,g+e);f.lineTo(b,g+e);f.closeSubpath()};this.addRightTriangle=function(b,g,d,e,c){var f=this;f.moveTo(b,g);f.lineTo(b+d,g+e);f.lineTo(b,g+e);f.closeSubpath()};this.addData=function(b,g,d,e,c){var f=this;f.moveTo(b+2/10*d,g);f.lineTo(b+d,g);f.lineTo(b+8/10*d,g+e);f.lineTo(b,g+e);f.closeSubpath()};this.addRegularPentagon=function(b,g,d,e,c){var f=this;f.moveTo(b+d/2,g);f.lineTo(b+d,g+(e/2)*(1-Math.cos(2*Math.PI/4.7)));f.lineTo(b+d/2+d/2/Math.cos(2*Math.PI/20)*Math.sin(2*Math.PI/10),g+e);f.lineTo(b+d/2-d/2/Math.cos(2*Math.PI/20)*Math.sin(2*Math.PI/10),g+e);f.lineTo(b,g+(e/2)*(1-Math.cos(2*Math.PI/4.7)));f.closeSubpath()};this.addHexagon=function(b,k,e,f,d){var g=this,c=d[0]*Math.min(e/2,f/2);g.moveTo(b,k+f/2);g.lineTo(b+c,k+f);g.lineTo(b+e-c,k+f);g.lineTo(b+e,k+f/2);g.lineTo(b+e-c,k);g.lineTo(b+c,k);g.closeSubpath()};this.addOctagon=function(b,k,d,e,c){var g=this,f=c[0]*Math.min(d/2,e/2);g.moveTo(b+f,k);g.lineTo(b+d-f,k);g.lineTo(b+d,k+f);g.lineTo(b+d,k+e-f);g.lineTo(b+d-f,k+e);g.lineTo(b+f,k+e);g.lineTo(b,k+e-f);g.lineTo(b,k+f);g.closeSubpath()};this.addPlaque=function(b,k,d,e,c){var f=c[0]*Math.min(d/2,e/2),g=this;g.moveTo(b,k+f);g.cubicTo(b,k+f,b+f,k+f,b+f,k);g.lineTo(b+d-f,k);g.cubicTo(b+d-f,k,b+d-f,k+f,b+d,k+f);g.lineTo(b+d,k+e-f);g.cubicTo(b+d,k+e-f,b+d-f,k+e-f,b+d-f,k+e);g.lineTo(b+f,k+e);g.cubicTo(b+f,k+e,b+f,k+e-f,b,k+e-f);g.closeSubpath()};this.addHeart=function(b,g,d,e,c){var f=this;f.moveTo(b+d/2,g+e);f.cubicTo(b-d/2,g+e/4,b+d/4,g-e/3,b+d/2,g+e/4);f.cubicTo(b+3/4*d,g-e/3,b+3/2*d,g+e/4,b+d/2,g+e);f.closeSubpath()};this.addMoon=function(b,k,d,e,c){var g=this,f=c[0]*d;g.moveTo(b+d,k+e);g.cubicTo(b,k+e,b,k+e/2,b,k+e/2);g.cubicTo(b,k+e/2,b,k,b+d,k);g.cubicTo(b+f,k,b+f,k+e/2,b+f,k+e/2);g.cubicTo(b+f,k+e/2,b+f,k+e,b+d,k+e);g.closeSubpath()};this.addOffpageConnector=function(b,g,d,e,c){var f=this;f.moveTo(b,g);f.lineTo(b+d,g);f.lineTo(b+d,g+4/5*e);f.lineTo(b+d/2,g+e);f.lineTo(b,g+4/5*e);f.closeSubpath()};this.addDisplay=function(b,g,d,e,c){var f=this;f.moveTo(b+d/6,g);f.lineTo(b,g+e/2);f.lineTo(b+d/6,g+e);f.lineTo(b+d-d/6,g+e);f.cubicTo(b+5/6*d,g+e,b+d,g+e,b+d,g+e/2);f.cubicTo(b+d,g,b+5/6*d,g,b+5/6*d,g);f.closeSubpath()};this.addCard=function(b,g,d,e,c){var f=this;f.moveTo(b+2/10*d,g);f.lineTo(b+d,g);f.lineTo(b+d,g+e);f.lineTo(b,g+e);f.lineTo(b,g+2/10*e);f.closeSubpath()};this.addStoredData=function(b,g,d,e,c){var f=this;f.moveTo(b+d/6,g);f.cubicTo(b-d/18,g-e/35,b-d/18,g+36*e/35,b+d/6,g+e);f.lineTo(b+d,g+e);f.cubicTo(b+7*d/9,g+36*e/35,b+7*d/9,g-e/35,b+d,g);f.lineTo(b+d/6,g);f.closeSubpath()};this.addWave=function(c,l,f,g,e){var k=this,d=e[1]*f/2,b=e[0]*g/2;if(d<=0){k.moveTo(c-2*d,l+b);k.cubicTo(c+f/4-2*d,l-2.5*b,c+3*f/4,l+5*b,c+f,l+b);k.lineTo(c+f+2*d,l+g-b);k.cubicTo(c+3*f/4+2.2*d,l+g+2.5*b,c+f/4,l+g-5*b,c,l+g-b);k.lineTo(c-2*d,l+b)}else{k.moveTo(c,l+b);k.cubicTo(c+f/4,l-2.5*b,c+3*f/4-2*d,l+5*b,c+f-2*d,l+b);k.lineTo(c+f,l+g-b);k.cubicTo(c+3*f/4,l+g+2.5*b,c+f/4+2*d,l+g-5*b,c+2*d,l+g-b);k.lineTo(c,l+b)}k.closeSubpath()};this.addRectangleCallout=function(m,k,n,e,l,d){var c=l[0],b=l[1],g=m+n/2*(1+c),f=k+e/2*(1+b),p=d?2/10*Math.min(n,e):0,o=this;o.moveTo(m+p,k);if(c<=0&&b<=0&&Math.abs(c)<=Math.abs(b)){o.lineTo(m+2/10*n,k);o.lineTo(g,f);o.lineTo(m+4/10*n,k);o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c<=0&&b<=0&&Math.abs(c)>Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+4*e/10);o.lineTo(g,f);o.lineTo(m,k+2*e/10);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c>0&&b<=0&&Math.abs(c)<=Math.abs(b)){o.lineTo(m+6*n/10,k);o.lineTo(g,f);o.lineTo(m+8*n/10,k);o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c>0&&b<=0&&Math.abs(c)>Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+2*e/10);o.lineTo(g,f);o.lineTo(m+n,k+4*e/10);o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)
}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c<=0&&b>0&&Math.abs(c)>Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+8/10*e);o.lineTo(g,f);o.lineTo(m,k+6*e/10);o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c<=0&&b>0&&Math.abs(c)<=Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+4*n/10,k+e);o.lineTo(g,f);o.lineTo(m+2*n/10,k+e);o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c>0&&b>0&&Math.abs(c)>Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+6*e/10);o.lineTo(g,f);o.lineTo(m+n,k+8/10*e);o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}else{if(c>0&&b>0&&Math.abs(c)<=Math.abs(b)){o.lineTo(m+n-p,k);if(d){o.arcTo(p,p,m+n,k+p,false,true)}o.lineTo(m+n,k+e-p);if(d){o.arcTo(p,p,m+n-p,k+e,false,true)}o.lineTo(m+8/10*n,k+e);o.lineTo(g,f);o.lineTo(m+n*6/10,k+e);o.lineTo(m+p,k+e);if(d){o.arcTo(p,p,m,k+e-p,false,true)}o.lineTo(m,k+p);if(d){o.arcTo(p,p,m+p,k,false,true)}}}}}}}}}o.closeSubpath()};this.addRoundedRectangleCallout=function(b,f,d,e,c){this.addRectangleCallout(b,f,d,e,c,true)};this.addOvalCallout=function(m,g,n,b,l){var f=m+n/2*(1+l[0]),d=g+b/2*(1+l[1]),k=Math.atan2(l[1],l[0]),e=k-13*Math.PI/180,c=k+14*Math.PI/180,o=this;o.moveTo(f,d);o.lineTo(m+n/2+n/2*Math.cos(e),g+b/2+b/2*Math.sin(e));o.arcTo(n/2,b/2,m+n/2+n/2*Math.cos(c),g+b/2+b/2*Math.sin(c),true,false);o.closeSubpath()};this.addCloudCallout=function(b,l,d,e,c){var k=b+d/2+c[0]*d/2,g=l+e/2+c[1]*e/2,f=this;f.moveTo(b+d/11,l+3/7*e);f.quadraticTo(b+1.3/11*d,l+1.1/7*e,b+3.8/11*d,l+1.9/7*e);f.quadraticTo(b+4.6/11*d,l+1/7*e,b+6/11*d,l+1.5/7*e);f.quadraticTo(b+6.8/11*d,l+0.8/7*e,b+7.8/11*d,l+1.3/7*e);f.quadraticTo(b+9.5/11*d,l+0.5/7*e,b+10/11*d,l+2/7*e);f.quadraticTo(b+11/11*d,l+2.4/7*e,b+10.5/11*d,l+3.2/7*e);f.quadraticTo(b+12/11*d,l+4.6/7*e,b+9.8/11*d,l+5.1/7*e);f.quadraticTo(b+9.5/11*d,l+6.8/7*e,b+7.5/11*d,l+6.2/7*e);f.quadraticTo(b+6/11*d,l+8/7*e,b+4.3/11*d,l+6.5/7*e);f.quadraticTo(b+2.6/11*d,l+e,b+1.5/11*d,l+6/7*e);f.quadraticTo(b+(-0.2/11*d),l+6/7*e,b+0.5/11*d,l+4.5/7*e);f.quadraticTo(b-0.5/11*d,l+3.7/7*e,b+1/11*d,l+3/7*e);f.closeSubpath();f.addEllipse(k,g,0.2/11*d,0.2/11*d);f.addEllipse(k+(b+d/2-k)/6,g+(l+e/2-g)/6,0.5/11*d,0.5/11*d);f.addEllipse(k+(b+d/2-k)/2.5,g+(l+e/2-g)/2.5,0.8/11*d,0.8/11*d)};this.addRightArrow=function(b,l,d,g,c){var e=b+d-Math.min(d,g)*c[0],f=l+g/2*c[1],k=this;k.moveTo(b,f);k.lineTo(e,f);k.lineTo(e,l);k.lineTo(b+d,l+g/2);k.lineTo(e,l+g);k.lineTo(e,l+g-c[1]*g/2);k.lineTo(b,l+g-c[1]*g/2);k.closeSubpath()};this.addLeftArrow=function(b,l,d,g,c){var e=b+Math.min(d,g)*c[0],f=l+g/2*c[1],k=this;k.moveTo(e,l);k.lineTo(e,f);k.lineTo(b+d,f);k.lineTo(b+d,l+g-c[1]*g/2);k.lineTo(e,l+g-c[1]*g/2);k.lineTo(e,l+g);k.lineTo(b,l+g/2);k.closeSubpath()};this.addUpArrow=function(b,l,d,f,c){var e=l+Math.min(d,f)*c[0],g=b+d/2*c[1],k=this;k.moveTo(b,e);k.lineTo(b+d/2,l);k.lineTo(b+d,e);k.lineTo(b+d-c[1]*d/2,e);k.lineTo(b+d-c[1]*d/2,l+f);k.lineTo(g,l+f);k.lineTo(g,e);k.lineTo(b,e);k.closeSubpath()};this.addDownArrow=function(b,l,d,f,c){var e=l+f-c[0]*Math.min(d,f),g=b+d/2*c[1],k=this;k.moveTo(b,e);k.lineTo(g,e);k.lineTo(g,l);k.lineTo(b+d-d/2*c[1],l);k.lineTo(b+d-d/2*c[1],e);k.lineTo(b+d,e);k.lineTo(b+d/2,l+f);k.closeSubpath()};this.addLeftRightArrow=function(b,g,d,e,c){var f=this;dX=c[0]*d/2,dY=c[1]*e/2;f.moveTo(b,g+e/2);f.lineTo(b+dX,g);f.lineTo(b+dX,g+dY);f.lineTo(b+d-dX,g+dY);f.lineTo(b+d-dX,g);f.lineTo(b+d,g+e/2);f.lineTo(b+d-dX,g+e);f.lineTo(b+d-dX,g+e-dY);f.lineTo(b+dX,g+e-dY);f.lineTo(b+dX,g+e);f.closeSubpath()};this.addUpDownArrow=function(b,g,d,e,c){var f=this;dX=c[0]*d/2,dY=c[1]*e/2;f.moveTo(b,g+dY);f.lineTo(b+d/2,g);f.lineTo(b+d,g+dY);f.lineTo(b+d-dX,g+dY);f.lineTo(b+d-dX,g+e-dY);f.lineTo(b+d,g+e-dY);f.lineTo(b+d/2,g+e);f.lineTo(b,g+e-dY);f.lineTo(b+dX,g+e-dY);f.lineTo(b+dX,g+dY);f.closeSubpath()};this.addUpArrowCallout=function(k,f,l,e,g){var c=g[1]*l,b=g[2]*e,d=Math.max(g[0],g[1])*l,n=Math.max(g[2],g[3])*e,m=this;m.moveTo(k+l/2,f);m.lineTo(k+c,f+b);m.lineTo(k+d,f+b);m.lineTo(k+d,f+n);m.lineTo(k,f+n);m.lineTo(k,f+e);m.lineTo(k+l,f+e);m.lineTo(k+l,f+n);m.lineTo(k+l-d,f+n);m.lineTo(k+l-d,f+b);m.lineTo(k+l-c,f+b);m.closeSubpath()};this.addDownArrowCallout=function(k,f,l,e,g){var c=g[1]*l,b=g[2]*e,d=Math.max(g[0],g[1])*l,n=Math.min(g[2],g[3])*e,m=this;m.moveTo(k,f);m.lineTo(k+l,f);m.lineTo(k+l,f+n);m.lineTo(k+l-d,f+n);m.lineTo(k+l-d,f+b);m.lineTo(k+l-c,f+b);m.lineTo(k+l/2,f+e);m.lineTo(k+c,f+b);m.lineTo(k+d,f+b);m.lineTo(k+d,f+n);m.lineTo(k,f+n);m.closeSubpath()};this.addLeftArrowCallout=function(k,f,l,e,g){var d=g[0]*l,c=g[1]*e,b=Math.max(g[2],g[0])*l,n=Math.max(g[3],g[1])*e,m=this;m.moveTo(k+b,f);m.lineTo(k+l,f);m.lineTo(k+l,f+e);m.lineTo(k+b,f+e);m.lineTo(k+b,f+e-n);m.lineTo(k+d,f+e-n);m.lineTo(k+d,f+e-c);m.lineTo(k,f+e/2);m.lineTo(k+d,f+c);m.lineTo(k+d,f+n);m.lineTo(k+b,f+n);m.closeSubpath()};this.addRightArrowCallout=function(k,f,l,e,g){var d=g[0]*l,c=g[1]*e,b=Math.min(g[2],g[0])*l,n=Math.max(g[3],g[1])*e,m=this;m.moveTo(k,f);m.lineTo(k+b,f);m.lineTo(k+b,f+n);m.lineTo(k+d,f+n);m.lineTo(k+d,f+c);m.lineTo(k+l,f+e/2);m.lineTo(k+d,f+e-c);m.lineTo(k+d,f+e-n);m.lineTo(k+b,f+e-n);m.lineTo(k+b,f+e);m.lineTo(k,f+e);m.closeSubpath()};this.addNotchedRightArrow=function(c,l,f,g,e){var d=e[0],b=e[1],k=this;k.moveTo(c+f*d,l);k.lineTo(c+f,l+g/2);k.lineTo(c+f*d,l+g);k.lineTo(c+f*d,l+g*(1-b/2));k.lineTo(c,l+g*(1-b/2));k.lineTo(c+(f-f*d)/2,l+g/2);k.lineTo(c,l+g*b/2);k.lineTo(c+f*d,l+g*b/2);k.closeSubpath()};this.addChevron=function(b,l,e,f,c){var k=e*c[0],g=this;g.moveTo(b,l);g.lineTo(b+k,l);g.lineTo(b+e,l+f/2);g.lineTo(b+k,l+f);g.lineTo(b,l+f);g.lineTo(b+e-k,l+f/2);g.closeSubpath()};this.addPentagon=function(b,k,d,e,c){var f=Math.min(Math.max(c[0]*Math.min(d,e),0),d),g=this;g.moveTo(b,k);g.lineTo(b+d-f,k);g.lineTo(b+d,k+e/2);g.lineTo(b+d-f,k+e);g.lineTo(b,k+e);g.closeSubpath()};this.addStar=function(q,n,s,f,p,o){var g=ShapeStarCache[o],b=p[0],e,d,c;if(!g){var u=[],k=[],v=1,t=1,m=-1,l=-1;for(e=0;e<o;e++){u[e*2]=Math.cos(2*Math.PI*e/o-Math.PI/2);k[e*2]=Math.sin(2*Math.PI*e/o-Math.PI/2);if(u[e*2]<v){v=u[e*2]}if(k[e*2]<t){t=k[e*2]}if(u[e*2]>m){m=u[e*2]}if(k[e*2]>l){l=k[e*2]}u[e*2+1]=Math.cos(2*Math.PI*((e*2+1)/2)/o-Math.PI/2);k[e*2+1]=Math.sin(2*Math.PI*((e*2+1)/2)/o-Math.PI/2)}g={cXs:u,cYs:k,minX:v,minY:t,maxX:m,maxY:l};ShapeStarCache[o]=g}d=s/(g.maxX-g.minX);c=f/(g.maxY-g.minY);this.moveTo(q+(g.cXs[0]-g.minX)*d,n+(g.cYs[0]-g.minY)*c);this.lineTo(q+(g.cXs[1]*b-g.minX)*d,n+(g.cYs[1]*b-g.minY)*c);for(e=1;e<o;++e){this.lineTo(q+(g.cXs[e*2]-g.minX)*d,n+(g.cYs[e*2]-g.minY)*c);this.lineTo(q+(g.cXs[e*2+1]*b-g.minX)*d,n+(g.cYs[e*2+1]*b-g.minY)*c)}this.closeSubpath()}}function svgBBox(b){var c;try{c=b.getBBox()}catch(a){c={x:0,y:0,width:0,height:0}}return{x:c.x,y:c.y,width:c.width,height:c.height}}function toSvgLinearGrad(h,g){var e=Math.tan(h*Math.PI/180),c=1+e*e,b,f,a,d;h=h%360;if(h<0){h+=360}if(h<90){b=g.x;f=g.y+g.height;a=g.x+g.width;d=g.y}else{if(h<180){b=g.x;f=g.y;a=g.x+g.width;d=g.y+g.height}else{if(h<270){a=g.x;d=g.y+g.height;b=g.x+g.width;f=g.y}else{a=g.x;d=g.y;b=g.x+g.width;f=g.y+g.height}}}return{x1:(e*b-f)*e/c,y1:(-e*b+f)/c,x2:(e*a-d)*e/c,y2:(-e*a+d)/c}}function toSvgRadialGrad(s,p,h,t,f){var m=f.x+s*f.width/100,l=f.y+p*f.height/100,q=Math.abs(m-f.x),k=Math.abs(f.x+f.width-m),g=Math.abs(l-f.y),e=Math.abs(f.y+f.height-l),c,b,a,o=1,n=1,d="";if(t==GradSize.CLOSE_SIDE||t==GradSize.CLOSE_CORNER){c=Math.min(q,k);b=Math.min(g,e);if(h==GradShape.CIRCLE){a=t==GradSize.CLOSE_SIDE?Math.min(c,b):Math.sqrt(c*c+b*b)}else{if(c==0||b==0){a=0}else{if(c>=b){a=t==GradSize.CLOSE_SIDE?c:Math.sqrt(2)*c;n=b/c}else{a=t==GradSize.CLOSE_SIDE?b:Math.sqrt(2)*b;
o=c/b}}}}else{c=Math.max(q,k);b=Math.max(g,e);if(h==GradShape.CIRCLE){a=t==GradSize.FAR_SIDE?Math.max(c,b):Math.sqrt(c*c+b*b)}else{if(c==0||b==0){a=0}else{if(c>=b){a=t==GradSize.FAR_SIDE?c:Math.sqrt(2)*c;n=b/c}else{a=t==GradSize.FAR_SIDE?b:Math.sqrt(2)*b;o=c/b}}}}if(o!=1||n!=1){d="translate("+m+","+l+") scale("+o+","+n+") translate("+-m+","+-l+")"}return{x:m,y:l,r:a,t:d}}
/*!
 * Atomi HTML5 Player - UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2016/03/25
 */
var UI={IDs:{ViewPort:"ViewPortDiv",Stage:"StageDiv",Canvas:"CanvasDiv",ClosedCaption:"CCaptionDiv",Slides:"SlidesDiv"},SlideList:null,Toolbar:null,$Slides:null,slideW:0,slideH:0,AutoFitWindow:TemplateParams.IniAutoFit,dockables:[],focusedPane:null,PlayerImageUrl:function(a){return TemplateParams.ImagePath+a},GetSlideLayerID:function(a){if(a==1){return"sld_layer1"}else{return"sld_layer2"}},IsAutoFit:function(){return this.AutoFitWindow},EnableAutoFit:function(a){if(a!=this.AutoFitWindow){this.AutoFitWindow=a;this.Layout()}},ToggleAutoFit:function(){this.EnableAutoFit(!this.AutoFitWindow)},BlankImgUrl:function(){return this.PlayerImageUrl("blank.gif")},ViewPort:function(){return $("#"+this.IDs.ViewPort)},Stage:function(){return $("#"+this.IDs.Stage)},Canvas:function(){return $("#"+this.IDs.Canvas)},CanvasScrollParent:function(){return $("#"+this.IDs.Stage)},FindDockable:function(b){for(var a=0;a<this.dockables.length;++a){if(this.dockables[a].GetId()==b){return this.dockables[a]}}return null},LayoutDockPane:function(g,k){var f=(g.attr("id")=="DockPaneLeft"||g.attr("id")=="DockPaneRight");var c=g.children();var b=c.length;var a=TemplateParams.DockPaneSize||250;g.css(f?"width":"height",b<=0?0:a);if(b<=0){return}var m=(k!==undefined);var d=0;var p=0;c.each(function(h,l){var r=$(l);d+=r.outerWidth(true);p+=r.outerHeight(true)});if(d<1){d=1}if(p<1){p=1}if(f){var n=g.height();var o=g.width();var q=0;c.each(function(h,t){var v=$(t);var l=o-parseInt(v.css("border-left-width"))-parseInt(v.css("border-right-width"));v.css("position","absolute").width(l).css("left",0);var s=(h==b-1)?n-q:(m?n/b:v.outerHeight(true)/p*n);var r=s-(parseInt(v.css("border-top-width"))+parseInt(v.css("border-bottom-width")));v.height(r).css("top",q);q+=s;var u=UI.FindDockable(v.attr("id"));if(u){u.LayoutContent();u.EnableMinimize(b>1);if(m){u.ClearMinimizedState()}}})}else{var n=g.height();var o=g.width();var e=0;c.each(function(h,t){var v=$(t);var s=n-parseInt(v.css("border-top-width"))-parseInt(v.css("border-bottom-width"));v.css("position","absolute").height(s).css("top",0);var r=(h==b-1)?o-e:(m?o/b:v.outerWidth(true)/d*o);var l=r-(parseInt(v.css("border-left-width"))+parseInt(v.css("border-right-width")));v.width(l).css("left",e);e+=r;var u=UI.FindDockable(v.attr("id"));if(u){u.LayoutContent();u.EnableMinimize(b>1);if(m){u.ClearMinimizedState()}}})}},Layout:function(){if(!UI.Toolbar){return}var s=UI.Toolbar.GetPadding();var e=UI.Toolbar.GetMinPlayerSize();var f=UI.IsAutoFit();var t=2;var n={w:$(window).innerWidth()-2*t,h:$(window).innerHeight()-2*t};var l=PrezInfo.ViewPort.width,p=PrezInfo.ViewPort.height;var b=$("#DockPaneLeft");var a=$("#DockPaneRight");var v=$("#DockPaneTop");var k=$("#DockPaneBottom");var q=UI.Stage();var d=UI.Canvas();var r=UI.ViewPort();var c=Math.max(e.w-b.width()-a.width()-s.l-s.r,1);var m=Math.max(e.h-v.height()-k.height()-s.t-s.b,1);if(f){var u=Math.max(n.w-b.width()-a.width()-s.l-s.r,1);var g=Math.max(n.h-v.height()-k.height()-s.t-s.b,1);if(u/g<l/p){g=Math.floor(p*u/l)}else{u=Math.floor(l*g/p)}if(u<c||g<m){if(u/g<c/m){u=c;g=p*u/l}else{g=m;u=l*g/p}}Prez.Scale=u/l;q.css("overflow","hidden").width(u).height(g);d.width(l).height(p);d.css("transform","scale("+Prez.Scale+","+Prez.Scale+")");d.css("transform-origin","0% 0%")}else{var u=Math.min(l,n.w-b.width()-a.width()-s.l-s.r);var g=Math.min(p,n.h-v.height()-k.height()-s.t-s.b);if(u<c){u=c}if(g<m){g=m}q.css("overflow","auto").width(u).height(g);d.width(l-40).height(p-40);d.width(l).height(p);d.css("transform","");d.css("transform-origin","");Prez.Scale=1}Prez.UpdatePrezPropertyChanged("Scale",Prez.Scale);r.width(b.width()+q.width()+a.width()+s.l+s.r);r.height(v.height()+q.height()+k.height()+s.t+s.b);r.css("left",Math.floor((n.w-r.width())/2)+t).css("top",0);b.css("left",s.l).css("top",s.t).height(r.height()-s.t-s.b);a.css("left",s.l+b.width()+q.width()).css("top",s.t).height(r.height()-s.t-s.b);v.css("left",s.l+b.width()).css("top",s.t).width(q.width());k.css("left",s.l+b.width()).css("top",s.t+v.height()+q.height()).width(q.width());q.css("left",s.l+b.width()).css("top",s.t+v.height());UI.LayoutDockPane(b);UI.LayoutDockPane(a);UI.LayoutDockPane(v);UI.LayoutDockPane(k);UI.Toolbar.Layout();for(var o=0;o<this.dockables.length;++o){if(this.dockables[o].IsFloating()){this.dockables[o].EnsureInsideStage()}}r.trigger("viewport:layout")},Init:function(){if(UI.Toolbar){return}var a='<div id="DockPaneLeft" class="ap-dock-pane"></div>\n<div id="DockPaneRight" class="ap-dock-pane"></div>\n<div id="DockPaneTop" class="ap-dock-pane"></div>\n<div id="DockPaneBottom" class="ap-dock-pane"></div>\n<div id="StageDiv" tabindex="-1">\n\t<div id="CanvasDiv" tabindex="-1">\n\t\t<div id="SlidesDiv"></div>\n\t\t<div id="CCaptionDiv"></div>\n\t</div>\n</div>';UI.ViewPort().empty().append(a);var b=location.href;b.toLowerCase();if(b.indexOf("autofit=false")!=-1){this.AutoFitWindow=false}else{if(b.indexOf("autofit=true")!=-1){this.AutoFitWindow=true}}UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlideBot.duration,sliderVal:0,segments:Prez.slideDurationPercents});$(window).unbind("resize").resize(this.OnResizeWindow);UI.slideW=PrezInfo.ViewPort.width;UI.slideH=PrezInfo.ViewPort.height;UI.Layout()},OnPrezStart:function(a){CanvasNav.Init();$(window).unbind("resize").resize(this.OnResizeWindow);if(a){if(this.SlideList){this.SlideList.Hide();this.SlideList=null}}this.$Slides=$("#"+this.IDs.Slides).empty();MediaManager.ClearPlayerIDs();var d=this.GetSlideLayerID(1);var g=this.GetSlideLayerID(2);var m="";for(var c=1;c<=2;++c){var b=(c==1?d:g);m+='<div class="slide" id="'+b+'" style="z-index:'+(c==1?ZIndexBase.SlideCtrlsOld:ZIndexBase.SlideCtrlsNew)+';" onclick="void(0)">';for(var e=0;e<mediaStats.max_nb_slide_video+mediaStats.nb_top_project_video;++e){m+=MediaManager.CreatePlayerElements(e,b,false)}m+="</div>"}this.$Slides.append(m);if(Prez.prjSlideBot.wmd){var l="da";l+="ta";l+=":i";l+="ma";l+="ge";l+="/p";l+="ng";l+=";b";l+="as";l+="e6";l+="4,";var h='<img id="appwmk1" class="bgimg ap-wmk" style="display:none; pointer-events:none;" src="'+l+Prez.prjSlideBot.wmd+'" alt="'+PrezInfo.Generator+'" width="100%" height="100%" />';var f='<img id="appwmk2" class="bgimg ap-wmk" style="display:none; pointer-events:none;" src="'+l+Prez.prjSlideBot.wmd+'" alt="'+PrezInfo.Generator+'" width="100%" height="100%" />';$(h).error(function(){$("#appwmk1").remove()}).appendTo($("#"+d));$(f).error(function(){$("#appwmk2").remove()}).appendTo("#"+g)}this.Toolbar.Show();this.Toolbar.SetListener("onSeeking",UI,"OnSeeking");this.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging");ClosedCaptionUI.Init();if(!this.SlideList&&TemplateParams.IniSlideListShow&&this.HasSlideList()){this.ShowSlideList()}this.Layout()},HasSlideList:function(){if(TemplateParams.SlideListPos==UIPos.NONE){return false}if(TemplateParams.AlwaysShowSlideList){return true}if(Prez.Session.PMode!=PlayModes.PRAC&&Prez.Session.PMode!=PlayModes.TEST){return true}return false},OnResizeWindow:function(a){if(!$(a.target).hasClass("ui-resizable")){UI.Layout()}},CleanUp:function(){CanvasNav.CleanUp();$(window).unbind("resize")},ShowSlideList:function(){if(!this.SlideList){this.SlideList=new SlideListUI();this.SlideList.Show();var a=Prez.GetSlideCompletions();this.SlideList.MarkComplete(a);if(Prez.slideUI){this.SlideList.SetCurrentSlide(Prez.slideUI&&Prez.slideUI.GetIndex())}else{this.SlideList.SetCurrentSlide(-1)}}},OnSeeking:function(g,c,b,f){if(!UI.SlideNavigationEnabled()){return false
}var d,a,e=Prez.GetExportedSlides();for(d=e.length-1;d>=0;--d){a=e[d];if(b>=a.startTime){this.Toolbar.SetProgress(d,b);if(f){Prez.ShowSlide(a,b-a.startTime,false)}return}}},OnVolumeChanging:function(d,b,a,c){Prez.SetVolume(a)},ShowMsg:function(b,f,c,a){if(a==undefined){a=[]}if(f==undefined){f=true}if(c==undefined){c=false}var e=Prez.Pause(PrezStreams.ALL);$(document).bind("reveal.facebox",function(){Key.RemoveHandlers();Mouse.RemoveHandlers();$(document).unbind("reveal.facebox");$.facebox.showClose(f);var k=PrezInfo.TextDir;if(k=="rtl"){$("#facebox").find(".body").attr("dir",k).css("text-align","right");$("#facebox").find(".footer").attr("dir",k).css("text-align","left")}var l=-1;if(f){var h="facebox_close";a.push(h);l=a.length-1;$("#facebox .close").attr({id:h,title:Lang.Close,role:"button",tabindex:"0"}).focus();$("#facebox .close_image").attr("title",Lang.Close)}$("#facebox").attr("role","dialog");$(document).bind("keydown.facebox",function(n){var p=n.which;if(p==Key.TAB){var r=false;if(l>=0&&l<=a.length-1){var q=$("#"+a[l]);if(q.attr("tabindex")==0){r=true;q.attr("tabindex","-1");q.blur()}}if(l<0||l>a.length-1){l=0}else{l+=r?(n.shiftKey?-1:1):0;if(l<0){l=a.length-1}else{if(l>a.length-1){l=0}}}var m=$("#"+a[l]);m.attr("tabindex","0");m.focus()}else{if(p==Key.ESCAPE){$.facebox.trigger("close.facebox")}else{if(p==13||p==32){for(var o=0;o<a.length;++o){if(n.target.id==a[o]){n.stopPropagation();return true}}}}}return false}).bind("focus.facebox",function(n){if(l<0||l>a.length-1){l=0}var m=$("#"+a[l]);m.attr("tabindex","0");m.focus()}).bind("mousedown.facebox",function(m){$(this).focus();return false});for(var g=0;g<a.length;++g){$("#"+a[g]).focus(function(m){l=$.inArray($(this).attr("id"),a);$(this).attr("tabindex","0")}).blur(function(m){$(this).attr("tabindex","-1")})}$(document).focus()});var d=function(){$(document).unbind("mousedown.facebox").unbind("focus.facebox").unbind("keydown.facebox").unbind("close.facebox",d);Key.InitHandlers();Mouse.InitHandlers();if(c==true){Prez.Close(false)}else{Prez.Resume(e)}};$(document).bind("close.facebox",d);$.facebox(b)},ShowAbout:function(){var b=[];var a="";if(PrezInfo.Homepage!=""){a="<a id='about_homepage' href='"+PrezInfo.Homepage.quoteHTML()+"' target='_blank' tabindex='-1'>"+PrezInfo.Homepage.quoteHTML()+"</a>";b.push("about_homepage")}var c="<div style='font-family:verdana;font-size:14px;line-height:1.8;color:green;padding:5px;'>";c+="<b>"+PrezInfo.Name.quoteHTML()+"</b><br />"+Lang.Author+": <b>"+PrezInfo.Author.quoteHTML()+"</b><br />"+Lang.Copyright+": <b>"+PrezInfo.Copyright.quoteHTML()+"</b><br />"+Lang.Homepage+": <b>"+a+"</b></div><div style='font-family:verdana;font-size:10px;line-height:1.8;color:green;border-top:solid 1px #DDDDDD;padding:5px;'>"+Lang.BuiltWith+" <a id ='about_app_home' dir='ltr' href='"+PrezInfo.AppHomePage+"' title='"+PrezInfo.AppHomePage+"' target='_blank' tabindex = '-1'>"+PrezInfo.Generator.quoteHTML()+"</a><br />Atomi Systems, Inc.</div>";b.push("about_app_home");UI.ShowMsg(c,true,false,b)},ShowLoading:function(d,b,c){if(b){if(!this.bufferingCanvas){$("#"+d).append('<div id="BufferingContainer" class="ap-buffering-container"></div>');var a=new CanvasLoader("BufferingContainer");a.setColor("#2090e6");a.setDiameter($("#BufferingContainer").width());a.setDensity(9);a.setRange(1);a.setSpeed(1);a.setFPS(5);a.show();this.bufferingCanvas=a;APTheme.DecorateLoadingIcon()}if(c){this.bufferingCanvas.setProgressText(c)}}else{this.bufferingCanvas=undefined;$("#BufferingContainer").remove()}},ShowBigPlayButton:function(d,b){var a="BigPlayButtonContainer";if(b){var c='<svg version="1.1" id="rlplay_icon"xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"x="0px" y="0px" width="128px" height="128px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve"><circle fill="#F2F2F2" cx="64" cy="64" r="48"/><circle fill="#333333" cx="63" cy="63" r="36"/><polyline fill="#F2F2F2" points="49,92 95,64 49,36 49,92 "/></svg>';$("#"+d).append('<div id="'+a+'" class="ap-big-play-button-container">'+c+"</div>");APTheme.DecorateBigPlayButton()}else{$("#"+a).remove()}},UpdateTemplateParamsChanged:function(){var a=this;$(this).everyTime(500,"UpdatePrezParams",function(){if(!Prez.started){return}$(a).stopTime("UpdatePrezParams");if(UI.Toolbar){UI.Toolbar.Hide();UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlideBot.duration,sliderVal:0,segments:Prez.slideDurationPercents});UI.Toolbar.Show();UI.Toolbar.SetListener("onSeeking",UI,"OnSeeking");UI.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging");if(ClosedCaptionUI){ClosedCaptionUI.Show(TemplateParams.IniCCShow)}Prez.SetVolume(TemplateParams.IniVolume);UI.EnableAutoFit(TemplateParams.IniAutoFit)}if(UI.SlideList){UI.SlideList.Hide();UI.SlideList=undefined}if(!UI.SlideList&&TemplateParams.IniSlideListShow&&UI.HasSlideList()){UI.ShowSlideList()}UI.Layout()})},AddDockable:function(a){this.dockables.push(a)},RemoveDockable:function(a){this.dockables=jQuery.grep(this.dockables,function(b){return b!=a})},MoveFocus:function(e){var b=[CanvasNav];if(this.Toolbar){b.push(this.Toolbar)}if(this.SlideList){b.push(this.SlideList)}var c=$.inArray(this.focusedPane,b),a=b.length,d=null;if(c<0){if(e){c=a}else{c=-1}}while(true){if(e){--c}else{++c}d=b[c];if(!d){this.focusedPane=null;return false}if(this.FocusPane(d)){return true}}return false},FocusPane:function(a){if(a&&a.Focus&&a.Focus()){this.focusedPane=a;return true}return false},OnPaneFocused:function(a){UI.focusedPane=a},SlideNavigationEnabled:function(){if(Prez.Session.PMode==PlayModes.PRAC){return(TemplateParams.NavInPractice==1)}else{if(Prez.Session.PMode==PlayModes.TEST){return false}}return true}};var CanvasNav={_focusedCtrlUI:null,Init:function(){UI.Canvas().bind("focusin.nav",function(){UI.OnPaneFocused(CanvasNav)});this._focusedCtrlUI=null;if(!Options.AllowNavigate){return}UI.Canvas().bind("keydown.nav",function(c){if(!Prez.slideUI){return}if(c.which==Key.SPACE&&Prez.Session.PMode==PlayModes.DEMO){c.stopPropagation();Prez.TogglePause();return}if(c.which!=Key.TAB){return}var d=Prez.slideUI.ctrlUIs;var a=$.inArray(CanvasNav._focusedCtrlUI,d),e=null;if(c.shiftKey){if(a<0){a=d.length}e=CanvasNav._GetNextFocusedCtrl(a-1,true)}else{if(a<0){a=-1}e=CanvasNav._GetNextFocusedCtrl(a+1,false)}var b=CanvasNav._focusedCtrlUI;if(e&&e.Focus()){if(b&&b!=e&&b.IsShown()){b.MouseLeave()}e.MouseEnter();CanvasNav._focusedCtrlUI=e;return EvtMan.StopEvent(c)}if(b&&b.IsShown()){b.MouseLeave()}}).bind("mousedown.nav",function(a){CanvasNav.Focus(false,true)}).bind("mouseup.nav",function(a){if(Prez.Session.PMode==PlayModes.DEMO){a.stopPropagation();Prez.TogglePause()}})},CleanUp:function(){UI.Canvas().unbind(".nav");this._focusedCtrlUI=null},Focus:function(a,c){if(a===undefined){a=true}var b=this._focusedCtrlUI;if(!b||!b.IsFocusable()){b=this._GetNextFocusedCtrl(0,false)}this._focusedCtrlUI=null;var e,d;if(c){e=UI.CanvasScrollParent().scrollLeft();d=UI.CanvasScrollParent().scrollTop()}if(b&&b.Focus()){if(a){b.MouseEnter()}this._focusedCtrlUI=b}else{if(!c){c=true;e=UI.CanvasScrollParent().scrollLeft();d=UI.CanvasScrollParent().scrollTop()}UI.Canvas().focus()}if(c){UI.CanvasScrollParent().scrollLeft(e).scrollTop(d)}return true},GetFocusedCtrl:function(){return this._focusedCtrlUI},OnCtrlFocused:function(a){CanvasNav._focusedCtrlUI=a},_GetNextFocusedCtrl:function(c,e){if(!Prez.slideUI){return null}var a,d,b=Prez.slideUI.ctrlUIs;if(e){for(a=c;a>=0;--a){if(b[a].IsFocusable()){return b[a]}}}else{for(a=c,d=b.length;a<d;++a){if(b[a].IsFocusable()){return b[a]}}}return null}};var DockPosition={LEFT:UIPos.LEFT,TOP:UIPos.TOP,RIGHT:UIPos.RIGHT,BOTTOM:UIPos.BOTTOM};var nDockableOffset=0;function DockableUI(a){this.id=a;this.rect={x:100+nDockableOffset*20,y:100+nDockableOffset*20,w:300,h:200};this.nSavedDockedSize=100;nDockableOffset++;this.eDockPos=DockPosition.RIGHT;this.nDockIndex=0;this.bFloat=true;this.bMinimized=false;this.eDockHintPos=null;this.nDockZIndex=ZIndexBase.SlideList+1;this.nHintZIndex=ZIndexBase.SlideList+2;
this.nFloatZIndex=ZIndexBase.SlideList+3;this.bKeyNavEnabled=Options.AllowNavigate;this.bHighConstrastSupport=true;this.arrNavItems=[];this.nFocusedItemIndex=-1;this.bMoveOrResizeByKey=false}$.extend(DockableUI.prototype,{constructor:DockableUI,GetId:function(){return this.id},IsFloating:function(){return this.bFloat},GetDockPos:function(){return this.eDockPos},GetBestMinSize:function(){var c=$("#"+this.id+"_title");var a=c.find(".ap-dockable-title-bar-text");var b=c.find(".ap-dockable-button-pane");return{w:a.width()+b.width()+20,h:c.height()}},_GetContent:function(){},_GetTitle:function(){},_GetButtonHTML:function(){var a='<div class="ap-dockable-button-pane"><div id="'+this.id+'_minimize_restore" class="ap-dockable-button ap-dockable-button-minimize" title="'+Lang.Minimize+'" role="button" tabindex="-1" aria-pressed="'+this.bMinimized+'" aria-disabled="false"></div><div id="'+this.id+'_toogle_dock" class="ap-dockable-button" role="button" tabindex="-1" aria-pressed="'+this.bFloat+'"></div><div id="'+this.id+'_close" class="ap-dockable-button ap-dockable-button-close" title="'+Lang.Close+'" role="button" tabindex="-1"></div></div>';return a},_GetHTML:function(){var a='<div id="'+this.id+'" class="ap-dockable '+(PrezInfo.TextDir=="rtl"?"ap-dockable-rtl":"ap-dockable-ltr")+'" tabindex="-1"><div id="'+this.id+'_title" class="ap-dockable-title-bar"><div class="ap-dockable-title-bar-text">'+this._GetTitle()+"</div>"+this._GetButtonHTML()+'</div><div id="'+this.id+'_content" class="ap-dockable-content"><div id="'+this.id+'_content_inner" class="ap-dockable-content-inner">'+this._GetContent()+"</div></div></div>";return a},_GetDockPane:function(a){if(a===undefined){return null}switch(a){case DockPosition.LEFT:return $("#DockPaneLeft");case DockPosition.RIGHT:return $("#DockPaneRight");case DockPosition.TOP:return $("#DockPaneTop");case DockPosition.BOTTOM:return $("#DockPaneBottom")}return null},_GetSuggestedDockPos:function(){var e=5;var m=$("#"+this.id);var g=UI.Stage();var c=m.offset();var h=g.offset();var f=c.left-h.left;var a=c.top-h.top;var b=(h.left+g.width())-(c.left+m.width());var l=(h.top+g.height())-(c.top+m.height());var d=Math.min(f,a,b,l);var k=null;if(d<e){if(d==f){k=DockPosition.LEFT}else{if(d==b){k=DockPosition.RIGHT}else{if(d==a){k=DockPosition.TOP}else{if(d==l){k=DockPosition.BOTTOM}}}}}return k},_InitHighConstrastSupport:function(){$("#"+this.id).find(".ap-dockable-button").each(function(){$(this).append('<img src="'+UI.PlayerImageUrl("icons.png")+'" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none");$(this).attr("dir","ltr")});$("#"+this.id).find(".ap-icon").each(function(){$(this).append('<img src="'+UI.PlayerImageUrl("icons.png")+'" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none");$(this).attr("dir","ltr")})},_InitKeyNavSupport:function(){var b=this;$("#"+this.id).mousedown(function(c){c.stopPropagation();return true}).keydown(function(f){var o=f.which;if(o==Key.TAB){var g=b.nFocusedItemIndex;var d=b.arrNavItems;if(g>=0&&g<d.length){var p=$("#"+d[g]);p.attr("tabindex","-1");p.blur()}if((f.shiftKey&&g==0)||(!f.shiftKey&&g>=d.length-1)){b.nFocusedItemIndex=-1;return true}b.nFocusedItemIndex=g<0?0:g+(f.shiftKey?-1:1);var p=$("#"+d[b.nFocusedItemIndex]);p.attr("tabindex","0");p.focus()}else{if(o==32||o==13){var h=$(f.target);if(h.hasClass("ap-dockable-button")){h.trigger("click")}}else{if((o==37||o==38||o==39||o==40)&&(f.shiftKey||f.altKey)){if(!b.bFloat){return false}if(!b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=true;b._SavePosAndSize()}var q=$("#"+this.id);var m=UI.Canvas();var l={l:parseInt(m.css("left")),t:parseInt(m.css("top")),w:m.width(),h:m.height()};var c={l:parseInt(q.css("left")),t:parseInt(q.css("top")),w:q.width(),h:q.height()};var k=5;if(f.shiftKey){c.w+=(o==37?-k:(o==39?k:0));c.h+=(o==38?-k:(o==40?k:0));if(c.w<1){c.w=1}if(c.h<1){c.h=1}if(c.l+c.w>l.l+l.w){c.w=l.l+l.w-c.l}if(c.t+c.h>l.t+l.h){c.h=l.t+l.h-c.t}}else{c.l+=(o==37?-k:(o==39?k:0));c.t+=(o==38?-k:(o==40?k:0));if(c.l<l.l){c.l=l.l}if(c.t<l.t){c.t=l.t}if(c.l+c.w>l.l+l.w){c.l=l.l+l.w-c.w}if(c.t+c.h>l.t+l.h){c.t=l.t+l.h-c.h}}var n=b._GetSuggestedDockPos();if(n==null){b._HideDockHint()}else{b._ShowDockHint(n)}var e=(c.w!=q.width()||c.h!=q.height());q.css({left:c.l+"px",top:c.t+"px",width:c.w+"px",height:c.h+"px"});if(e){b.LayoutContent()}}else{return true}}}return false}).keyup(function(c){if(b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=false;b._HideDockHint();var d=b._GetSuggestedDockPos();if(d!=null){b.Dock(d)}}}).focus(function(c){$(this).attr("tabindex","-1");if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus();return false});$("#"+this.id+"_title").mousedown(function(c){if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus()}).find(".ap-dockable-button").mousedown(function(c){$(this).focus()});for(var a=0;a<b.arrNavItems.length;++a){$("#"+b.arrNavItems[a]).focus(function(c){b.nFocusedItemIndex=$.inArray($(this).attr("id"),b.arrNavItems);$(this).attr("tabindex","0")}).blur(function(c){$(this).attr("tabindex","-1")})}if(b.nFocusedItemIndex>=0&&b.nFocusedItemIndex<b.arrNavItems.length){$("#"+b.arrNavItems[b.nFocusedItemIndex]).focus()}},_Init:function(){if(this.bKeyNavEnabled){this._InitKeyNavSupport()}if(this.bHighConstrastSupport){this._InitHighConstrastSupport()}var a=this;$("#"+this.id+"_minimize_restore").click(function(b){if(a.bMinimized){a.Restore()}else{a.Minimize()}return false});$("#"+this.id+"_toogle_dock").click(function(b){a.ToggleDock();return false});$("#"+this.id+"_close").click(function(b){a.Hide();return false});$("#"+this.id+"_title").attr("unselectable","on").css("user-select","none").on("selectstart",false);$("#"+this.id).css("z-index",this.bFloat?this.nFloatZIndex:this.nDockZIndex)},_IsVerDocked:function(){return(this.eDockPos==DockPosition.RIGHT||this.eDockPos==DockPosition.LEFT)},_IsHozDocked:function(){return(this.eDockPos==DockPosition.TOP||this.eDockPos==DockPosition.BOTTOM)},LayoutContent:function(){var c=$("#"+this.id);var b=$("#"+this.id+"_title");var a=$("#"+this.id+"_content");a.height(c.height()-b.height()-parseInt(b.css("border-bottom-width")));a.width(c.width())},EnsureInsideStage:function(){if(!this.bFloat){return}var d=$("#"+this.id);if(d.length==0){return}var b=UI.Stage();var a={x:parseInt(b.css("left")),y:parseInt(b.css("top")),w:b.width(),h:b.height()};var c={x:parseInt(d.css("left")),y:parseInt(d.css("top")),w:d.width(),h:d.height()};c.w=Math.max(Math.min(b.width(),c.w),1);c.h=Math.max(Math.min(b.height(),c.h),1);c.x=Math.max(Math.min(c.x,a.x+a.w-c.w),a.x);c.y=Math.max(Math.min(c.y,a.y+a.h-c.h),a.y);d.css("left",c.x).css("top",c.y).width(c.w).height(c.h)},_OnStartResizing:function(c,e){var g=$("#"+this.id);var b=g.prev();var d;if(b){d=UI.FindDockable(b.attr("id"))}if(d){if(this._IsVerDocked()){var a=g.height();a-=(parseInt(g.css("border-top-width"))+parseInt(g.css("border-bottom-width")));a+=(b.height()-b.resizable("option","minHeight"));g.resizable("option","maxHeight",a)}else{var f=g.width();f-=(parseInt(g.css("border-left-width"))+parseInt(g.css("border-right-width")));f+=(b.width()-1);g.resizable("option","maxWidth",f);g.resizable("option","minWidth",1)}}else{g.resizable("option","minHeight",g.height());g.resizable("option","maxHeight",g.height());g.resizable("option","minWidth",g.width());g.resizable("option","maxWidth",g.width())}},_OnUpdateResizing:function(c,e){this.LayoutContent();var g=$("#"+this.id);var b=g.prev();if(!b){return}var d=UI.FindDockable(b.attr("id"));if(!d){return}if(this._IsVerDocked()){var f=parseInt(g.css("top"))-parseInt(b.css("top"));f-=(parseInt(b.css("border-top-width"))+parseInt(b.css("border-bottom-width")));b.height(f)}else{if(this._IsHozDocked()){var a=parseInt(g.css("left"))-parseInt(b.css("left"));a-=(parseInt(b.css("border-left-width"))+parseInt(b.css("border-right-width")));
b.width(a)}}d.LayoutContent();d.ClearMinimizedState()},_SavePosAndSize:function(){var a=$("#"+this.id);if(a.length==0){return}this.rect.x=parseInt(a.css("left"));this.rect.y=parseInt(a.css("top"));if(!this.bMinimized){this.rect.w=a.width();this.rect.h=a.height()}},Dock:function(c){this._CleanUp();var b=this._GetDockPane(c);if(b){this.eDockPos=c}else{b=this._GetDockPane(this.eDockPos)}this.bFloat=false;if(b){b.append(this._GetHTML());APTheme.DecorateDockableUI(this.id);UI.LayoutDockPane(b,true);var a=this;$("#"+this.id).resizable({containment:b,minHeight:$("#"+this.id+"_title").height(),handles:(a._IsVerDocked()?"n":"w"),start:function(d,e){a._OnStartResizing(d,e)},resize:function(d,e){a._OnUpdateResizing(d,e);a.ClearMinimizedState()},stop:function(d,e){a._OnUpdateResizing(d,e)}})}$("#"+this.id+"_toogle_dock").attr({title:Lang.Float,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-dock");UI.AddDockable(this);UI.Layout();this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}},UnDock:function(){this._CleanUp();this.bFloat=true;var c=this;var b=UI.Stage();var a=UI.ViewPort();a.append(this._GetHTML());var d=$("#"+this.id);d.resizable({containment:a,handles:"all",minHeight:$("#"+this.id+"_title").height(),resize:function(e,f){c.LayoutContent();c.ClearMinimizedState()}}).draggable({handle:$("#"+this.id+"_title"),cursor:"move",containment:a,start:function(e,f){c._SavePosAndSize()},drag:function(e,f){var g=c._GetSuggestedDockPos();if(g==null){c._HideDockHint()}else{c._ShowDockHint(g)}},stop:function(e,f){var g=c._GetSuggestedDockPos();c._HideDockHint();if(g!=null){c.Dock(g)}}});$("#"+this.id+"_toogle_dock").attr({title:Lang.Dock,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-float");d.css("position","absolute").css("left",this.rect.x).css("top",this.rect.y).width(this.rect.w).height(this.rect.h);this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}UI.AddDockable(this)},ToggleDock:function(){if(this.bFloat){this._SavePosAndSize();this.Dock()}else{this.UnDock();this.EnsureInsideStage()}},Show:function(){if(!this.bFloat){this.Dock()}else{this.UnDock()}if(UI.Toolbar){UI.Toolbar.UpdateState()}},_CleanUp:function(){$("#"+this.id).remove();UI.RemoveDockable(this);if(!this.bFloat){var a=this._GetDockPane(this.eDockPos);if(a){UI.LayoutDockPane(a,true);UI.Layout()}}},Hide:function(){if(this.bFloat){this._SavePosAndSize()}this._CleanUp();if(UI.Toolbar){UI.Toolbar.UpdateState()}},IsShown:function(){return UI.ViewPort().find("#"+this.id).length>0},ToggleShow:function(){if(this.IsShown()){this.Hide()}else{this.Show()}},Minimize:function(){if(this.bMinimized){return}if(this.bFloat){this._SavePosAndSize();var p=$("#"+this.id+"_title");var s=p.find(".ap-dockable-title-bar-text");var l=p.find(".ap-dockable-button-pane");var r=$("#"+this.id);r.width(s.width()+l.width()+20);r.height(p.height());this.LayoutContent();this.SetMinimizedState()}else{var r=$("#"+this.id);var p=$("#"+this.id+"_title");var d=this._IsVerDocked();this.nSavedDockedSize=d?r.height():r.width();var n=r.next();var h;if(n){h=UI.FindDockable(n.attr("id"))}if(h){if(d){var e=r.height()-p.height();r.height(p.height());var m=parseInt(n.css("top"))-e;var k=n.height()+e;n.css("top",m).height(k)}else{var o=this.GetBestMinSize();var e=r.width()-o.w;r.width(o.w);var q=parseInt(n.css("left"))-e;var g=n.width()+e;n.css("left",q).width(g)}this.LayoutContent();this.SetMinimizedState();h.LayoutContent();h.ClearMinimizedState();return}var f=r.prev();var b;if(f){b=UI.FindDockable(f.attr("id"))}if(b){if(d){var e=r.height()-p.height();var c=parseInt(r.css("top"))+e;r.height(p.height()).css("top",c);f.height(f.height()+e)}else{var o=this.GetBestMinSize();var e=r.width()-o.w;var a=parseInt(r.css("left"))+e;r.width(o.w).css("left",a);f.width(f.width()+e)}this.LayoutContent();this.SetMinimizedState();b.LayoutContent();b.ClearMinimizedState();return}}},Restore:function(){if(!this.bMinimized){return}if(this.bFloat){var f=$("#"+this.id);f.width(this.rect.w);f.height(this.rect.h);this.LayoutContent();this.ClearMinimizedState()}else{var f=$("#"+this.id);var x=$("#"+this.id+"_title");var r=this._IsVerDocked();var g=f.next();var k;if(g){k=UI.FindDockable(g.attr("id"))}if(k){var q=false;if(r){var c=$("#"+k.id+"_title");var p=Math.min(this.nSavedDockedSize-f.height(),g.height()-c.height());f.height(f.height()+p);var w=parseInt(g.css("top"))+p;var m=g.height()-p;g.css("top",w).height(m);if(k.GetBestMinSize().h==m){q=true}}else{var n=k.GetBestMinSize();var p=Math.min(this.nSavedDockedSize-f.width(),g.width()-n.w);f.width(f.width()+p);var o=parseInt(g.css("left"))+p;var t=g.width()-p;g.css("left",o).width(t);if(k.GetBestMinSize().w==t){q=true}}this.LayoutContent();this.ClearMinimizedState();k.LayoutContent();if(q){k.SetMinimizedState()}else{k.ClearMinimizedState()}return}var v=f.prev();var s;if(v){s=UI.FindDockable(v.attr("id"))}if(s){var b=false;if(r){var a=$("#"+s.id+"_title");var p=Math.min(this.nSavedDockedSize-f.height(),v.height()-a.height());var u=f.height()+p;var d=parseInt(f.css("top"))-p;f.height(u).css("top",d);v.height(v.height()-p);if(s.GetBestMinSize().h==v.height()){b=true}}else{var l=s.GetBestMinSize();var p=Math.min(this.nSavedDockedSize-f.width(),v.width()-l.w);var h=f.width()+p;var e=parseInt(f.css("left"))-p;f.width(h).css("left",e);v.width(v.width()-p);if(s.GetBestMinSize().w==v.width()){b=true}}this.LayoutContent();this.ClearMinimizedState();s.LayoutContent();s.ClearMinimizedState();if(b){s.SetMinimizedState()}else{s.ClearMinimizedState()}return}}},ClearMinimizedState:function(){if(!this.bMinimized){return}this.bMinimized=false;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-restore").addClass("ap-dockable-button-minimize").attr({title:Lang.Minimize,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},SetMinimizedState:function(){if(this.bMinimized){return}this.bMinimized=true;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-minimize").addClass("ap-dockable-button-restore").attr({title:Lang.Restore,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},EnableMinimize:function(a){$("#"+this.id+"_minimize_restore").css("opacity",a?1:0.35).attr("aria-disabled",""+!a)},_ShowDockHint:function(g){if(this.eDockHintPos==g){return}var f=this._GetDockPane(g);if(!f){this.eDockHintPos=null;$("#"+this.id+"_dock_hint").remove();return}var a=UI.ViewPort();var e=UI.Stage();$("#"+this.id+"_dock_hint").remove();this.eDockHintPos=g;var d='<div id="'+this.id+'_dock_hint" class="ap-dockable-hint"></div>';a.append(d);var c=$("#"+this.id+"_dock_hint");c.css("opacity",0.25).css("z-index",this.nHintZIndex);if(f.width()>0&&f.height()>0){c.css("left",f.css("left")).css("top",f.css("top")).width(f.width()).height(f.height());return}var b=Math.min(e.width()/2,e.height()/2,200);switch(g){case DockPosition.LEFT:c.css("left",e.css("left")).css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.RIGHT:c.css("left",(parseInt(e.css("left"))+e.width()-b)+"px").css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.TOP:c.css("left",e.css("left")).css("top",e.css("top")).width(e.width()).height(b);break;case DockPosition.BOTTOM:c.css("left",e.css("left")).css("top",(parseInt(e.css("top"))+e.height()-b)+"px").width(e.width()).height(b);break;default:break}},_HideDockHint:function(){this._ShowDockHint(null)},Focus:function(){var b=this.arrNavItems[this.nFocusedItemIndex];if(!b){this.nFocusedItemIndex=0;b=this.arrNavItems[0]}var a=$("#"+b);if(a.length){a.attr("tabindex","0");a.focus();return true}return false}});SlideListUI.MS2STR=function(a){var e=Math.round(a/1000);var c=Math.floor(e/3600);var b=Math.floor(e%3600/60);var d=Math.round(e%60*10)/10;var f="";if(c>0){f+=(c+":")}if(c>0&&b<10){f+="0"}f+=(b+":");if(d<10){f+="0"}f+=d;return ToLocalNumber(f,PrezInfo.Language)};
var SlideListItemMode={HIDE:1,NUMBERING_NONE:2,NUMBERING_CONTINUE:3,NUMBERING_RESTART:4};function SlideListUI(){DockableUI.call(this);if(TemplateParams.SlideListPos==UIPos.FLOATING){this.bFloat=true}else{this.bFloat=false;this.eDockPos=TemplateParams.SlideListPos}this.id="SlideList";this.bShowInGroup=TemplateParams.ShowSlideAsGroup;this.mapStates={};this.nCurIndex=-1;this.arrGroups=[];this.mapSlideGroup={};this.strClassIncomplete="ap-slide-list-item-incomplete";this.strClassCurrent="ap-slide-list-item-current";this.strClassCompleted="ap-slide-list-item-completed";this.strClassExpanded="ap-slide-group-expanded";this.strClassCollapsed="ap-slide-group-collapsed";this.strItemPrefix="slide_list_item_slide_";this.strGroupPrefix="slide_list_item_group_";this.strTableId=this.id+"_table";this.nFocusedRow=-1;this.arrNavItems=[this.id+"_minimize_restore",this.id+"_toogle_dock",this.id+"_close",this.strTableId];this.nShowDetailedSteps=2;var m=false;if(Prez.Session.PMode==PlayModes.PRAC||Prez.Session.PMode==PlayModes.TEST){this.nShowDetailedSteps=TemplateParams.ShowDetailedStepsInPractice;m=(TemplateParams.HighLevelStepText==1)}this.strContent="";this.strContent+='<p class="ap-slide-list-title">';switch(Prez.Session.PMode){case PlayModes.DEMO:this.strContent+=Lang.Demo;break;case PlayModes.TUT:this.strContent+=Lang.Tutorial;break;case PlayModes.PRAC:this.strContent+=Lang.Practice;break;case PlayModes.TEST:this.strContent+=Lang.Test;break;default:break}this.strContent+=": "+PrezInfo.Name+"</p>";if(m){this.strContent+='<p class="ap-slide-list-title">'+Lang.HighLevelSteps.format(SlideListUI.MS2STR(Prez.prjSlideBot.duration))+"</p>"}this.strContent+='<table id="'+this.strTableId+'" width="100%" cellspacing="0" cellpadding="2" role="treegrid" aria-readonly="true" tabindex="-1">';var r="";var q=0;var e=(TemplateParams.ShowDuration==1||TemplateParams.ShowDuration==3);var n=(TemplateParams.ShowDuration==2||TemplateParams.ShowDuration==3);var g,p,f=0;for(var l=0,h=g_arrSlides.length;l<h;l++){var d=g_arrSlides[l];var a=d.name;if(a==""){a=Lang.Slide+" "+(l+1)}if(d.numbering!==undefined){p=d.numbering}else{p=SlideListItemMode.NUMBERING_CONTINUE}switch(d.numbering){case SlideListItemMode.HIDE:continue;case SlideListItemMode.NUMBERING_NONE:g="";break;case SlideListItemMode.NUMBERING_RESTART:f=1;g=ToLocalNumber(1,PrezInfo.Language)+". ";break;default:++f;g=ToLocalNumber(f,PrezInfo.Language)+". ";break}if(!this.bShowInGroup){this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="vertical-align:top;padding-left:10px;">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group==""){r="";this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="width:16px;vertical-align:top;"></td><td colspan="2" style="vertical-align:top">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group!=r){r=d.group;var b=0;for(var c=l;c<h;++c){if(g_arrSlides[c].group==r){b+=g_arrSlides[c].duration}else{break}}this.strContent+='<tr id="'+this.strGroupPrefix+q+'" class="'+this.strClassIncomplete+" "+this.strClassExpanded+'" role="row" tabindex="-1" aria-level="1" aria-expanded="true"><td id="'+this.strGroupPrefix+q+'_collapse_expand" class="collapsed-expanded-state"  style="width:1px;white-space:nowrap;vertical-align:top"><span class="ap-icon" title="'+Lang.Expanded+'" aria-label="'+Lang.Expanded+'"></span></td><td colspan="2" style="vertical-align:top">'+r+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="" aria-label=""></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(n?SlideListUI.MS2STR(b):"")+"</span></td></tr>";this.arrGroups.push({slide_indices:[],collapsed:(this.nShowDetailedSteps!=2)});q++}if(this.nShowDetailedSteps!=0){var o=true;for(var c=l+1;c<h;++c){if(g_arrSlides[c].group!=r){break}else{if(g_arrSlides[c].numbering!==SlideListItemMode.HIDE){o=false;break}}}this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="2"><td style="width:16px;vertical-align:top;"></td><td class="'+(o?"ap-slide-group-last-item":"ap-slide-group-item")+'" style="width:16px;vertical-align:top;"></td><td style="vertical-align:top;">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>"}this.arrGroups[q-1].slide_indices.push(l);this.mapSlideGroup[l]=q-1}this.strContent+="</table>"}$.extend(SlideListUI.prototype,DockableUI.prototype,{constructor:SlideListUI,_GetContent:function(){return this.strContent},_GetTitle:function(){return Lang.StepsPaneTitle},_SetGroupCollapsed:function(l,h){var k,f,c,b,d,a,g;k=this.arrGroups[l];f=h?"none":"";for(var e=0;e<k.slide_indices.length;++e){$("#"+this.strItemPrefix+k.slide_indices[e]).css("display",f)}k.collapsed=h;c=h?this.strClassExpanded:this.strClassCollapsed;b=h?this.strClassCollapsed:this.strClassExpanded;d=$("#"+this.strGroupPrefix+l);d.removeClass(c).addClass(b).attr("aria-expanded",""+!h);a=d.find(".collapsed-expanded-state").find(".ap-icon");g=h?Lang.Collapsed:Lang.Expanded;a.attr({title:g,"aria-label":g});if(this.bHighConstrastSupport){a.find("img").attr("alt",g)}this._UpdateCompletionStateARIA(d,true)},_UpdateCompletionStateARIA:function(d,c){var b=d.find(".ap-completion-state").find(".ap-icon");var a="";if(!c||(c&&d.hasClass(this.strClassCollapsed))){if(d.hasClass(this.strClassCompleted)){a=Lang.Completed}else{if(d.hasClass(this.strClassIncomplete)){a=Lang.Incomplete}else{if(d.hasClass(this.strClassCurrent)){a=Lang.Current}else{a=Lang.NotVisited}}}}b.attr({title:a,"aria-label":a});if(this.bHighConstrastSupport){b.find("img").attr("alt",a)}},_InitKeyNavSupport:function(){DockableUI.prototype._InitKeyNavSupport.call(this);var b=this;var d=$("#"+this.strTableId);var c=d.find("tr");var a=c.length;d.keydown(function(e){var m=e.which;if((m==38||m==40)&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){if(b.nFocusedRow>=0&&b.nFocusedRow<a){var p=c.eq(b.nFocusedRow);p.attr("tabindex","-1");p.blur()}else{b.nFocusedRow=-1}var h=b.nFocusedRow;var f=false;while(h>=0&&h<a){h+=(m==38?-1:1);var k=c.eq(h);if(k.length==0){break}if(k.css("display")!="none"){f=true;break}}if(!f){h=b.nFocusedRow}if(h<0){h=0}b.nFocusedRow=h;var n=c.eq(b.nFocusedRow);n.attr("tabindex","0");n.focus();return false}if((m==37||m==39)&&e.ctrlKey&&!e.shiftKey&&!e.altKey){if(b.nShowDetailedSteps==0){return false}if(!e.target){return false}var g=e.target.id;if(g.indexOf(b.strGroupPrefix)!=0){return false}g=g.replace(b.strGroupPrefix,"");var o=parseInt(g);if(isNaN(o)||o<0||o>=b.arrGroups.length){return false}var l=b.arrGroups[o];if((m==37&&!l.collapsed)||(m==39&&l.collapsed)){return false}b._SetGroupCollapsed(o,!l.collapsed);return false}if(m==32||m==13){var p=$(e.target);if(p.prop("tagName").toLowerCase()=="tr"){p.trigger("click")}return false}}).focus(function(e){$(this).attr("tabindex","-1");if(b.nFocusedRow<0||b.nFocusedRow>=a){b.nFocusedRow=0
}var f=c.eq(b.nFocusedRow);if(f.css("display")=="none"){b.nFocusedRow=0;f=c.eq(b.nFocusedRow)}f.attr("tabindex","0");f.focus();return false});c.focus(function(e){b.nFocusedRow=this.rowIndex;$(this).attr("tabindex","0")}).blur(function(e){$(this).attr("tabindex","-1")})},_Init:function(){DockableUI.prototype._Init.call(this);var c=this;$("#"+this.id).bind("focusin.nav",function(){UI.OnPaneFocused(c)});for(var b=0;b<g_arrSlides.length;b++){$("#"+this.strItemPrefix+b).attr("class",this.mapStates[b]?this.strClassCompleted:this.strClassIncomplete).css("cursor","pointer").click(function(){var f=$(this).attr("id");f=f.replace(c.strItemPrefix,"");var e=parseInt(f);if(isNaN(e)||e<0||e>=g_arrSlides.length){return false}if(UI.SlideNavigationEnabled()){Prez.ShowSlideByIndex(e)}return false})}for(var a=0;a<this.arrGroups.length;a++){$("#"+this.strGroupPrefix+a+"_collapse_expand").click(function(){if(c.nShowDetailedSteps==0){return false}var g=$(this).attr("id");g=g.replace(c.strGroupPrefix,"");g=g.replace("_collapse_expand","");var e=parseInt(g);if(isNaN(e)||e<0||e>=c.arrGroups.length){return false}var f=c.arrGroups[e];c._SetGroupCollapsed(e,!f.collapsed);return false});$("#"+this.strGroupPrefix+a).css("cursor","pointer").click(function(){var h=$(this).attr("id");h=h.replace(c.strGroupPrefix,"");var f=parseInt(h);if(isNaN(f)||f<0||f>=c.arrGroups.length){return false}var g=c.arrGroups[f];if(UI.SlideNavigationEnabled()){var e=g.slide_indices[0];if(e!==undefined){Prez.ShowSlideByIndex(e)}}return false})}this.SetCurrentSlide(this.nCurIndex);if(this.bShowInGroup){if(this.nShowDetailedSteps==0){for(var b=0,d=this.arrGroups.length;b<d;++b){this._SetGroupCollapsed(b,true)}}else{for(var b=0,d=this.arrGroups.length;b<d;++b){this._SetGroupCollapsed(b,this.arrGroups[b].collapsed)}}}},MarkComplete:function(b,g){var e=b?this.strClassCompleted:this.strClassIncomplete;if(g!==undefined){this.mapStates[g]=b;var c=$("#"+this.strItemPrefix+g);if(!c.length){if(g==this.nCurIndexActual&&g!=this.nCurIndex){delete this.nCurIndexActual;g=this.nCurIndex;c=$("#"+this.strItemPrefix+g);if(!c.length){return}}else{return}}c.attr("class",e);this._UpdateCompletionStateARIA(c,false);var l=this.mapSlideGroup[g];if(l!==undefined&&l>=0&&l<this.arrGroups.length){var h=this.arrGroups[l];var k=true;for(var f=0;f<h.slide_indices.length;++f){if(!this.mapStates[h.slide_indices[f]]){k=false;break}}var d=(k?this.strClassCompleted:this.strClassIncomplete)+" "+(h.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+l);a.attr("class",d);this._UpdateCompletionStateARIA(a,true)}}else{for(var f=0;f<g_arrSlides.length;f++){this.MarkComplete(b[f]===undefined?false:b[f],f)}}},SetCurrentSlide:function(f){if(typeof(f)!=="number"){f=-1}if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var d=this.mapStates[this.nCurIndex]?this.strClassCompleted:this.strClassIncomplete;var b=$("#"+this.strItemPrefix+this.nCurIndex);if(b.length){b.attr("class",d);this._UpdateCompletionStateARIA(b,false);var k=this.mapSlideGroup[this.nCurIndex];if(k!==undefined&&k>=0&&k<this.arrGroups.length){var g=this.arrGroups[k];var h=true;for(var e=0;e<g.slide_indices.length;++e){if(!this.mapStates[g.slide_indices[e]]){h=false;break}}var c=(h?this.strClassCompleted:this.strClassIncomplete)+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+k);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}}this.nCurIndex=f;if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var b;do{b=$("#"+this.strItemPrefix+f);if(b.length){break}--f}while(f>=0);this.nCurIndexActual=this.nCurIndex;this.nCurIndex=f;if(b.length){b.attr("class",this.strClassCurrent);this._UpdateCompletionStateARIA(b,false);var k=this.mapSlideGroup[this.nCurIndex];if(k!==undefined&&k>=0&&k<this.arrGroups.length){var g=this.arrGroups[k];var c=this.strClassCurrent+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+k);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}}}});ReportUI={pausedStreams:PrezStreams.NONE,OnSendReport:function(){Prez.SendReport()},OnFinish:function(){ReportUI.Close();Prez.Close(false)},OnShow:function(){$(document).unbind("reveal.facebox");$.facebox.footer(ReportUI.GetBtns());var a=PrezInfo.TextDir;if(a=="rtl"){$("#facebox").find(".body").attr("dir",a).css("text-align","right");$("#facebox").find(".footer").attr("dir",a).css("text-align","left")}if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){$("#SendReportButton").click(function(){ReportUI.OnSendReport()})}$("#ReportFinishButton").click(function(){ReportUI.OnFinish()})},Close:function(){$(document).trigger("close.facebox");Prez.Resume(this.pausedStreams);this.pausedStreams=PrezStreams.NONE},GetBtns:function(){var a="<div>";a+="<div align='center'>";if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){a+="<input style='cursor:pointer;' type='button' id='SendReportButton' value='"+Lang.SendReport+"'>"}a+="<input style='cursor:pointer;' type='button' id='ReportFinishButton' value='"+Lang.Finish+"'>";a+="</div></div>";return a},GetHTML:function(){var c={w:$(window).innerWidth(),h:$(window).innerHeight()};var b={w:Math.min(1280,c.w-80),h:Math.min(720,9*c.h/10-100)};if(b.w<50){b.w=50}if(b.h<50){b.h=50}var a="<div class='reportcontent' style='width:"+b.w+"px; height:"+b.h+"px'>";a+=Prez.GetReportData(ReportFormat.HTML,true);a+="</div>";return a},Show:function(){this.pausedStreams=Prez.Pause(PrezStreams.ALL);var a=this;$(document).bind("reveal.facebox",a.OnShow);$.facebox(this.GetHTML())}};function PointerEffect(){var H=Math.PI;var a=6;var o=40;var L=160;var g=40;var n=80;var k=25;var I=H/6;var E=H/18;var l=20;var e=15;var Q=H/36;var v=H/3;var r=H/6;var J=H/3;var u=60;var C=30;var f=50;var O=25;var D={EFFECT_NONE:0,EFFECT_CIRCLE:1,EFFECT_CONCENTRIC_CIRCLES:2,EFFECT_RECT:3,EFFECT_MAX:4};function G(R){return R}function h(R){return(R*H)/180}function P(T,S){var U=0.3;if(S<=U){var R=S/U;T=T*R}return T}function K(T,S){var U=0.8;if(S>=U){if(S>1){S=1}var R=(S-U)/(1-U);T=T*(1-R)}return T}function x(S,R,T){S.beginPath();S.moveTo(0,0);S.lineTo(-R,R);S.lineTo(-R/2,R);S.lineTo(0,T);S.lineTo(R/2,R);S.lineTo(R,R);S.closePath();S.fill()}function m(Z,W,V,R){var Y=(W*W/4-R*W)/2/(Math.sqrt(R*R-V*V)-R+W/2);var X=(W*W/4+R*W)/2/(Math.sqrt(R*R-V*V)-R-W/2);var T=Y+R-W/2;var S=X+R+W/2;var U=(V/R);Z.beginPath();Z.moveTo(0,-W);Z.lineTo(-W,0);Z.lineTo(-W/2,0);Z.arc(-T-W/2,0,T,0,Math.asin(V/T));Z.arc(-S+W/2,0,S,-2*H+Math.asin(V/S),0,true);Z.lineTo(W,0);Z.fill();Z.closePath()}function c(Z,W,V,R){var Y=(W*W/4-R*W)/2/(Math.sqrt(R*R-V*V)-R+W/2);var X=(W*W/4+R*W)/2/(Math.sqrt(R*R-V*V)-R-W/2);var T=Y+R-W/2;var S=X+R+W/2;var U=(V/R);Z.beginPath();Z.moveTo(0,-W);Z.lineTo(-W,0);Z.lineTo(-W/2,0);Z.arc(S-W/2,0,S,-H,-H-Math.asin(V/S),true);Z.arc(T+W/2,0,T,H-Math.asin(V/T),H,false);Z.lineTo(W,0);Z.fill();Z.closePath()}function y(Z,X,W,Y,U,T){var S=a;var aa=o;var R=U.call(null,Y)*(aa-S)+S;Z.lineWidth=S;var V=P(1,Y);V=K(V,Y);Z.globalAlpha=V;Z.strokeStyle=T;Z.clearRect(X-aa-S,W-aa-S,(aa+S)*2,(aa+S)*2);Z.beginPath();Z.arc(X,W,R,0,2*H);Z.stroke();Z.closePath()}function d(Z,X,W,Y,U,T){var aa=o;var S=15;var R=U.call(null,Y)*(aa-a-S)+a+S;Z.lineWidth=a;var V=P(1,Y);V=K(V,Y);Z.globalAlpha=V;Z.strokeStyle=T;Z.clearRect(X-aa-S,W-aa-S,(aa+S)*2,(aa+S)*2);Z.beginPath();Z.arc(X,W,R,0,2*H);Z.stroke();Z.closePath();if(R>0.3*(aa-a-S)+a+S){Z.beginPath();Z.arc(X,W,(R-S),0,2*H);Z.stroke();Z.closePath()}}function z(ac,aa,Z,ab,W,U){var X=k;var T=a/2;var V=1/2*X;var S=H/4;var Y=P(1,ab);Y=K(Y,ab);ac.globalAlpha=Y;ac.strokeStyle=U;ac.fillStyle=U;var R=2*H*W.call(null,ab);ac.clearRect(aa-(X+2*V),Z-(X+2*V),(X+2*V)*2,(X+2*V)*2);ac.beginPath();ac.lineWidth=a;ac.arc(aa,Z,X,0,2*H);ac.stroke();ac.closePath();ac.translate(aa+Math.cos(S)*(X+V)+T*Math.sin(H/4),Z-Math.sin(S)*(X+V)-T*Math.cos(H/4));ac.beginPath();ac.lineWidth=a/2;ac.arc(0,0,V,0,2*H);ac.stroke();ac.closePath();ac.setTransform(1,0,0,1,0,0);ac.translate(aa+Math.cos(S)*(X+V)+T*Math.sin(H/4),Z-Math.sin(S)*(X+V)-T*Math.cos(H/4));
ac.beginPath();ac.lineWidth=a/2;ac.moveTo(0,0);ac.arc(0,0,V,-H/2+R,3/2*H,true);ac.fill();ac.closePath();ac.setTransform(1,0,0,1,0,0)}function p(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y,X+S/2-V.call(null,aa)*S);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function s(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y,X-S/2+V.call(null,aa)*S);ab.rotate(H);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function M(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y-S/2+V.call(null,aa)*S,X);ab.rotate(H/2);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function q(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y+S/2-V.call(null,aa)*S,X);ab.fillStyle=T;ab.rotate(3/2*H);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function N(ag,ad,ac,af,Y,V){var ae=g/2;var X=n;var R=L;var U=I;var W=Math.sin(U)*(R-X);var Z=P(1,af);Z=K(Z,af);ag.globalAlpha=Z;ag.fillStyle=V;ag.clearRect(ad-R,ac-R,2*R,2*R);ag.translate(ad,ac);var T=-Math.sin(U)*R+X*Math.sin(U)+Y.call(null,af)*W;var ab=-T/Math.tan(U);ag.translate(T,ab);ag.rotate(U);x(ag,ae,X);ag.setTransform(1,0,0,1,ad,ac);var S=Math.sin(U)*R-X*Math.sin(U)-Y.call(null,af)*W;var aa=-S/Math.tan(U);ag.translate(S,aa);ag.rotate(H+U);x(ag,ae,X);ag.setTransform(1,0,0,1,0,0)}function B(ag,ad,ac,af,Y,V){var ae=g/2;var X=n;var R=L;var U=I;var W=Math.sin(U)*(R-X);var Z=P(1,af);Z=K(Z,af);ag.globalAlpha=Z;ag.fillStyle=V;ag.clearRect(ad-R,ac-R,2*R,2*R);ag.translate(ad,ac);var T=X*Math.sin(U)+Y.call(null,af)*W;var ab=-T/Math.tan(U);ag.translate(T,ab);ag.rotate(U);x(ag,ae,X);ag.setTransform(1,0,0,1,ad,ac);var S=-X*Math.sin(U)-Y.call(null,af)*W;var aa=-S/Math.tan(U);ag.translate(S,aa);ag.rotate(H+U);x(ag,ae,X);ag.setTransform(1,0,0,1,0,0)}function w(ad,ab,Z,ac,W,U){var X=e;var T=E;var S=Q;var V=v;var Y=P(1,ac);Y=K(Y,ac);ad.globalAlpha=Y;ad.strokeStyle=U;var aa=S+W.call(null,ac)*(V-S);var R=X/Math.cos(aa);ad.clearRect(ab-4*X,Z-4*X,8*X,8*X);ad.lineWidth=a;ad.lineJoin="round";ad.lineCap="round";ad.translate(ab,Z);ad.rotate(-60*T/H);ad.beginPath();ad.arc(X,0,R,H-aa,-H+aa,true);ad.arc(-X,0,R,-aa,-2*H+aa,true);ad.stroke();ad.closePath();ad.setTransform(1,0,0,1,0,0)}function b(ag,ae,ac,af,W,U){var X=l;var T=E;var S=r;var V=J;var Z=15;var ad=S+W.call(null,af)*(V-S);var R=X/Math.cos(ad);ag.clearRect(ae-4*X,ac-4*X,8*X,8*X);ag.translate(ae,ac);ag.rotate(-60*T/H);ag.lineWidth=a;var aa=P(1,af);aa=K(aa,af);ag.globalAlpha=aa;ag.strokeStyle=U;ag.lineJoin="round";ag.lineCap="round";ag.beginPath();ag.arc(-X,0,R,-ad,-2*H+ad,true);ag.arc(X,0,R,H-ad,-H+ad,true);ag.stroke();ag.closePath();if(R*Math.sin(ad)>Z){var Y=Math.atan((R*Math.sin(ad)-Z)/X);var ab=X/Math.cos(Y);ag.beginPath();ag.arc(-X,0,ab,-Y,-2*H+Y,true);ag.arc(X,0,ab,+H-Y,-H+Y,true);ag.stroke()}ag.setTransform(1,0,0,1,0,0)}function t(af,ac,ab,ae,X,U){var S=O;var ad=g/2;var W=80;var R=L;var Y=P(1,ae);Y=K(Y,ae);af.globalAlpha=Y;af.fillStyle=U;af.clearRect(ac-R-S,ab-R-S,2*(R+S),2*(R+S));var T=H/2;var V=R-W;af.translate(ac-S-R+W+X.call(null,ae)*V,ab);af.rotate(T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/4;V=Math.sin(T)*(R-W);af.translate(ac,ab);var aa=Math.sin(T)*(-R-S+W)+X.call(null,ae)*V;var Z=aa/Math.tan(T);af.translate(aa,Z);af.rotate(H-T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H;V=R-W;af.translate(ac,ab-S-R+W+X.call(null,ae)*V);af.rotate(T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/6;V=Math.sin(T)*(R-W);af.translate(ac,ab);aa=Math.sin(T)*(R+S-W)-X.call(null,ae)*V;var Z=-aa/Math.tan(T);af.translate(aa,Z);af.rotate(H+T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/3;V=Math.sin(T)*(R-W);af.translate(ac,ab);aa=Math.sin(T)*(R+S-W)-X.call(null,ae)*V;Z=-aa/Math.tan(T);af.translate(aa,Z);af.rotate(H+T);x(af,ad,W);af.setTransform(1,0,0,1,0,0)}function A(af,ab,aa,ae,Y,T){var ac=C/2;var V=f;var R=u;var ad=110;var S=200;var U=60;var Z=P(1,ae);Z=K(Z,ae);af.globalAlpha=Z;af.fillStyle=T;var X=h(ad+Y.call(null,ae)*U);af.clearRect(0,0,400,400);af.translate(ab+Math.cos(X)*R,aa-Math.sin(X)*R);af.rotate(-X);m(af,ac,V,R);af.setTransform(1,0,0,1,0,0);var W=h(S+Y.call(null,ae)*U);af.translate(ab+Math.cos(W)*R,aa-Math.sin(W)*R);af.rotate(-W);m(af,ac,V,R);af.setTransform(1,0,0,1,0,0)}function F(af,ab,aa,ae,Y,T){var ac=C/2;var V=f;var R=u;var ad=150;var S=60;var U=60;var Z=P(1,ae);Z=K(Z,ae);af.globalAlpha=Z;af.fillStyle=T;var X=h(ad-Y.call(null,ae)*U);af.clearRect(0,0,400,400);af.translate(ab+Math.cos(X)*R,aa-Math.sin(X)*R);af.rotate(H-X);c(af,ac,V,R);af.setTransform(1,0,0,1,0,0);var W=h(S-Y.call(null,ae)*U);af.translate(ab+Math.cos(W)*R,aa-Math.sin(W)*R);af.rotate(H-W);c(af,ac,V,R);af.setTransform(1,0,0,1,0,0)}this.RenderTouchEffect=function(R,W,V,T,U,S){switch(W){case Gesture.Type.SINGLE_TAP:y(R,V,T,U,G,S);break;case Gesture.Type.DOUBLE_TAP:d(R,V,T,U,G,S);break;case Gesture.Type.HOLD:z(R,V,T,U,G,S);break;case Gesture.Type.SINGLE_TAP_2FINGERS:w(R,V,T,U,G,S);break;case Gesture.Type.DOUBLE_TAP_2FINGERS:b(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_UP:p(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_DOWN:s(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_LEFT:q(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_RIGHT:M(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_LEFT:q(R,V,T,U,G,S);break;case Gesture.Type.ROTATE_LEFT:A(R,V,T,U,G,S);break;case Gesture.Type.ROTATE_RIGHT:F(R,V,T,U,G,S);break;case Gesture.Type.PINCH_IN:N(R,V,T,U,G,S);break;case Gesture.Type.PINCH_OUT:B(R,V,T,U,G,S);break;case Gesture.Type.FINGERS:t(R,V,T,U,G,S);break}};this.RenderMouseEffect=function(aa,V,X,W,Z,T,U){var S=200;aa.clearRect(0,0,U*2+S,U*2+S);var R=Z*U;aa.strokeStyle=T;aa.lineWidth=2;aa.lineJoin="round";aa.lineCap="round";if(V==D.EFFECT_CIRCLE){aa.beginPath();aa.arc(X,W,R,0,2*Math.PI);aa.stroke()}else{if(V==D.EFFECT_CONCENTRIC_CIRCLES){var Y=9;while(R>0){aa.beginPath();aa.arc(X,W,R,0,2*Math.PI);aa.stroke();R-=Y}}else{if(V==D.EFFECT_RECT){aa.strokeRect(X-R,W-R,2*R,2*R)}}}}}
/*!
 * Atomi HTML5 Player - No_Toolbar Toolbar UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Modified: 2013/11/01
 */
function APToolbar(a){this.GetPadding=function(){return{t:0,l:0,r:0,b:0}};this.GetMinPlayerSize=function(){return{w:1,h:1}};this.SetListener=function(c,b,d){};this.SetProgress=function(b,c){};this.GetVolumeValue=function(){return 0};this.SetVolumeValue=function(b){};this.SetPause=function(b){};this.SetMute=function(b){};this.SetCCaption=function(b){};this.SetAutoFit=function(b){};this.SetSlideListShown=function(b){};this.UpdateState=function(){};this.Show=function(){};this.Hide=function(){};this.Layout=function(){};this.Focus=function(){return false}}var APTheme={GetImages:function(a){},DecorateDockableUI:function(a){},DecorateBigPlayButton:function(){},DecorateLoadingIcon:function(){}};